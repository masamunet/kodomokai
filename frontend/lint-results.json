
> frontend@0.1.0 lint
> eslint --format json

[{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/forgot-password/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":32,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { motion } from 'framer-motion'\nimport { sendPasswordResetEmail } from '@/app/actions/auth'\nimport Link from 'next/link'\nimport { Input } from '@/components/ui/input'\nimport { Loader2, ArrowLeft } from 'lucide-react'\n\nexport default function ForgotPasswordPage() {\n  const [email, setEmail] = useState('')\n  const [isSubmitted, setIsSubmitted] = useState(false)\n  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle')\n  const [errorMessage, setErrorMessage] = useState('')\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!email) return\n\n    setStatus('loading')\n    setErrorMessage('')\n\n    try {\n      const result = await sendPasswordResetEmail(email)\n      if (result.success) {\n        setIsSubmitted(true)\n        setStatus('success')\n      } else {\n        setStatus('error')\n        setErrorMessage(result.message || '送信に失敗しました')\n      }\n    } catch (e) {\n      setStatus('error')\n      setErrorMessage('予期せぬエラーが発生しました')\n    }\n  }\n\n  if (isSubmitted) {\n    return (\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"w-full max-w-md mx-auto space-y-8 text-center\"\n      >\n        <h2 className=\"text-2xl font-bold text-gray-900\">メールを確認してください</h2>\n        <p className=\"mt-4 text-gray-600\">\n          <strong>{email}</strong> 宛にパスワード再設定用のメールを送信しました。<br />\n          メール内のリンクをクリックして、新しいパスワードを設定してください。\n        </p>\n        <div className=\"mt-8\">\n          <Link\n            href=\"/login\"\n            className=\"text-sm font-medium text-indigo-600 hover:text-indigo-500\"\n          >\n            ログイン画面に戻る\n          </Link>\n        </div>\n      </motion.div>\n    )\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"w-full max-w-md mx-auto space-y-8\"\n    >\n      <div className=\"text-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">パスワード再設定</h2>\n        <p className=\"mt-2 text-sm text-gray-600\">\n          登録済みのメールアドレスを入力してください。<br />\n          再設定用のリンクを送信します。\n        </p>\n      </div>\n\n      <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit}>\n        <div>\n          <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n            メールアドレス\n          </label>\n          <div className=\"mt-1\">\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              autoComplete=\"email\"\n              required\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              placeholder=\"example@email.com\"\n            />\n          </div>\n        </div>\n\n        {status === 'error' && (\n          <div className=\"text-red-600 text-sm text-center\">\n            {errorMessage}\n          </div>\n        )}\n\n        <div>\n          <button\n            type=\"submit\"\n            disabled={status === 'loading'}\n            className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n          >\n            {status === 'loading' ? (\n              <Loader2 className=\"animate-spin h-5 w-5\" />\n            ) : (\n              '送信する'\n            )}\n          </button>\n        </div>\n\n        <div className=\"text-center\">\n          <Link\n            href=\"/login\"\n            className=\"inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900\"\n          >\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            ログイン画面に戻る\n          </Link>\n        </div>\n      </form>\n    </motion.div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/_components/RegisterAccountStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/_components/RegisterChildrenStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/_components/RegisterCompleteStep.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[873,876],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[873,876],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { RegistrationData } from '../onboarding/RegistrationWizard'\nimport { completeRegistration } from '@/app/actions/auth'\nimport Link from 'next/link'\nimport { CheckCircle, AlertCircle, Loader2 } from 'lucide-react'\n\ntype Props = {\n  data: RegistrationData\n}\n\nexport default function RegisterCompleteStep({ data }: Props) {\n  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle')\n  const [errorMessage, setErrorMessage] = useState('')\n\n  useEffect(() => {\n    const submit = async () => {\n      setStatus('loading')\n      try {\n        const result = await completeRegistration(data)\n        if (result.success) {\n          setStatus('success')\n        } else {\n          setStatus('error')\n          setErrorMessage(result.message || '登録処理に失敗しました')\n        }\n      } catch (e: any) {\n        setStatus('error')\n        setErrorMessage(e.message || '予期せぬエラーが発生しました')\n      }\n    }\n\n    if (status === 'idle') {\n      submit()\n    }\n  }, [data, status])\n\n  if (status === 'loading') {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-12\">\n        <Loader2 className=\"h-12 w-12 text-indigo-600 animate-spin mb-4\" />\n        <h3 className=\"text-lg font-medium text-gray-900\">登録処理中...</h3>\n        <p className=\"text-gray-500\">アカウントとプロフィールを作成しています。</p>\n      </div>\n    )\n  }\n\n  if (status === 'error') {\n    return (\n      <div className=\"text-center py-8\">\n        <div className=\"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4\">\n          <AlertCircle className=\"h-6 w-6 text-red-600\" />\n        </div>\n        <h3 className=\"text-lg font-medium text-gray-900 mb-2\">登録に失敗しました</h3>\n        <p className=\"text-gray-500 mb-6\">{errorMessage}</p>\n        <button\n          onClick={() => window.location.reload()}\n          className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n        >\n          やり直す\n        </button>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"text-center py-8\">\n      <div className=\"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 mb-6\">\n        <CheckCircle className=\"h-10 w-10 text-green-600\" />\n      </div>\n      <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">登録完了！</h3>\n      <p className=\"text-gray-600 mb-8\">\n        これですべての手続きが完了しました。<br />\n        ダッシュボードへお進みください。\n      </p>\n\n      <div className=\"space-y-4\">\n        <Link\n          href=\"/\"\n          className=\"inline-flex w-full justify-center py-3 px-4 border border-transparent text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm\"\n        >\n          ダッシュボードへ\n        </Link>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/_components/RegisterConfirmStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/_components/RegisterParentStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/onboarding/RegistrationWizard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/onboarding/_components/SetPasswordStep.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/onboarding/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/register/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":34,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":34,"endColumn":17}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { Input } from '@/components/ui/input'\nimport { sendMagicLink } from '@/app/actions/auth'\nimport { signInWithGoogle } from '@/app/login/actions'\nimport Link from 'next/link'\nimport { motion } from 'framer-motion'\n\n\nexport default function RegisterPage() {\n  const [email, setEmail] = useState('')\n  const [isSubmitted, setIsSubmitted] = useState(false)\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [errorCode, setErrorCode] = useState('') // Added errorCode state\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setErrorCode('') // Reset errorCode\n    setLoading(true)\n\n    try {\n      const result = await sendMagicLink(email)\n      if (result.success) {\n        setIsSubmitted(true)\n      } else {\n        setError(result.message || 'メール送信に失敗しました')\n        if (result.code) { // Check for result.code\n          setErrorCode(result.code) // Set errorCode\n        }\n      }\n    } catch (err) {\n      setError('予期せぬエラーが発生しました')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (isSubmitted) {\n    return (\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"w-full max-w-md mx-auto space-y-8 text-center\"\n      >\n        <h2 className=\"text-2xl font-bold text-gray-900\">メールを確認してください</h2>\n        <p className=\"mt-4 text-gray-600\">\n          <strong>{email}</strong> 宛に確認メールを送信しました。<br />\n          メール内のリンクをクリックして、登録手続きへ進んでください。\n        </p>\n        <div className=\"mt-6 text-sm text-gray-500\">\n          メールが届かない場合は、迷惑メールフォルダをご確認ください。\n        </div>\n      </motion.div>\n    )\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"w-full max-w-md mx-auto space-y-8\"\n    >\n      <div className=\"text-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">新規入会</h2>\n        <p className=\"mt-2 text-sm text-gray-600\">\n          まずはメールアドレスを入力してください。<br />\n          ご本人確認のためのメールを送信します。\n        </p>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"mt-8 space-y-6\">\n        <button\n          type=\"button\"\n          onClick={() => signInWithGoogle()}\n          className=\"flex w-full items-center justify-center gap-3 rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-semibold text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500\"\n        >\n          <svg className=\"h-5 w-5\" viewBox=\"0 0 24 24\">\n            <path\n              d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n              fill=\"#4285F4\"\n            />\n            <path\n              d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n              fill=\"#34A853\"\n            />\n            <path\n              d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z\"\n              fill=\"#FBBC05\"\n            />\n            <path\n              d=\"M12 5.38c1.62 0 3.06.56 4.21 1.66l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n              fill=\"#EA4335\"\n            />\n          </svg>\n          Googleで登録\n        </button>\n\n        <div className=\"relative my-6\">\n          <div className=\"absolute inset-0 flex items-center\">\n            <span className=\"w-full border-t border-gray-300\"></span>\n          </div>\n          <div className=\"relative flex justify-center text-sm\">\n            <span className=\"bg-white px-2 text-gray-500\">またはメールアドレスで登録</span>\n          </div>\n        </div>\n\n        <div>\n          <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n            メールアドレス\n          </label>\n          <div className=\"mt-1\">\n            <Input\n              id=\"email\"\n              name=\"email\"\n              type=\"email\"\n              autoComplete=\"email\"\n              required\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              placeholder=\"example@email.com\"\n              disabled={loading}\n              className=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n            />\n          </div>\n        </div>\n\n        {error && (\n          <div className=\"bg-red-50 border border-red-200 rounded-md p-4 space-y-3\">\n            <div className=\"text-red-600 text-sm text-center font-medium\">\n              {error}\n            </div>\n            {errorCode === 'ALREADY_REGISTERED' && (\n              <div className=\"flex flex-col space-y-2 mt-2\">\n                <Link\n                  href=\"/login\"\n                  className=\"text-center text-sm text-indigo-600 hover:text-indigo-500 font-medium\"\n                >\n                  ログイン画面へ移動\n                </Link>\n                <Link\n                  href=\"/forgot-password\"\n                  className=\"text-center text-sm text-gray-500 hover:text-gray-700 underline\"\n                >\n                  パスワードをお忘れの方\n                </Link>\n              </div>\n            )}\n          </div>\n        )}\n\n        <div>\n          <button\n            type=\"submit\"\n            disabled={loading}\n            className={`group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white ${loading ? 'bg-indigo-400 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700'\n              } focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200`}\n          >\n            {loading ? '送信中...' : '確認メールを送信'}\n          </button>\n        </div>\n      </form>\n    </motion.div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/(auth)/update-password/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":37,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { motion } from 'framer-motion'\nimport { createClient } from '@/lib/supabase/client'\nimport Link from 'next/link'\nimport { Input } from '@/components/ui/input'\nimport { Loader2, ArrowLeft } from 'lucide-react'\nimport { useRouter } from 'next/navigation'\n\nexport default function UpdatePasswordPage() {\n  const [password, setPassword] = useState('')\n  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle')\n  const [errorMessage, setErrorMessage] = useState('')\n  const router = useRouter()\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!password) return\n\n    setStatus('loading')\n    setErrorMessage('')\n\n    try {\n      const supabase = createClient()\n      const { error } = await supabase.auth.updateUser({ password })\n\n      if (!error || error.message.includes('New password should be different')) {\n        setStatus('success')\n        setTimeout(() => {\n          router.push('/')\n        }, 3000)\n      } else {\n        setStatus('error')\n        setErrorMessage(error.message || 'パスワードの更新に失敗しました')\n      }\n    } catch (e) {\n      setStatus('error')\n      setErrorMessage('予期せぬエラーが発生しました')\n    }\n  }\n\n  if (status === 'success') {\n    return (\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"w-full max-w-md mx-auto space-y-8 text-center\"\n      >\n        <h2 className=\"text-2xl font-bold text-gray-900\">パスワードを更新しました</h2>\n        <p className=\"mt-4 text-gray-600\">\n          新しいパスワードの設定が完了しました。<br />\n          トップページへ移動します...\n        </p>\n      </motion.div>\n    )\n  }\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"w-full max-w-md mx-auto space-y-8\"\n    >\n      <div className=\"text-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">新しいパスワードの設定</h2>\n        <p className=\"mt-2 text-sm text-gray-600\">\n          新しいパスワードを入力してください。\n        </p>\n      </div>\n\n      <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit}>\n        <div>\n          <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\n            新しいパスワード\n          </label>\n          <div className=\"mt-1\">\n            <Input\n              id=\"password\"\n              name=\"password\"\n              type=\"password\"\n              required\n              minLength={8}\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm\"\n              placeholder=\"8文字以上\"\n            />\n          </div>\n        </div>\n\n        {status === 'error' && (\n          <div className=\"text-red-600 text-sm text-center\">\n            {errorMessage}\n          </div>\n        )}\n\n        <div>\n          <button\n            type=\"submit\"\n            disabled={status === 'loading'}\n            className=\"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50\"\n          >\n            {status === 'loading' ? (\n              <Loader2 className=\"animate-spin h-5 w-5\" />\n            ) : (\n              'パスワードを変更する'\n            )}\n          </button>\n        </div>\n\n        <div className=\"text-center\">\n          <Link\n            href=\"/login\"\n            className=\"inline-flex items-center text-sm font-medium text-gray-600 hover:text-gray-900\"\n          >\n            <ArrowLeft className=\"mr-2 h-4 w-4\" />\n            ログイン画面に戻る\n          </Link>\n        </div>\n      </form>\n    </motion.div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/admin.ts","messages":[{"ruleId":"no-var","severity":2,"message":"Unexpected var, use let or const instead.","line":18,"column":5,"nodeType":"VariableDeclaration","messageId":"unexpectedVar","endLine":18,"endColumn":42,"fix":{"range":[475,478],"text":"let"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3098,3101],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3098,3101],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":235,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":235,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7513,7516],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7513,7516],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"'use server'\n\nimport { createAdminClient } from '@/lib/supabase/admin'\nimport { calculateGrade } from '@/lib/grade-utils'\nimport { getTargetFiscalYear } from '@/lib/fiscal-year'\nimport { requireOfficer } from '@/lib/security'\n\ntype ImportResult = {\n  success: boolean\n  createdCount: number\n  failedCount: number\n  logs: string[]\n  gradeSummary?: Record<string, number>\n}\n\nconst toHiragana = (str: string) => {\n  return str.replace(/[\\u30a1-\\u30f6]/g, function (match) {\n    var chr = match.charCodeAt(0) - 0x60;\n    return String.fromCharCode(chr);\n  });\n}\n\nconst parseLine = (line: string) => {\n  let parts = line.split(',').map(s => s.trim())\n  if (parts.length === 1 && /\\s/.test(line)) {\n    parts = line.split(/\\s+/).map(s => s.trim()).filter(Boolean)\n  }\n  return parts\n}\n\nexport async function importUsers(csvContent: string): Promise<ImportResult> {\n  await requireOfficer()\n  const supabase = createAdminClient()\n  const logs: string[] = []\n  const lines = csvContent.split('\\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'))\n  const createdUserIds: string[] = []\n\n  console.log(`[importUsers] Starting import for ${lines.length} lines`)\n  try {\n    for (const [index, line] of lines.entries()) {\n      const parts = parseLine(line)\n      let email, password, lastName, firstName, lastNameKana, firstNameKana\n\n      if (parts.length >= 6) {\n        [email, password, lastName, firstName, lastNameKana, firstNameKana] = parts\n      } else if (parts.length >= 4) {\n        [email, password, lastName, firstName] = parts\n        lastNameKana = ''\n        firstNameKana = ''\n      } else {\n        throw new Error(`無効な形式です (行:${index + 1}): \"${line}\"`)\n      }\n\n      const finalLastNameKana = toHiragana(lastNameKana || '')\n      const finalFirstNameKana = toHiragana(firstNameKana || '')\n\n      // 1. Create User\n      const { data: userData, error: userError } = await supabase.auth.admin.createUser({\n        email,\n        password,\n        email_confirm: true,\n      })\n\n      if (userError) {\n        throw new Error(`ユーザー作成失敗 (${email}): ${userError.message}`)\n      }\n      if (!userData.user) {\n        throw new Error(`ユーザー詳細が取得できませんでした (${email})`)\n      }\n\n      createdUserIds.push(userData.user.id)\n\n      // 2. Create Profile\n      const { error: profileError } = await supabase\n        .from('profiles')\n        .upsert({\n          id: userData.user.id,\n          email: email,\n          last_name: lastName,\n          first_name: firstName,\n          last_name_kana: finalLastNameKana,\n          first_name_kana: finalFirstNameKana,\n          full_name: `${lastName} ${firstName}`,\n          updated_at: new Date().toISOString(),\n        })\n\n      if (profileError) {\n        throw new Error(`プロフィール作成失敗 (${email}): ${profileError.message}`)\n      }\n\n      logs.push(`[SUCCESS] Registered: ${email} (${lastName} ${firstName})`)\n    }\n\n    console.log(`[importUsers] Successfully completed all ${createdUserIds.length} creations.`)\n    return {\n      success: true,\n      createdCount: createdUserIds.length,\n      failedCount: 0,\n      logs\n    }\n\n  } catch (err: any) {\n    console.error(`[importUsers] Error occurred: ${err.message}. Rolling back ${createdUserIds.length} users.`)\n    // ROLLBACK manually\n    for (const userId of createdUserIds) {\n      await supabase.auth.admin.deleteUser(userId)\n    }\n\n    return {\n      success: false,\n      createdCount: 0,\n      failedCount: lines.length,\n      logs: [`[FATAL ERROR] 処理を中断しロールバックしました: ${err.message}`, ...logs]\n    }\n  }\n}\n\nconst normalizeDate = (dateStr: string) => {\n  if (!dateStr) return null\n  // 1. Remove Zenkaku spaces and normalize characters\n  let str = dateStr.trim().replace(/　/g, ' ')\n\n  // 2. Handle \"YYYY年MM月DD日\" format\n  if (str.includes('年')) {\n    str = str.replace(/年/g, '/').replace(/月/g, '/').replace(/日/g, '')\n  }\n\n  // 3. Spilt by delimiter (slash or space)\n  const parts = str.split(/[\\/\\s-]/).filter(Boolean)\n  if (parts.length === 3) {\n    const y = parts[0]\n    const m = parts[1].padStart(2, '0')\n    const d = parts[2].padStart(2, '0')\n    return `${y}-${m}-${d}`\n  }\n\n  // Fallback to native Date if possible\n  const d = new Date(str)\n  if (!isNaN(d.getTime())) {\n    return d.toISOString().split('T')[0]\n  }\n\n  return null\n}\n\nconst normalizeGender = (genderStr: string) => {\n  if (!genderStr) return null\n  const s = genderStr.trim().toLowerCase()\n  if (s === 'male' || s === '男' || s === '男の子' || s === 'だんし' || s === '♂') return 'male'\n  if (s === 'female' || s === '女' || s === '女の子' || s === 'じょし' || s === '♀') return 'female'\n  if (s === 'other' || s === 'その他' || s === 'ほか') return 'other'\n  return null\n}\n\nexport async function importChildren(csvContent: string): Promise<ImportResult> {\n  await requireOfficer()\n  const supabase = createAdminClient()\n  const logs: string[] = []\n  const lines = csvContent.split('\\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'))\n  const createdChildIds: string[] = []\n  const gradeSummary: Record<string, number> = {}\n  const targetFiscalYear = await getTargetFiscalYear()\n\n  console.log(`[importChildren] Starting import for ${lines.length} lines. FiscalYear: ${targetFiscalYear}`)\n  try {\n    for (const [index, line] of lines.entries()) {\n      const parts = parseLine(line)\n      // parent_email, last_name, first_name, last_name_kana, first_name_kana, gender, birthday, allergies, notes\n      if (parts.length < 5) {\n        throw new Error(`無効な形式です (行:${index + 1}): \"${line}\"`)\n      }\n\n      const [parentEmail, lastName, firstName, lastNameKana, firstNameKana, gender, birthday, allergies, notes] = parts\n\n      // 1. Find parent profile id\n      const { data: profile, error: profileError } = await supabase\n        .from('profiles')\n        .select('id')\n        .eq('email', parentEmail)\n        .eq('email', parentEmail)\n        .single()\n\n      if (profileError || !profile) {\n        throw new Error(`保護者が見つかりません (${parentEmail})`)\n      }\n\n      // 2. Insert child\n      const finalLastNameKana = toHiragana(lastNameKana || '')\n      const finalFirstNameKana = toHiragana(firstNameKana || '')\n      const finalBirthday = normalizeDate(birthday)\n\n      const { data: childData, error: childError } = await supabase\n        .from('children')\n        .insert({\n          parent_id: profile.id,\n          last_name: lastName,\n          first_name: firstName,\n          last_name_kana: finalLastNameKana,\n          first_name_kana: finalFirstNameKana,\n          full_name: `${lastName} ${firstName}`,\n          gender: normalizeGender(gender),\n          birthday: finalBirthday,\n          allergies: allergies || '',\n          notes: notes || '',\n        })\n        .select()\n        .single()\n\n      if (childError) {\n        throw new Error(`子供の登録に失敗しました (${lastName} ${firstName}): ${childError.message}`)\n      }\n\n      if (childData) {\n        createdChildIds.push(childData.id)\n        // 3. Count grade\n        if (finalBirthday) {\n          const grade = calculateGrade(finalBirthday, targetFiscalYear)\n          gradeSummary[grade] = (gradeSummary[grade] || 0) + 1\n        } else {\n          gradeSummary['不明'] = (gradeSummary['不明'] || 0) + 1\n        }\n      }\n      logs.push(`[SUCCESS] Registered: ${lastName} ${firstName} (Parent: ${parentEmail})`)\n    }\n\n    console.log(`[importChildren] Successfully completed all ${createdChildIds.length} creations.`)\n    return {\n      success: true,\n      createdCount: createdChildIds.length,\n      failedCount: 0,\n      logs,\n      gradeSummary\n    }\n\n  } catch (err: any) {\n    console.error(`[importChildren] Error occurred: ${err.message}. Rolling back ${createdChildIds.length} records.`)\n    // ROLLBACK manually\n    for (const childId of createdChildIds) {\n      await supabase.from('children').delete().eq('id', childId)\n    }\n\n    return {\n      success: false,\n      createdCount: 0,\n      failedCount: lines.length,\n      logs: [`[FATAL ERROR] 処理を中断しロールバックしました: ${err.message}`, ...logs]\n    }\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/auth.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/common.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/debug.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/dev_seed.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'formData' is defined but never used. Allowed unused args must match /^_/u.","line":7,"column":39,"nodeType":null,"messageId":"unusedVar","endLine":7,"endColumn":47}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use server'\n\nimport { createClient } from '@/lib/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\nexport async function seedOfficerData(formData: FormData) {\n  const supabase = await createClient()\n  const { data: { user } } = await supabase.auth.getUser()\n\n  if (!user) return\n\n  // 1. Create Roles if not exist\n  const roles = [\n    { name: '会長', description: '子供会の代表者' },\n    { name: '会計', description: '金銭管理' },\n    { name: '書記', description: '議事録作成・記録' }\n  ]\n\n  for (const r of roles) {\n    const { data: existing } = await supabase.from('officer_roles').select('id').eq('name', r.name).single()\n    if (!existing) {\n      await supabase.from('officer_roles').insert(r)\n    }\n  }\n\n  // 2. Assign '会長' to current user\n  const { data: chairRole } = await supabase.from('officer_roles').select('id').eq('name', '会長').single()\n  if (chairRole) {\n    const { data: existingAssignment } = await supabase\n      .from('officer_role_assignments')\n      .select('id')\n      .eq('profile_id', user.id)\n      .eq('role_id', chairRole.id)\n      .eq('fiscal_year', 2025)\n      .single()\n\n    if (!existingAssignment) {\n      await supabase.from('officer_role_assignments').insert({\n        profile_id: user.id,\n        role_id: chairRole.id,\n        fiscal_year: 2025,\n        start_date: '2025-04-01',\n        end_date: '2026-03-31'\n      })\n    }\n\n    // 3. Create Tasks for Chair\n    const tasks = [\n      { title: '総会資料作成', description: '4月の総会に向けた資料を作成する', is_monthly: false, due_date: '2025-03-31' },\n      { title: '定例会開催', description: '毎月の定例会を主催する', is_monthly: true }\n    ]\n\n    for (const t of tasks) {\n      // Simple check to avoid dups\n      const { data: existTask } = await supabase.from('officer_tasks').select('id').eq('title', t.title).eq('role_id', chairRole.id).single()\n      if (!existTask) {\n        await supabase.from('officer_tasks').insert({\n          role_id: chairRole.id,\n          ...t\n        })\n      }\n    }\n  }\n\n  // Update user to be admin for convenience\n  await supabase.from('profiles').update({ is_admin: true }).eq('id', user.id)\n\n  revalidatePath('/')\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/events.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/forum.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":215,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":215,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5359,5362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5359,5362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\n\nimport { createClient } from '@/lib/supabase/server'\nimport { revalidatePath } from 'next/cache'\n\nexport async function createQuestion(formData: FormData) {\n  const supabase = await createClient()\n  const title = formData.get('title') as string\n  const content = formData.get('content') as string\n\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) throw new Error('Unauthorized')\n\n  const { data, error } = await supabase\n    .from('forum_questions')\n    .insert({\n      title,\n      content,\n      profile_id: user.id\n    })\n    .select()\n    .single()\n\n  if (error) {\n    console.error('Error creating question:', error)\n    return { success: false, message: '質問の作成に失敗しました' }\n  }\n\n  revalidatePath('/forum')\n  return { success: true, data }\n}\n\nexport async function updateQuestion(formData: FormData) {\n  const supabase = await createClient()\n  const id = formData.get('id') as string\n  const title = formData.get('title') as string\n  const content = formData.get('content') as string\n  const is_resolved = formData.get('is_resolved') === 'true'\n\n  const { error } = await supabase\n    .from('forum_questions')\n    .update({ title, content, is_resolved })\n    .eq('id', id)\n\n  if (error) {\n    console.error('Error updating question:', error)\n    return { success: false, message: '質問の更新に失敗しました' }\n  }\n\n  revalidatePath('/forum')\n  revalidatePath(`/forum/${id}`)\n  return { success: true }\n}\n\nexport async function deleteQuestion(id: string) {\n  const supabase = await createClient()\n  const { error } = await supabase\n    .from('forum_questions')\n    .delete()\n    .eq('id', id)\n\n  if (error) {\n    console.error('Error deleting question:', error)\n    return { success: false, message: '質問の削除に失敗しました' }\n  }\n\n  revalidatePath('/forum')\n  return { success: true }\n}\n\nexport async function createAnswer(formData: FormData) {\n  const supabase = await createClient()\n  const question_id = formData.get('question_id') as string\n  const content = formData.get('content') as string\n\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) throw new Error('Unauthorized')\n\n  const { error } = await supabase\n    .from('forum_answers')\n    .insert({\n      question_id,\n      content,\n      profile_id: user.id\n    })\n\n  if (error) {\n    console.error('Error creating answer:', error)\n    return { success: false, message: '回答の投稿に失敗しました' }\n  }\n\n  revalidatePath(`/forum/${question_id}`)\n  return { success: true }\n}\n\nexport async function toggleReaction(target_type: 'question' | 'answer', target_id: string, emoji: string) {\n  const supabase = await createClient()\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) throw new Error('Unauthorized')\n\n  // Check if already exists\n  const { data: existing } = await supabase\n    .from('forum_reactions')\n    .select('id')\n    .eq('profile_id', user.id)\n    .eq('emoji', emoji)\n    .eq(target_type === 'question' ? 'question_id' : 'answer_id', target_id)\n    .maybeSingle()\n\n  if (existing) {\n    // Remove\n    await supabase.from('forum_reactions').delete().eq('id', existing.id)\n  } else {\n    // Add\n    await supabase.from('forum_reactions').insert({\n      [target_type === 'question' ? 'question_id' : 'answer_id']: target_id,\n      profile_id: user.id,\n      emoji\n    })\n  }\n\n  // Revalidate appropriately\n  // For simplicity, we can't easily revalidate the specific forum detail if we don't know the question_id\n  // But usually questions/answers are on the same page.\n  revalidatePath('/forum', 'layout')\n  return { success: true }\n}\n\nexport async function getQuestions(query?: string) {\n  const supabase = await createClient()\n  let dbQuery = supabase\n    .from('forum_questions')\n    .select(`\n      *,\n      profiles (\n        first_name,\n        last_name\n      ),\n      forum_answers (\n        id,\n        content,\n        created_at,\n        profiles (\n          first_name,\n          last_name\n        )\n      ),\n      forum_reactions (emoji)\n    `)\n\n  if (query) {\n    dbQuery = dbQuery.or(`title.ilike.%${query}%,content.ilike.%${query}%`)\n  }\n\n  const { data, error } = await dbQuery.order('created_at', { ascending: false })\n\n  if (error) {\n    console.error('Error fetching questions:', {\n      message: error.message,\n      details: error.details,\n      hint: error.hint,\n      code: error.code\n    })\n    return []\n  }\n\n  return data\n}\n\nexport async function getQuestionDetail(id: string) {\n  const supabase = await createClient()\n  const { data, error } = await supabase\n    .from('forum_questions')\n    .select(`\n      *,\n      profiles (\n        first_name,\n        last_name\n      ),\n      forum_answers (\n        *,\n        profiles (first_name, last_name),\n        forum_reactions (*)\n      ),\n      forum_reactions (*)\n    `)\n    .eq('id', id)\n    .single()\n\n  if (error) {\n    console.error('Error fetching question detail:', error)\n    return null\n  }\n\n  return data\n}\n\n/**\n * 回答が0件の質問の数を取得する\n */\nexport async function getUnansweredCount() {\n  const supabase = await createClient()\n\n  // 質問とその回答（のIDのみ）を取得\n  const { data, error } = await supabase\n    .from('forum_questions')\n    .select('id, forum_answers(id)')\n\n  if (error) {\n    console.error('Error fetching unanswered count:', error)\n    return 0\n  }\n\n  // 回答リストが空、または存在しないものをカウント\n  const unanswered = data.filter(q => !q.forum_answers || (q.forum_answers as any[]).length === 0)\n  return unanswered.length\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/meetings.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[688,691],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[688,691],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[696,699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[696,699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1326,1329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1326,1329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":50,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":50,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1334,1337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1334,1337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { createClient } from '@/lib/supabase/server'\n\n// --- Regular Meeting Schedule ---\n\nexport async function getRegularMeetings(year: number) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from('regular_meetings')\n    .select('*, meeting_agendas(*)')\n    .eq('target_year', year)\n    .order('target_month', { ascending: true })\n\n  if (error) {\n    console.error('Error fetching regular meetings:', error)\n    return []\n  }\n\n  // Client-side sort for agendas to be safe\n  const sortedData = data.map(meeting => ({\n    ...meeting,\n    meeting_agendas: meeting.meeting_agendas?.sort((a: any, b: any) =>\n      (a.display_order - b.display_order) || (new Date(a.created_at).getTime() - new Date(b.created_at).getTime())\n    ) || []\n  }))\n\n  return sortedData\n}\n\nexport async function getRegularMeeting(id: string) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from('regular_meetings')\n    .select('*, meeting_agendas(*)')\n    .eq('id', id)\n    .single()\n\n  if (error) {\n    console.error('Error fetching regular meeting:', error)\n    return null\n  }\n\n  // Client-side sort for agendas to be safe\n  const sortedData = {\n    ...data,\n    meeting_agendas: data.meeting_agendas?.sort((a: any, b: any) =>\n      (a.display_order - b.display_order) || (new Date(a.created_at).getTime() - new Date(b.created_at).getTime())\n    ) || []\n  }\n\n  return sortedData\n}\n\nexport async function upsertRegularMeeting(formData: FormData) {\n  const supabase = await createClient()\n\n  const id = formData.get('id') as string // Update if exists\n  const target_year = parseInt(formData.get('target_year') as string)\n  const target_month = parseInt(formData.get('target_month') as string)\n  const scheduled_date = formData.get('scheduled_date') as string\n  const start_time = formData.get('start_time') as string\n  const location = formData.get('location') as string\n  const description = formData.get('description') as string\n\n  const payload = {\n    target_year,\n    target_month,\n    scheduled_date: scheduled_date || null,\n    start_time: start_time || null,\n    location,\n    description,\n  }\n\n  let error\n  if (id) {\n    const res = await supabase\n      .from('regular_meetings')\n      .update(payload)\n      .eq('id', id)\n    error = res.error\n  } else {\n    // Check if one already exists for this year/month to prevent duplicates (optional but good UI assumes 1:1)\n    // For now we just insert.\n    const res = await supabase\n      .from('regular_meetings')\n      .insert(payload)\n    error = res.error\n  }\n\n  if (error) {\n    console.error('Upsert meeting error:', error)\n    return { success: false, message: '定例会の保存に失敗しました: ' + error.message }\n  }\n\n  revalidatePath('/admin/meetings')\n  return { success: true, message: '定例会情報を保存しました' }\n}\n\n// --- Meeting Agendas ---\n\nexport async function getMeetingAgendas(meetingId: string) {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from('meeting_agendas')\n    .select('*')\n    .eq('meeting_id', meetingId)\n    .order('display_order', { ascending: true })\n    .order('created_at', { ascending: true })\n\n  if (error) {\n    console.error('Error fetching agendas:', error)\n    return []\n  }\n\n  return data\n}\n\nexport async function upsertMeetingAgenda(formData: FormData) {\n  const supabase = await createClient()\n\n  const id = formData.get('id') as string\n  const meeting_id = formData.get('meeting_id') as string\n  const title = formData.get('title') as string\n  const description = formData.get('description') as string\n  const display_order = parseInt(formData.get('display_order') as string) || 0\n\n  const payload = {\n    meeting_id,\n    title,\n    description: description || null,\n    display_order,\n  }\n\n  let error\n  if (id) {\n    const res = await supabase\n      .from('meeting_agendas')\n      .update(payload)\n      .eq('id', id)\n    error = res.error\n  } else {\n    const res = await supabase\n      .from('meeting_agendas')\n      .insert(payload)\n    error = res.error\n  }\n\n  if (error) {\n    console.error('Upsert agenda error:', error)\n    return { success: false, message: '議題の保存に失敗しました: ' + error.message }\n  }\n\n  revalidatePath('/admin/meetings')\n  return { success: true, message: '議題を保存しました' }\n}\n\nexport async function deleteMeetingAgenda(formData: FormData) {\n  const supabase = await createClient()\n  const id = formData.get('id') as string\n\n  const { error } = await supabase\n    .from('meeting_agendas')\n    .delete()\n    .eq('id', id)\n\n  if (error) {\n    console.error('Delete agenda error:', error)\n    return { success: false, message: '議題の削除に失敗しました: ' + error.message }\n  }\n\n  revalidatePath('/admin/meetings')\n  return { success: true, message: '議題を削除しました' }\n}\n\nexport async function copyAgendasFromPreviousYear(targetMeetingId: string) {\n  const supabase = await createClient()\n\n  // 1. Get Target Meeting Info\n  const { data: targetMeeting, error: targetError } = await supabase\n    .from('regular_meetings')\n    .select('*')\n    .eq('id', targetMeetingId)\n    .single()\n\n  if (targetError || !targetMeeting) {\n    return { success: false, message: '対象の定例会が見つかりません' }\n  }\n\n  const prevYear = targetMeeting.target_year - 1\n  const month = targetMeeting.target_month\n\n  // 2. Find Previous Year Meeting\n  // We assume there's only one meeting for that month.\n  const { data: prevMeeting, error: prevError } = await supabase\n    .from('regular_meetings')\n    .select('id')\n    .eq('target_year', prevYear)\n    .eq('target_month', month)\n    .single() // If multiple, take one. If none, error.\n\n  if (prevError || !prevMeeting) {\n    return { success: false, message: '昨年度の同月の定例会データが見つかりません' }\n  }\n\n  // 3. Get Agendas from Previous Year\n  const { data: prevAgendas, error: agendasError } = await supabase\n    .from('meeting_agendas')\n    .select('title, description, display_order') // Don't select ID or timestamps\n    .eq('meeting_id', prevMeeting.id)\n\n  if (agendasError) {\n    return { success: false, message: '昨年度の議題の取得に失敗しました' }\n  }\n\n  if (!prevAgendas || prevAgendas.length === 0) {\n    return { success: false, message: '昨年度の定例会にはコピーできる議題がありません' }\n  }\n\n  // 4. Insert into Current Meeting\n  const newAgendas = prevAgendas.map(agenda => ({\n    meeting_id: targetMeetingId,\n    title: agenda.title,\n    description: agenda.description,\n    display_order: agenda.display_order\n  }))\n\n  const { error: insertError } = await supabase\n    .from('meeting_agendas')\n    .insert(newAgendas)\n\n  if (insertError) {\n    return { success: false, message: '議題のコピーに失敗しました: ' + insertError.message }\n  }\n\n  revalidatePath('/admin/meetings')\n  return { success: true, message: `昨年度から${newAgendas.length}件の議題をコピーしました` }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/organization.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/profile.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/actions/rsvp.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/accounting/[id]/edit/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/accounting/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/accounting/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'currentYear' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":8,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":8,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link'\nimport { getFiscalReports } from '@/app/admin/actions/accounting'\nimport { getOrganizationSettings } from '@/app/admin/actions/settings'\n\nexport default async function AccountingListPage() {\n  const reports = await getFiscalReports()\n  const settings = await getOrganizationSettings()\n  const currentYear = settings?.fiscal_year || new Date().getFullYear()\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight text-foreground\">会計報告</h1>\n          <p className=\"text-muted-foreground text-sm\">決算報告書および予算案の管理</p>\n        </div>\n        <Link\n          href=\"/admin/accounting/new\"\n          className=\"inline-flex items-center justify-center rounded-md text-sm font-bold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-6 shadow-sm\"\n        >\n          新規作成\n        </Link>\n      </div>\n\n      <div className=\"grid grid-cols-1 gap-4\">\n        {reports.length === 0 ? (\n          <div className=\"bg-card border border-border p-16 rounded-xl text-center shadow-sm\">\n            <p className=\"text-muted-foreground\">会計報告がまだありません。「新規作成」から始めましょう。</p>\n          </div>\n        ) : (\n          reports.map((report) => (\n            <div key={report.id} className=\"bg-card border border-border p-5 rounded-xl flex items-center justify-between group hover:border-primary/30 hover:shadow-md transition-all\">\n              <div className=\"space-y-2\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\">\n                    {report.fiscal_year}年度\n                  </span>\n                  <span className={`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent ${report.report_type === 'settlement'\n                      ? 'bg-primary/10 text-primary'\n                      : 'bg-muted text-muted-foreground'\n                    }`}>\n                    {report.report_type === 'settlement' ? '決算報告' : '予算案'}\n                  </span>\n                </div>\n                <h3 className=\"text-lg font-bold text-foreground\">{report.title}</h3>\n                <p className=\"text-xs text-muted-foreground\">最終更新: {new Date(report.updated_at).toLocaleDateString()}</p>\n              </div>\n              <div className=\"flex gap-2\">\n                <Link\n                  href={`/admin/accounting/${report.id}/edit`}\n                  className=\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10\"\n                >\n                  <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\" /></svg>\n                  <span className=\"sr-only\">編集</span>\n                </Link>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/accounting.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'auditError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":54,"column":42,"nodeType":null,"messageId":"unusedVar","endLine":54,"endColumn":52},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'accountingError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":64,"column":47,"nodeType":null,"messageId":"unusedVar","endLine":64,"endColumn":62},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":70,"column":3,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":70,"endColumn":16,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2021,2034],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2104,2107],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2104,2107],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'auditorError' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":77,"column":44,"nodeType":null,"messageId":"unusedVar","endLine":77,"endColumn":56},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":84,"column":3,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":84,"endColumn":16,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[2669,2682],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":85,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":85,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2714,2717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2714,2717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\n\nimport { createClient } from '@/lib/supabase/server'\nimport { revalidatePath } from 'next/cache'\nimport { requireOfficer } from '@/lib/security'\n\nexport type AccountingItem = {\n  id?: string\n  category: 'income' | 'expense'\n  item_name: string\n  budget_amount: number\n  actual_amount: number\n  description: string\n  sort_order: number\n}\n\nexport type FiscalReportPayload = {\n  fiscal_year: number\n  report_type: 'settlement' | 'budget'\n  title: string\n  accountant_name: string\n  auditor_names: string[]\n  report_date: string\n  is_audited: boolean\n  items: AccountingItem[]\n}\n\nexport async function getFiscalReports(year?: number) {\n  await requireOfficer()\n  const supabase = await createClient()\n  let query = supabase.from('fiscal_reports').select('*').order('fiscal_year', { ascending: false })\n\n  if (year) {\n    query = query.eq('fiscal_year', year)\n  }\n\n  const { data, error } = await query\n  if (error) {\n    console.error('Error fetching fiscal reports:', error)\n    return []\n  }\n  return data\n}\n\nexport async function getAccountingInfo(fiscalYear: number) {\n  const supabase = await createClient()\n\n  const { data: { user } } = await supabase.auth.getUser()\n  if (!user) {\n    return { canAudit: false, accountantName: null }\n  }\n\n  // 1. Check if current user has audit role for the given year\n  const { data: auditAssignments, error: auditError } = await supabase\n    .from('officer_role_assignments')\n    .select('role_id, officer_roles!inner(is_audit)')\n    .eq('fiscal_year', fiscalYear)\n    .eq('profile_id', user.id)\n    .eq('officer_roles.is_audit', true)\n\n  const canAudit = (auditAssignments && auditAssignments.length > 0) || false\n\n  // 2. Find the user assigned to the accounting role for the given year\n  const { data: accountingAssignments, error: accountingError } = await supabase\n    .from('officer_role_assignments')\n    .select('profiles!inner(full_name), officer_roles!inner(is_accounting)')\n    .eq('fiscal_year', fiscalYear)\n    .eq('officer_roles.is_accounting', true)\n\n  // @ts-ignore\n  const accountantName = accountingAssignments?.flatMap((assignment: any) => {\n    const profiles = assignment.profiles\n    return Array.isArray(profiles) ? profiles.map(p => p.full_name) : [profiles?.full_name]\n  }).filter((name): name is string => !!name).join('／') || null\n\n  // 3. Check if current user is an auditor and get their name\n  const { data: currentAuditorDocs, error: auditorError } = await supabase\n    .from('officer_role_assignments')\n    .select('profiles!inner(full_name), officer_roles!inner(is_audit)')\n    .eq('fiscal_year', fiscalYear)\n    .eq('profile_id', user.id)\n    .eq('officer_roles.is_audit', true)\n\n  // @ts-ignore\n  const currentAuditorProfile: any = currentAuditorDocs?.[0]?.profiles\n  const currentAuditorName = currentAuditorProfile?.full_name || null\n\n  return { canAudit, accountantName, currentAuditorName }\n}\n\nexport async function getFiscalReportWithItems(id: string) {\n  await requireOfficer()\n  const supabase = await createClient()\n\n  const { data: report, error: reportError } = await supabase\n    .from('fiscal_reports')\n    .select('*')\n    .eq('id', id)\n    .single()\n\n  if (reportError) {\n    console.error('Error fetching report:', reportError)\n    return null\n  }\n\n  const { data: items, error: itemsError } = await supabase\n    .from('accounting_items')\n    .select('*')\n    .eq('report_id', id)\n    .order('sort_order', { ascending: true })\n\n  if (itemsError) {\n    console.error('Error fetching items:', itemsError)\n    return { ...report, items: [] }\n  }\n\n  return { ...report, items }\n}\n\nexport async function upsertFiscalReport(id: string | null, payload: FiscalReportPayload) {\n  await requireOfficer()\n  const supabase = await createClient()\n  const { items, ...reportData } = payload\n\n  let reportId = id\n\n  if (id) {\n    // Update report body\n    const { error: updateError } = await supabase\n      .from('fiscal_reports')\n      .update(reportData)\n      .eq('id', id)\n\n    if (updateError) {\n      return { success: false, message: '基本情報の更新に失敗しました: ' + updateError.message }\n    }\n  } else {\n    // Insert report body\n    const { data: newReport, error: insertError } = await supabase\n      .from('fiscal_reports')\n      .insert(reportData)\n      .select()\n      .single()\n\n    if (insertError) {\n      return { success: false, message: '基本情報の作成に失敗しました: ' + insertError.message }\n    }\n    reportId = newReport.id\n  }\n\n  if (!reportId) return { success: false, message: 'IDの取得に失敗しました' }\n\n  // Handle Items (Delete and Re-insert for simplicity in this case)\n  // In a more complex production app, we'd do a proper diff/upsert\n  const { error: deleteError } = await supabase\n    .from('accounting_items')\n    .delete()\n    .eq('report_id', reportId)\n\n  if (deleteError) {\n    return { success: false, message: '項目の更新準備に失敗しました: ' + deleteError.message }\n  }\n\n  const itemsWithReportId = items.map(item => ({\n    ...item,\n    report_id: reportId\n  }))\n\n  const { error: itemsError } = await supabase\n    .from('accounting_items')\n    .insert(itemsWithReportId)\n\n  if (itemsError) {\n    return { success: false, message: '項目の保存に失敗しました: ' + itemsError.message }\n  }\n\n  revalidatePath('/admin/accounting')\n  return { success: true, message: '会計報告を保存しました', id: reportId }\n}\n\nexport async function deleteFiscalReport(id: string) {\n  await requireOfficer()\n  const supabase = await createClient()\n  const { error } = await supabase.from('fiscal_reports').delete().eq('id', id)\n\n  if (error) {\n    return { success: false, message: '削除に失敗しました: ' + error.message }\n  }\n\n  revalidatePath('/admin/accounting')\n  return { success: true, message: '会計報告を削除しました' }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/constitution.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/event.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/notification.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/officer.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/settings.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/template.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/actions/user.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'createAuthClient' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":26,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":42},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'email' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":14}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { redirect } from 'next/navigation'\nimport { createClient as createAuthClient } from '@/lib/supabase/server'\nimport { createClient } from '@supabase/supabase-js'\nimport { requireOfficer } from '@/lib/security'\n\n// Helper to get admin client\nconst getAdminClient = () => {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\n  const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\n  return createClient(supabaseUrl, supabaseServiceKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false\n    }\n  })\n}\n\n// --- Profile Management ---\n\nexport async function adminUpdateProfile(formData: FormData) {\n  await requireOfficer()\n\n  const supabase = getAdminClient()\n  const id = formData.get('id') as string\n\n  if (!id) {\n    return { success: false, message: 'IDが指定されていません' }\n  }\n\n  const lastName = formData.get('last_name') as string\n  const firstName = formData.get('first_name') as string\n  const lastNameKana = formData.get('last_name_kana') as string\n  const firstNameKana = formData.get('first_name_kana') as string\n  const phone = formData.get('phone') as string\n  const address = formData.get('address') as string\n  const email = formData.get('email') as string // Email update support if needed, mostly for display\n  // Note: updating email in auth.users is separate, here we update profile table.\n  // Ideally, email sync should happen, but for now we focus on profile fields.\n\n  const fullName = `${lastName} ${firstName}`\n\n  const { error } = await supabase\n    .from('profiles')\n    .update({\n      last_name: lastName,\n      first_name: firstName,\n      last_name_kana: lastNameKana,\n      first_name_kana: firstNameKana,\n      full_name: fullName,\n      phone,\n      address,\n      updated_at: new Date().toISOString()\n    })\n    .eq('id', id)\n\n  if (error) {\n    console.error('Update profile error:', error)\n    return { success: false, message: 'プロフィールの更新に失敗しました: ' + error.message }\n  }\n\n  revalidatePath(`/admin/users/${id}`)\n  return { success: true, message: 'プロフィールを更新しました' }\n}\n\n// --- Child Management ---\n\nexport async function adminAddChild(formData: FormData) {\n  await requireOfficer()\n\n  const supabase = getAdminClient()\n  const parentId = formData.get('parent_id') as string\n\n  if (!parentId) {\n    return { success: false, message: '親IDが指定されていません' }\n  }\n\n  const lastName = formData.get('last_name') as string\n  const firstName = formData.get('first_name') as string\n  const lastNameKana = formData.get('last_name_kana') as string\n  const firstNameKana = formData.get('first_name_kana') as string\n  const gender = formData.get('gender') as string\n  const birthday = formData.get('birthday') as string\n  const allergies = formData.get('allergies') as string\n  const notes = formData.get('notes') as string\n\n  const fullName = `${lastName} ${firstName}`\n\n  const { error } = await supabase\n    .from('children')\n    .insert({\n      parent_id: parentId,\n      last_name: lastName,\n      first_name: firstName,\n      last_name_kana: lastNameKana,\n      first_name_kana: firstNameKana,\n      full_name: fullName,\n      gender,\n      birthday: birthday || null,\n      allergies,\n      notes,\n    })\n\n  if (error) {\n    console.error('Add child error:', error)\n    return { success: false, message: 'お子様の追加に失敗しました: ' + error.message }\n  }\n\n  revalidatePath(`/admin/users/${parentId}`)\n  redirect(`/admin/users/${parentId}`)\n}\n\nexport async function adminUpdateChild(formData: FormData) {\n  await requireOfficer()\n\n  const supabase = getAdminClient()\n  const childId = formData.get('child_id') as string\n  const parentId = formData.get('parent_id') as string\n\n  if (!childId) {\n    return { success: false, message: '子供IDが指定されていません' }\n  }\n\n  const lastName = formData.get('last_name') as string\n  const firstName = formData.get('first_name') as string\n  const lastNameKana = formData.get('last_name_kana') as string\n  const firstNameKana = formData.get('first_name_kana') as string\n  const gender = formData.get('gender') as string\n  const birthday = formData.get('birthday') as string\n  const allergies = formData.get('allergies') as string\n  const notes = formData.get('notes') as string\n\n  const fullName = `${lastName} ${firstName}`\n\n  const { error } = await supabase\n    .from('children')\n    .update({\n      last_name: lastName,\n      first_name: firstName,\n      last_name_kana: lastNameKana,\n      first_name_kana: firstNameKana,\n      full_name: fullName,\n      gender,\n      birthday: birthday || null,\n      allergies,\n      notes,\n      updated_at: new Date().toISOString()\n    })\n    .eq('id', childId)\n\n  if (error) {\n    console.error('Update child error:', error)\n    return { success: false, message: 'お子様の更新に失敗しました: ' + error.message }\n  }\n\n  revalidatePath(`/admin/users/${parentId}`)\n  redirect(`/admin/users/${parentId}`)\n}\n\nexport async function adminDeleteChild(formData: FormData) {\n  await requireOfficer()\n\n  const supabase = getAdminClient()\n  const childId = formData.get('child_id') as string\n  const parentId = formData.get('parent_id') as string\n\n  if (!childId) return { success: false, message: 'IDが指定されていません' }\n\n  const { error } = await supabase\n    .from('children')\n    .delete()\n    .eq('id', childId)\n\n  if (error) {\n    console.error('Delete child error:', error)\n    return { success: false, message: '削除に失敗しました: ' + error.message }\n  }\n\n  revalidatePath(`/admin/users/${parentId}`)\n  return { success: true, message: '削除しました' }\n}\n\nexport async function adminDeleteAllChildrenFromParent(formData: FormData) {\n  await requireOfficer()\n\n  const supabase = getAdminClient()\n  const parentId = formData.get('parent_id') as string\n\n  if (!parentId) return { success: false, message: '保護者IDが指定されていません' }\n\n  // Perform physical delete for all children of this parent\n  const { error } = await supabase\n    .from('children')\n    .delete()\n    .eq('parent_id', parentId)\n\n  if (error) {\n    console.error('Delete all children error:', error)\n    return { success: false, message: 'お子様の一括削除に失敗しました: ' + error.message }\n  }\n\n  revalidatePath(`/admin/users/${parentId}`)\n  return { success: true, message: 'お子様を全員削除しました' }\n}\n\nexport async function adminDeleteProfile(formData: FormData) {\n  await requireOfficer()\n\n  const supabase = getAdminClient()\n  const profileId = formData.get('id') as string\n\n  if (!profileId) {\n    return { success: false, message: 'IDが指定されていません' }\n  }\n\n  // 1. Check if the user is currently or in future an officer\n  const currentYear = new Date().getFullYear() // Or use getTargetFiscalYear logic if preferred\n  const { data: assignments, error: assignmentsError } = await supabase\n    .from('officer_role_assignments')\n    .select('id, fiscal_year')\n    .eq('profile_id', profileId)\n    .gte('fiscal_year', currentYear) // Only block if they are assigned for current or future years\n    .limit(1)\n\n  if (assignmentsError) {\n    console.error('Check assignments error:', assignmentsError)\n    return { success: false, message: '役員情報の確認に失敗しました' }\n  }\n\n  if (assignments && assignments.length > 0) {\n    return { success: false, message: `現在または将来（${assignments[0].fiscal_year}年度など）の役員として登録されているため削除できません。先に役員情報を削除してください。` }\n  }\n\n  // 2. Cascade delete children\n  // (Instruction: 子供がいる場合は、子供を先に全て削除して、保護者を削除)\n  const { error: cascadeError } = await supabase\n    .from('children')\n    .delete()\n    .eq('parent_id', profileId)\n\n  if (cascadeError) {\n    console.error('Cascade delete children error:', cascadeError)\n    return { success: false, message: 'お子様の連動削除に失敗しました: ' + cascadeError.message }\n  }\n\n  // 3. Perform physical delete via Auth Admin (cascades to Profile if configured, or we delete profile explicitly)\n  // Deleting user from auth.users is the correct way to physically remove a user.\n  // Using Service Role Key allows this.\n  const { error } = await supabase.auth.admin.deleteUser(profileId)\n\n  if (error) {\n    // If auth delete fails (e.g. not found), try deleting profile directly just in case\n    console.error('Delete auth user error, trying profile delete:', error)\n    const { error: profileError } = await supabase\n      .from('profiles')\n      .delete()\n      .eq('id', profileId)\n\n    if (profileError) {\n      console.error('Delete profile error:', profileError)\n      return { success: false, message: '会員の削除に失敗しました: ' + profileError.message }\n    }\n    // Fallback succeeded\n  }\n\n  revalidatePath('/admin/members')\n  redirect('/admin/members?view=guardian')\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/constitution/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/events/[id]/edit/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/events/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1118,1121],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1118,1121],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1592,1595],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1592,1595],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1600,1603],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1600,1603],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1816,1819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1816,1819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4694,4697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4694,4697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7546,7549],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7546,7549],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\nimport { calculateGrade, getGradeOrder } from '@/lib/grade-utils'\nimport { getTargetFiscalYear } from '@/lib/fiscal-year'\nimport Link from 'next/link'\nimport PrintButton from '@/components/admin/PrintButton'\n\nexport default async function AdminEventDetailPage({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n  const supabase = await createClient()\n  const currentFiscalYear = await getTargetFiscalYear()\n\n  // Get event details\n  const { data: event } = await supabase\n    .from('events')\n    .select('*')\n    .eq('id', id)\n    .single()\n\n  if (!event) {\n    return <div>イベントが見つかりません</div>\n  }\n\n  // Get participants\n  const { data: participantsRaw } = await supabase\n    .from('event_participants')\n    .select(`\n        *,\n        profile:profiles(full_name, email, phone),\n        child:children(full_name, last_name, first_name, birthday)\n    `)\n    .eq('event_id', id)\n    .order('created_at', { ascending: true })\n\n  // Process participants for display and printing\n  const participants = (participantsRaw || []).map((p: any) => {\n    const child = p.child\n    const grade = child && child.birthday ? calculateGrade(child.birthday, currentFiscalYear) : ''\n    const gradeOrder = getGradeOrder(grade)\n    const childName = child ? `${child.last_name || ''} ${child.first_name || ''}`.trim() || child.full_name : '不明な子供'\n\n    return {\n      ...p,\n      childName,\n      grade,\n      gradeOrder,\n      profile: p.profile\n    }\n  })\n\n  // Sort by Grade Order then Child Name\n  participants.sort((a: any, b: any) => {\n    if (a.gradeOrder !== b.gradeOrder) {\n      return a.gradeOrder - b.gradeOrder\n    }\n    return a.childName.localeCompare(b.childName, 'ja')\n  })\n\n  const attendingParticipants = participants.filter((p: any) => p.status === 'attending')\n  const attendingCount = attendingParticipants.length\n\n  return (\n    <div className=\"print:p-8\">\n      {/* Screen View */}\n      <div className=\"print:hidden\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/admin/events\" className=\"text-gray-500 hover:text-gray-700\">← 戻る</Link>\n            <h2 className=\"text-xl font-semibold\">{event.title}</h2>\n          </div>\n          <div className=\"flex gap-2\">\n            <PrintButton label=\"参加者名簿を印刷\" />\n            <Link href={`/admin/events/${id}/edit`} className=\"inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\">編集</Link>\n          </div>\n        </div>\n\n        <div className=\"bg-white shadow overflow-hidden sm:rounded-lg mb-8\">\n          <div className=\"px-4 py-5 sm:px-6\">\n            <h3 className=\"text-base font-semibold leading-6 text-gray-900\">イベント詳細</h3>\n          </div>\n          <div className=\"border-t border-gray-200 px-4 py-5 sm:p-0\">\n            <dl className=\"sm:divide-y sm:divide-gray-200\">\n              <div className=\"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">日時</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0\">\n                  {event.is_tentative ? (\n                    <span className=\"text-amber-600 font-bold\">日付未定</span>\n                  ) : (\n                    new Date(event.scheduled_date).toLocaleDateString() + (event.start_time ? ` ${event.start_time.slice(0, 5)}` : '')\n                  )}\n                </dd>\n              </div>\n              <div className=\"py-4 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6\">\n                <dt className=\"text-sm font-medium text-gray-500\">場所</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0\">\n                  {event.location || '未定'}\n                </dd>\n              </div>\n            </dl>\n          </div>\n        </div>\n\n        <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n          <div className=\"px-4 py-5 sm:px-6 flex justify-between items-center\">\n            <h3 className=\"text-base font-semibold leading-6 text-gray-900\">参加者一覧（子供）</h3>\n            <div className=\"flex gap-4 text-sm\">\n              <span className=\"text-green-700 font-medium\">参加予定: {attendingCount}名</span>\n            </div>\n          </div>\n          <div className=\"border-t border-gray-200\">\n            <ul role=\"list\" className=\"divide-y divide-gray-200\">\n              {participants.length === 0 ? (\n                <li className=\"px-4 py-4 sm:px-6 text-gray-500 text-center\">参加者はまだいません</li>\n              ) : (\n                participants.map((participant: any) => (\n                  <li key={participant.id} className=\"px-4 py-4 sm:px-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex flex-col\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-bold text-gray-900 text-lg\">{participant.childName} <span className=\"text-xs font-normal text-gray-500\">さん</span></span>\n                          {participant.grade && <span className=\"inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10\">{participant.grade}</span>}\n                        </div>\n                        <p className=\"text-sm text-gray-500\">保護者: {participant.profile?.full_name || '名前なし'} ({participant.profile?.email})</p>\n                      </div>\n                      <div>\n                        {/* Status Badges Removed as per request */}\n                        {participant.status === 'declined' && (\n                          <span className=\"inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20\">欠席</span>\n                        )}\n                        {participant.status === 'maybe' && (\n                          <span className=\"inline-flex items-center rounded-md bg-yellow-50 px-2 py-1 text-xs font-medium text-yellow-800 ring-1 ring-inset ring-yellow-600/20\">未定</span>\n                        )}\n                      </div>\n                    </div>\n                  </li>\n                ))\n              )}\n            </ul>\n          </div>\n        </div>\n      </div>\n\n      {/* Print View Table */}\n      <div className=\"hidden print:block\">\n        <h1 className=\"text-2xl font-bold mb-2 text-center\">{event.title} 参加者名簿</h1>\n        <p className=\"text-right text-sm mb-4\">開催日: {event.is_tentative ? '未定' : new Date(event.scheduled_date).toLocaleDateString()}</p>\n\n        <table className=\"w-full text-left border-collapse border border-black\">\n          <thead>\n            <tr className=\"bg-gray-100\">\n              <th className=\"border border-black px-4 py-2 w-32\">学年</th>\n              <th className=\"border border-black px-4 py-2\">氏名</th>\n              <th className=\"border border-black px-4 py-2 w-48\">保護者氏名</th>\n              <th className=\"border border-black px-4 py-2 w-40\">連絡先</th>\n              <th className=\"border border-black px-4 py-2 w-24\">チェック</th>\n            </tr>\n          </thead>\n          <tbody>\n            {attendingParticipants.length === 0 ? (\n              <tr>\n                <td colSpan={5} className=\"border border-black px-4 py-8 text-center text-gray-500\">\n                  参加予定者はいません\n                </td>\n              </tr>\n            ) : (\n              attendingParticipants.map((p: any) => (\n                <tr key={p.id}>\n                  <td className=\"border border-black px-4 py-2\">{p.grade}</td>\n                  <td className=\"border border-black px-4 py-2 font-bold\">{p.childName}</td>\n                  <td className=\"border border-black px-4 py-2 text-sm\">{p.profile?.full_name}</td>\n                  <td className=\"border border-black px-4 py-2 text-sm\">{p.profile?.phone}</td>\n                  <td className=\"border border-black px-4 py-2\"></td>\n                </tr>\n              ))\n            )}\n          </tbody>\n        </table>\n        <div className=\"mt-4 text-right font-bold\">\n          合計: {attendingCount} 名\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/events/annual/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/events/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/events/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/meetings/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/meetings/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2089,2092],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2089,2092],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getRegularMeetings } from '@/app/actions/meetings'\nimport MeetingEditor from '@/components/admin/MeetingEditor'\nimport BulkExportButton from '@/components/admin/BulkExportButton'\nimport { ChevronLeft, ChevronRight } from 'lucide-react'\nimport Link from 'next/link'\n\nexport default async function RegularMeetingsPage({\n  searchParams,\n}: {\n  searchParams: { year?: string }\n}) {\n  const params = await searchParams // async access for Next.js 15\n  const today = new Date()\n  const currentFiscalYear = today.getMonth() < 3 ? today.getFullYear() - 1 : today.getFullYear()\n  const year = params.year ? parseInt(params.year) : currentFiscalYear\n\n  const meetings = await getRegularMeetings(year)\n\n  // Generate 12 months for the fiscal year (Apr -> Mar)\n  const months = []\n  for (let i = 0; i < 12; i++) {\n    const monthVal = ((3 + i) % 12) + 1 // 4, 5, ..., 12, 1, 2, 3\n    months.push(monthVal)\n  }\n\n  return (\n    <div className=\"max-w-5xl mx-auto p-6\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4\">\n        <h1 className=\"text-2xl font-bold text-foreground\">役員定例会</h1>\n        <div className=\"flex items-center gap-4\">\n          <BulkExportButton meetings={meetings} />\n\n          <div className=\"flex items-center gap-2\">\n            <Link\n              href={`/admin/meetings?year=${year - 1}`}\n              className=\"p-2 hover:bg-muted rounded-full transition-colors\"\n            >\n              <ChevronLeft size={20} className=\"text-muted-foreground hover:text-foreground\" />\n            </Link>\n            <span className=\"text-lg font-bold text-foreground\">{year}年度</span>\n            <Link\n              href={`/admin/meetings?year=${year + 1}`}\n              className=\"p-2 hover:bg-muted rounded-full transition-colors\"\n            >\n              <ChevronRight size={20} className=\"text-muted-foreground hover:text-foreground\" />\n            </Link>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid gap-6\">\n        {months.map(month => {\n          const meeting = meetings.find((m: any) => m.target_month === month)\n          return (\n            <MeetingEditor\n              key={month}\n              year={year}\n              month={month}\n              meeting={meeting}\n              agendas={meeting?.meeting_agendas || []}\n            />\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/members/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[960,963],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[960,963],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[990,993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[990,993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":51,"column":7,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":51,"endColumn":94,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1910,1997],"text":"// @ts-expect-error - Supabase types might verify this structure but let's be safe with check"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":52,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":52,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2040,2043],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2040,2043],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\nimport AdminPageHeader from '@/components/admin/AdminPageHeader'\nimport MemberTabs from '@/components/admin/members/MemberTabs'\nimport ChildList from '@/components/admin/members/ChildList'\nimport GuardianList from '@/components/admin/members/GuardianList'\nimport OfficerList from '@/components/admin/members/OfficerList'\nimport { getTargetFiscalYear } from '../actions/settings'\nimport { toWarekiYear } from '@/lib/date-utils'\n\nexport const dynamic = 'force-dynamic'\n\ntype ViewType = 'child' | 'guardian' | 'officer'\n\nexport default async function AdminMembersPage({\n  searchParams,\n}: {\n  searchParams: Promise<{ [key: string]: string | string[] | undefined }>\n}) {\n  const supabase = await createClient()\n  const params = await searchParams\n  const view = (params.view as ViewType) || 'child'\n  const currentFiscalYear = await getTargetFiscalYear()\n\n  // Common data needed for some views\n  let profiles: any[] = []\n  let assignments: any[] = []\n  let titleYear = ''\n\n  // Fetch settings for Wareki conversion if needed\n  const { data: settings } = await supabase.from('organization_settings').select('*').single()\n  const warekiEraName = settings?.wareki_era_name || '令和'\n  const warekiStartYear = settings?.wareki_start_year || 2019\n  titleYear = toWarekiYear(currentFiscalYear, warekiEraName, warekiStartYear)\n\n  // Permissions check\n  const { data: { user } } = await supabase.auth.getUser()\n  let canEdit = false\n\n  if (user) {\n    // Check if the current user has any officer role with edit permissions for this fiscal year\n    const { data: myRoles } = await supabase\n      .from('officer_role_assignments')\n      .select(`\n        role:officer_roles(can_edit_members)\n      `)\n      .eq('profile_id', user.id)\n      .eq('fiscal_year', currentFiscalYear)\n\n    // Check if any role has edit permission\n    if (myRoles && myRoles.length > 0) {\n      // @ts-ignore - Supabase types might verify this structure but let's be safe with check\n      canEdit = myRoles.some((assignment: any) => assignment.role?.can_edit_members === true)\n    }\n\n    // Fallback: Check if user is an admin in profiles (legacy support or super admin)\n    const { data: myProfile } = await supabase\n      .from('profiles')\n      .select('is_admin')\n      .eq('id', user.id)\n      .single()\n\n    if (myProfile?.is_admin) {\n      canEdit = true\n    }\n  }\n\n  if (view === 'child' || view === 'guardian') {\n    const { data } = await supabase\n      .from('profiles')\n      .select(`\n          *,\n          children (*)\n      `)\n      .order('joined_at', { ascending: false })\n    profiles = data || []\n  }\n\n  if (view === 'officer') {\n    const { data } = await supabase\n      .from('officer_role_assignments')\n      .select(`\n          *,\n          role:officer_roles(*),\n          profile:profiles(full_name, email, last_name_kana, first_name_kana, address, phone)\n      `)\n      .eq('fiscal_year', currentFiscalYear)\n\n    if (data) {\n      assignments = data.sort((a, b) => {\n        // Sort by role display_order (ascending)\n        const orderA = a.role?.display_order ?? 999\n        const orderB = b.role?.display_order ?? 999\n        if (orderA !== orderB) return orderA - orderB\n\n        // Then by created_at (descending)\n        return new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n      })\n    } else {\n      assignments = []\n    }\n  }\n\n  return (\n    <div>\n      <AdminPageHeader\n        title=\"会員名簿\"\n        description=\"会員（保護者）、お子様、および役員の名簿を管理します。\"\n      />\n\n      <div className=\"mt-8\">\n        <MemberTabs />\n\n        {view === 'child' && (\n          <ChildList profiles={profiles} targetFiscalYear={currentFiscalYear} canEdit={canEdit} />\n        )}\n\n        {view === 'guardian' && (\n          <GuardianList profiles={profiles} targetFiscalYear={currentFiscalYear} canEdit={canEdit} />\n        )}\n\n        {view === 'officer' && (\n          <OfficerList assignments={assignments} titleYear={titleYear} />\n        )}\n      </div>\n    </div>\n  )\n}\n\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/notifications/new/NotificationForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[168,171],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[168,171],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client'\n\nimport { useState } from 'react'\nimport { sendNotification } from '../../actions/notification'\nimport Link from 'next/link'\n\ntype Props = {\n  templates: any[]\n}\n\nexport default function NotificationForm({ templates }: Props) {\n  const [message, setMessage] = useState<string | null>(null)\n\n  // Basic template handling (client-side fill)\n  const handleTemplateChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n    const templateId = e.target.value\n    const template = templates.find(t => t.id === templateId)\n    if (template) {\n      const subjectInput = document.getElementById('subject') as HTMLInputElement\n      const bodyInput = document.getElementById('body') as HTMLTextAreaElement\n      if (subjectInput) subjectInput.value = template.subject\n      if (bodyInput) bodyInput.value = template.body\n    }\n  }\n\n  const handleSubmit = async (formData: FormData) => {\n    setMessage(null)\n    const result = await sendNotification(formData)\n\n    if (result && !result.success) {\n      setMessage(result.message)\n    }\n  }\n\n  return (\n    <form action={handleSubmit} className=\"space-y-6 bg-white p-6 shadow sm:rounded-md\">\n      {message && (\n        <div className=\"bg-red-50 border-red-200 text-red-700 px-4 py-3 rounded border\">\n          {message}\n        </div>\n      )}\n\n      <div>\n        <label htmlFor=\"template_id\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n          テンプレートを使用 (任意)\n        </label>\n        <div className=\"mt-2\">\n          <select\n            id=\"template_id\"\n            name=\"template_id\"\n            onChange={handleTemplateChange}\n            className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n          >\n            <option value=\"\">選択してください</option>\n            {templates?.map(t => (\n              <option key={t.id} value={t.id}>{t.name}</option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div>\n        <label htmlFor=\"subject\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n          件名\n        </label>\n        <div className=\"mt-2\">\n          <input\n            type=\"text\"\n            name=\"subject\"\n            id=\"subject\"\n            required\n            className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n          />\n        </div>\n      </div>\n\n      <div>\n        <label htmlFor=\"body\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n          本文\n        </label>\n        <div className=\"mt-2\">\n          <textarea\n            id=\"body\"\n            name=\"body\"\n            rows={10}\n            required\n            className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n          />\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-3 pt-4\">\n        <Link href=\"/admin/notifications\" className=\"rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\">\n          キャンセル\n        </Link>\n        <button\n          type=\"submit\"\n          className=\"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\"\n        >\n          配信する\n        </button>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/notifications/new/TemplateSelector.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/notifications/new/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":2,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":2,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\nimport Link from 'next/link'\nimport NotificationForm from './NotificationForm'\nimport AdminFormLayout from '@/components/admin/AdminFormLayout'\n\nexport default async function NewNotificationPage() {\n  const supabase = await createClient()\n  const { data: templates } = await supabase.from('notification_templates').select('*')\n\n  return (\n    <AdminFormLayout\n      title=\"お知らせ配信\"\n      backLink={{ href: '/admin/notifications', label: '配信一覧に戻る' }}\n    >\n      <NotificationForm templates={templates || []} />\n    </AdminFormLayout>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/notifications/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link'\nimport { createClient } from '@/lib/supabase/server'\n\nimport AdminPageHeader from '@/components/admin/AdminPageHeader'\n\nexport default async function NotificationsPage() {\n  const supabase = await createClient()\n  const { data: notifications } = await supabase\n    .from('notifications')\n    .select('*, notification_recipients(count)')\n    .order('sent_at', { ascending: false })\n\n  return (\n    <div>\n      <AdminPageHeader\n        title=\"お知らせ配信履歴\"\n        description=\"過去に配信したお知らせの一覧です。\"\n        action={{ label: '新規配信', href: '/admin/notifications/new' }}\n      />\n\n      <div className=\"overflow-hidden bg-white shadow sm:rounded-md\">\n        <ul role=\"list\" className=\"divide-y divide-gray-200\">\n          {notifications?.length === 0 ? (\n            <li className=\"px-4 py-4 sm:px-6 text-gray-500 text-center\">配信履歴がありません</li>\n          ) : (\n            notifications?.map((notification) => (\n              <li key={notification.id} className=\"block hover:bg-gray-50\">\n                <div className=\"px-4 py-4 sm:px-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <p className=\"truncate text-sm font-medium text-indigo-600\">{notification.subject}</p>\n                    <div className=\"ml-2 flex flex-shrink-0\">\n                      <p className=\"inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800\">\n                        {new Date(notification.sent_at).toLocaleString()}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"mt-2 sm:flex sm:justify-between\">\n                    <div className=\"sm:flex\">\n                      <p className=\"flex items-center text-sm text-gray-500\">\n                        配信数: {notification.notification_recipients?.[0]?.count ?? 0} 人\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </li>\n            ))\n          )}\n        </ul>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/officers/new/AssignmentForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[156,159],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[156,159],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[174,177],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[174,177],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client'\n\nimport { useState } from 'react'\nimport { assignOfficer } from '../../actions/officer'\nimport Link from 'next/link'\n\ntype Props = {\n  roles: any[]\n  profiles: any[]\n}\n\nexport default function AssignmentForm({ roles, profiles }: Props) {\n  const [message, setMessage] = useState<string | null>(null)\n\n  const handleSubmit = async (formData: FormData) => {\n    setMessage(null)\n    const result = await assignOfficer(formData)\n\n    if (result && !result.success) {\n      setMessage(result.message)\n    }\n  }\n\n  return (\n    <form action={handleSubmit} className=\"space-y-6 bg-white p-6 shadow sm:rounded-md\">\n      {message && (\n        <div className=\"bg-red-50 border-red-200 text-red-700 px-4 py-3 rounded border\">\n          {message}\n        </div>\n      )}\n\n      <div>\n        <label htmlFor=\"fiscal_year\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n          対象年度\n        </label>\n        <div className=\"mt-2\">\n          <input\n            type=\"number\"\n            name=\"fiscal_year\"\n            id=\"fiscal_year\"\n            defaultValue={2025}\n            required\n            className=\"block w-32 rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n          />\n        </div>\n      </div>\n\n      <div>\n        <label htmlFor=\"role_id\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n          役職\n        </label>\n        <div className=\"mt-2\">\n          <select\n            id=\"role_id\"\n            name=\"role_id\"\n            required\n            className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n          >\n            <option value=\"\">選択してください</option>\n            {roles?.map(role => (\n              <option key={role.id} value={role.id}>{role.name}</option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div>\n        <label htmlFor=\"profile_id\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n          会員\n        </label>\n        <div className=\"mt-2\">\n          <select\n            id=\"profile_id\"\n            name=\"profile_id\"\n            required\n            className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n          >\n            <option value=\"\">選択してください</option>\n            {profiles?.map(profile => (\n              <option key={profile.id} value={profile.id}>{profile.full_name} ({profile.email})</option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div>\n          <label htmlFor=\"start_date\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n            任期開始日\n          </label>\n          <div className=\"mt-2\">\n            <input\n              type=\"date\"\n              name=\"start_date\"\n              id=\"start_date\"\n              defaultValue=\"2025-04-01\"\n              className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n            />\n          </div>\n        </div>\n        <div>\n          <label htmlFor=\"end_date\" className=\"block text-sm font-medium leading-6 text-gray-900\">\n            任期終了日\n          </label>\n          <div className=\"mt-2\">\n            <input\n              type=\"date\"\n              name=\"end_date\"\n              id=\"end_date\"\n              defaultValue=\"2026-03-31\"\n              className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-3 pt-4\">\n        <Link href=\"/admin/officers\" className=\"rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\">\n          キャンセル\n        </Link>\n        <button\n          type=\"submit\"\n          className=\"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\"\n        >\n          任命する\n        </button>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/officers/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/officers/next-year/OfficerSelectionCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/officers/next-year/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AdminPageHeader' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":23},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1845,1848],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1845,1848],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1853,1856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1853,1856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3339,3342],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3339,3342],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4464,4467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4464,4467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5786,5789],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5786,5789],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\nimport { toWarekiYear } from '@/lib/date-utils'\nimport AdminPageHeader from '@/components/admin/AdminPageHeader'\nimport OfficerSelectionCard from './OfficerSelectionCard'\nimport PrintButton from '@/components/admin/PrintButton'\nimport Link from 'next/link'\nimport { getTargetFiscalYear } from '../../actions/settings'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function NextYearOfficerSelectionPage() {\n  const supabase = await createClient()\n\n  // Calculate Next Fiscal Year\n  const currentFiscalYear = await getTargetFiscalYear()\n  const nextFiscalYear = currentFiscalYear + 1\n\n  // Fetch Logic\n  const { data: settings } = await supabase.from('organization_settings').select('*').single()\n  const warekiEraName = settings?.wareki_era_name || '令和'\n  const warekiStartYear = settings?.wareki_start_year || 2019\n  const nextWarekiYear = toWarekiYear(nextFiscalYear, warekiEraName, warekiStartYear)\n\n  const { data: roles } = await supabase\n    .from('officer_roles')\n    .select('*')\n    .order('display_order', { ascending: true })\n    .order('name')\n\n  const { data: assignments } = await supabase\n    .from('officer_role_assignments')\n    .select(`\n        *,\n        role:officer_roles(name, display_order),\n        profile:profiles(id, full_name, email, last_name_kana, first_name_kana, address, phone)\n    `)\n    .eq('fiscal_year', nextFiscalYear)\n    // Sort for PDF\n    .order('fiscal_year', { ascending: false })\n\n  // Sort assignments in code if needed for PDF, but DB sort is better if possible.\n  // Since we query by fiscal_year, we just need to sort by role order.\n  // However officer_role_assignments does not have role display order directly, it's joined.\n  // We can sort in JS for the print view.\n  const sortedAssignments = (assignments || []).sort((a: any, b: any) => {\n    return (a.role?.display_order || 0) - (b.role?.display_order || 0)\n  })\n\n  const { data: profiles } = await supabase\n    .from('profiles')\n    .select('id, full_name, email, last_name_kana, first_name_kana')\n    .order('full_name')\n\n  return (\n    <div className=\"print:p-8\">\n      <div className=\"print:hidden\">\n        <div className=\"sm:flex sm:items-center sm:justify-between mb-8\">\n          <div>\n            <h1 className=\"text-xl font-semibold text-gray-900\">{`次年度(${nextWarekiYear}度) 役員選出`}</h1>\n            <p className=\"mt-2 text-sm text-gray-600\">\n              来年度の役員をあらかじめ選出・任命します。ここで選出された役員は、来年度の役員名簿に自動的に反映されます。\n            </p>\n          </div>\n          <div className=\"mt-4 sm:ml-16 sm:mt-0 sm:flex-none flex items-center gap-3\">\n            <Link\n              href=\"/admin/officers\"\n              className=\"block rounded-md bg-white px-3 py-2 text-center text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\"\n            >\n              役員一覧に戻る\n            </Link>\n            <PrintButton label=\"名簿をPDFにする\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"hidden print:block mb-8 text-center\">\n        <h1 className=\"text-2xl font-bold border-b-2 border-black pb-2 mb-2\">{nextWarekiYear}度 役員名簿</h1>\n        <p className=\"text-right text-sm\">発行日: {new Date().toLocaleDateString()}</p>\n        <div className=\"font-bold text-right mt-2\">\n          計 {new Set((assignments || []).map((a: any) => a.profile_id)).size} 名\n        </div>\n      </div>\n\n      <div className=\"mt-6 print:hidden\">\n        <div className=\"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8\">\n          <div className=\"flex\">\n            <div className=\"flex-shrink-0\">\n              <svg className=\"h-5 w-5 text-yellow-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n              </svg>\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-yellow-700\">\n                現在は <strong>{nextFiscalYear}年度（{nextWarekiYear}年度）</strong> の役員を選出しています。<br />\n                ここで設定された役員は、任期が <strong>{nextFiscalYear}年4月1日 〜 {nextFiscalYear + 1}年3月31日</strong> で登録されます。\n              </p>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n          {roles?.map((role) => {\n            const roleAssignments = assignments?.filter((a: any) => a.role_id === role.id) || []\n            return (\n              <OfficerSelectionCard\n                key={role.id}\n                role={role}\n                assignments={roleAssignments}\n                profiles={profiles || []}\n                nextFiscalYear={nextFiscalYear}\n              />\n            )\n          })}\n        </div>\n      </div>\n\n      {/* Print View Table */}\n      <div className=\"hidden print:block mt-6\">\n        <table className=\"w-full text-left border-collapse border border-black\">\n          <thead>\n            <tr className=\"border-b-2 border-black bg-gray-50\">\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 w-40 border-r border-black\">役職</th>\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 w-48 border-r border-black\">氏名</th>\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 border-r border-black\">住所</th>\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 w-40\">電話番号</th>\n            </tr>\n          </thead>\n          <tbody>\n            {sortedAssignments.length === 0 ? (\n              <tr>\n                <td colSpan={4} className=\"px-4 py-4 text-center text-sm text-gray-500\">任命された役員はいません</td>\n              </tr>\n            ) : (\n              sortedAssignments.map((assignment: any, index: number) => {\n                const prevAssignment = sortedAssignments[index - 1]\n                const isSameRole = prevAssignment && prevAssignment.role_id === assignment.role_id\n\n                return (\n                  <tr key={assignment.id} className={`${isSameRole ? '' : 'border-t border-black'}`}>\n                    <td className=\"px-4 py-2 text-sm text-gray-900 align-top border-r border-black\">\n                      {!isSameRole && assignment.role?.name}\n                    </td>\n                    <td className=\"px-4 py-2 text-sm text-gray-900 align-top border-r border-black\">\n                      {assignment.profile.full_name}\n                    </td>\n                    <td className=\"px-4 py-2 text-sm text-gray-900 align-top border-r border-black\">\n                      {assignment.profile.address}\n                    </td>\n                    <td className=\"px-4 py-2 text-sm text-gray-900 align-top\">\n                      {assignment.profile.phone}\n                    </td>\n                  </tr>\n                )\n              })\n            )}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/officers/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2450,2453],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2450,2453],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3082,3085],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3082,3085],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3552,3555],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3552,3555],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":134,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":134,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6321,6324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6321,6324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\nimport { deleteAssignment } from '../actions/officer'\nimport { toWarekiYear } from '@/lib/date-utils'\nimport { getTargetFiscalYear } from '../actions/settings'\n\nimport AdminPageHeader from '@/components/admin/AdminPageHeader'\n\nimport PrintButton from '@/components/admin/PrintButton'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function AdminOfficersPage() {\n  const supabase = await createClient()\n\n  const currentFiscalYear = await getTargetFiscalYear()\n\n  const { data: assignments } = await supabase\n    .from('officer_role_assignments')\n    .select(`\n        *,\n        role:officer_roles(*),\n        profile:profiles(full_name, email, last_name_kana, first_name_kana, address, phone)\n    `)\n    .eq('fiscal_year', currentFiscalYear)\n    .order('role(display_order)', { ascending: true })\n    .order('created_at', { ascending: false })\n\n  const { data: settings } = await supabase.from('organization_settings').select('*').single()\n  const warekiEraName = settings?.wareki_era_name || '令和'\n  const warekiStartYear = settings?.wareki_start_year || 2019\n\n  const titleYear = toWarekiYear(currentFiscalYear, warekiEraName, warekiStartYear)\n\n  return (\n    <div className=\"print:p-8\">\n      <div className=\"print:hidden\">\n        <AdminPageHeader\n          title=\"役員任命・管理\"\n          description=\"各メンバーの役職と任期を管理します。\"\n          action={{ label: '役員を任命する', href: '/admin/officers/new' }}\n        />\n      </div>\n\n      <div className=\"hidden print:block mb-8 text-center\">\n        <h1 className=\"text-2xl font-bold border-b-2 border-black pb-2 mb-2\">{titleYear}度 役員名簿</h1>\n        <p className=\"text-right text-sm\">発行日: {new Date().toLocaleDateString()}</p>\n      </div>\n\n      <div className=\"flex justify-between items-center mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 mt-4 print:hidden\">\n        <div className=\"bg-blue-50 border-l-4 border-blue-400 p-4 flex-1 mr-4\">\n          <div className=\"flex\">\n            <div className=\"flex-shrink-0\">\n              <svg className=\"h-5 w-5 text-blue-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fillRule=\"evenodd\" d=\"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z\" clipRule=\"evenodd\" />\n              </svg>\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-blue-700\">\n                現在の任命数: <span className=\"font-bold text-lg\">{new Set((assignments || []).map((a: any) => a.profile_id)).size}名</span>\n              </p>\n            </div>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-3\">\n          <a\n            href=\"/admin/officers/next-year\"\n            className=\"inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\"\n          >\n            次年度役員選出\n          </a>\n          <PrintButton label=\"役員一覧をPDFにする\" />\n        </div>\n      </div>\n\n      <div className=\"hidden print:block mb-4 text-right pr-4 font-bold\">\n        計 {new Set((assignments || []).map((a: any) => a.profile_id)).size} 名\n      </div>\n\n      <div className=\"flow-root mt-6 print:hidden\">\n\n        <div className=\"overflow-hidden bg-white shadow sm:rounded-md\">\n          <ul role=\"list\" className=\"divide-y divide-gray-200 border-t border-gray-200\">\n            {(assignments || []).length === 0 ? (\n              <li className=\"px-4 py-4 sm:px-6 text-gray-500 text-center\">任命された役員はいません</li>\n            ) : (\n              (assignments || []).map((assignment: any) => (\n                <li key={assignment.id} className=\"px-4 py-4 sm:px-6\">\n                  <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                    {/* Role & Year - Fixed width on desktop for alignment */}\n                    <div className=\"flex items-center gap-2 sm:w-48 shrink-0\">\n                      <span className=\"font-bold text-gray-900 text-lg\">{assignment.role?.name}</span>\n                    </div>\n\n                    {/* Name & Meta Info - Flex grow */}\n                    <div className=\"flex-1 flex flex-col sm:flex-row sm:items-baseline gap-1 sm:gap-6 min-w-0\">\n                      <div className=\"flex flex-col\">\n                        <div className=\"flex items-baseline gap-2 shrink-0\">\n                          <p className=\"text-sm font-medium text-indigo-600\">{assignment.profile.full_name}</p>\n                          <p className=\"text-xs text-gray-400 whitespace-nowrap\">({assignment.profile.last_name_kana} {assignment.profile.first_name_kana})</p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-gray-500 min-w-0\">\n                        <span className=\"truncate\">{assignment.profile.email}</span>\n                        <span className=\"whitespace-nowrap text-gray-400\">任期: {assignment.start_date} 〜 {assignment.end_date}</span>\n                      </div>\n                    </div>\n\n                    {/* Actions - Right aligned */}\n                    <form action={deleteAssignment} className=\"sm:ml-auto\">\n                      <input type=\"hidden\" name=\"id\" value={assignment.id} />\n                      <button type=\"submit\" className=\"text-sm text-red-600 hover:text-red-800 border-red-100 border px-2 py-1 rounded bg-red-50 whitespace-nowrap\">解除</button>\n                    </form>\n                  </div>\n                </li>\n              ))\n            )}\n          </ul>\n        </div>\n      </div>\n\n      {/* Print View Table */}\n      <div className=\"hidden print:block mt-6\">\n        <table className=\"w-full text-left border-collapse border border-black\">\n          <thead>\n            <tr className=\"border-b-2 border-black bg-gray-50\">\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 w-40 border-r border-black\">役職</th>\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 w-48 border-r border-black\">氏名</th>\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 border-r border-black\">住所</th>\n              <th className=\"px-4 py-2 text-sm font-bold text-gray-900 w-40\">電話番号</th>\n            </tr>\n          </thead>\n          <tbody>\n            {(assignments || []).map((assignment: any, index: number) => {\n              const prevAssignment = (assignments || [])[index - 1]\n              const isSameRole = prevAssignment && prevAssignment.role_id === assignment.role_id\n\n              return (\n                <tr key={assignment.id} className={`${isSameRole ? '' : 'border-t border-black'}`}>\n                  <td className=\"px-4 py-2 text-sm text-gray-900 align-top border-r border-black\">\n                    {!isSameRole && assignment.role?.name}\n                  </td>\n                  <td className=\"px-4 py-2 text-sm text-gray-900 align-top border-r border-black\">\n                    {assignment.profile.full_name}\n                  </td>\n                  <td className=\"px-4 py-2 text-sm text-gray-900 align-top border-r border-black\">\n                    {assignment.profile.address}\n                  </td>\n                  <td className=\"px-4 py-2 text-sm text-gray-900 align-top\">\n                    {assignment.profile.phone}\n                  </td>\n                </tr>\n              )\n            })}\n            {(assignments || []).length === 0 && (\n              <tr>\n                <td colSpan={4} className=\"px-4 py-4 text-center text-sm text-gray-500\">任命された役員はいません</td>\n              </tr>\n            )}\n          </tbody>\n        </table>\n      </div>\n    </div >\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/roles/RoleList.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isUpdating' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":20},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setIsUpdating' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":39,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":39,"endColumn":35}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport React, { useState } from 'react'\nimport Link from 'next/link'\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core'\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n  useSortable,\n} from '@dnd-kit/sortable'\nimport { CSS } from '@dnd-kit/utilities'\nimport { updateRoleOrder, toggleRoleVisibility } from '@/app/admin/actions/officer'\n\ntype Role = {\n  id: string\n  name: string\n  description?: string | null\n  display_order: number | null\n  created_at: string\n  is_visible_in_docs: boolean | null\n}\n\ntype Props = {\n  initialRoles: Role[]\n}\n\nexport function RoleList({ initialRoles }: Props) {\n  const [roles, setRoles] = useState(initialRoles)\n  const [isUpdating, setIsUpdating] = useState(false)\n\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  )\n\n  const handleDragEnd = async (event: DragEndEvent) => {\n    const { active, over } = event\n\n    if (over && active.id !== over.id) {\n      // Calculate new order based on current 'roles' state\n      const oldIndex = roles.findIndex((item) => item.id === active.id)\n      const newIndex = roles.findIndex((item) => item.id === over.id)\n      const newRoles = arrayMove(roles, oldIndex, newIndex)\n\n      // Optimistically update UI\n      setRoles(newRoles)\n\n      // Calculate and update display_order for all affected items\n      // We re-assign display_order based on index\n      const updates = newRoles.map((role, index) => ({\n        id: role.id,\n        display_order: index + 1,\n      }))\n\n      // Call server action to update order\n      try {\n        await updateRoleOrder(updates)\n      } catch (err) {\n        console.error('Failed to update order', err)\n        // If failed, we should probably revert the state, but for now just log it.\n        // To revert, we would need to setRoles(roles) (the old state).\n      }\n    }\n  }\n\n  const handleToggleVisibility = async (id: string, current: boolean) => {\n    // Optimistic update\n    setRoles((prev) =>\n      prev.map((role) =>\n        role.id === id ? { ...role, is_visible_in_docs: !current } : role\n      )\n    )\n\n    const result = await toggleRoleVisibility(id, !current)\n    if (!result.success) {\n      // Revert\n      setRoles((prev) =>\n        prev.map((role) =>\n          role.id === id ? { ...role, is_visible_in_docs: current } : role\n        )\n      )\n      alert(result.message)\n    }\n  }\n\n  return (\n    <DndContext\n      sensors={sensors}\n      collisionDetection={closestCenter}\n      onDragEnd={handleDragEnd}\n    >\n      <SortableContext items={roles.map(r => r.id)} strategy={verticalListSortingStrategy}>\n        <div className=\"overflow-hidden bg-white shadow sm:rounded-md\">\n          <ul role=\"list\" className=\"divide-y divide-gray-200\">\n            {roles.length === 0 ? (\n              <li className=\"px-4 py-4 sm:px-6 text-gray-500 text-center\">\n                登録された役職はありません\n              </li>\n            ) : (\n              roles.map((role) => (\n                <SortableRoleItem\n                  key={role.id}\n                  role={role}\n                  onToggleVisibility={handleToggleVisibility}\n                />\n              ))\n            )}\n          </ul>\n        </div>\n      </SortableContext>\n    </DndContext>\n  )\n}\n\nfunction SortableRoleItem({\n  role,\n  onToggleVisibility,\n}: {\n  role: Role\n  onToggleVisibility: (id: string, current: boolean) => void\n}) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: role.id })\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    zIndex: isDragging ? 10 : 'auto',\n    position: isDragging ? 'relative' : 'static',\n  } as React.CSSProperties\n\n  return (\n    <li ref={setNodeRef} style={style} className=\"bg-white\">\n      <div className=\"flex items-center justify-between px-4 py-4 sm:px-6 hover:bg-gray-50\">\n        <div className=\"flex items-center gap-4 flex-1\">\n          {/* Drag Handle */}\n          <button\n            type=\"button\"\n            className=\"cursor-move text-gray-400 hover:text-gray-600 p-2 touch-none\"\n            {...attributes}\n            {...listeners}\n          >\n            <svg\n              xmlns=\"http://www.w3.org/2000/svg\"\n              width=\"24\"\n              height=\"24\"\n              viewBox=\"0 0 24 24\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              strokeWidth=\"2\"\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            >\n              <line x1=\"8\" y1=\"6\" x2=\"21\" y2=\"6\"></line>\n              <line x1=\"8\" y1=\"12\" x2=\"21\" y2=\"12\"></line>\n              <line x1=\"8\" y1=\"18\" x2=\"21\" y2=\"18\"></line>\n              <line x1=\"3\" y1=\"6\" x2=\"3.01\" y2=\"6\"></line>\n              <line x1=\"3\" y1=\"12\" x2=\"3.01\" y2=\"12\"></line>\n              <line x1=\"3\" y1=\"18\" x2=\"3.01\" y2=\"18\"></line>\n            </svg>\n          </button>\n\n          <Link href={`/admin/roles/${role.id}`} className=\"flex-1 block\">\n            <div className=\"flex items-center gap-2\">\n              <p className=\"truncate text-sm font-medium text-indigo-600\">\n                {role.name}\n              </p>\n            </div>\n            {role.description && (\n              <p className=\"mt-1 text-sm text-gray-500\">{role.description}</p>\n            )}\n          </Link>\n        </div>\n\n        <div className=\"flex items-center gap-6\">\n          <div className=\"flex items-center gap-2\">\n            <label htmlFor={`visible-${role.id}`} className=\"text-sm text-gray-500 cursor-pointer select-none\">\n              資料表示\n            </label>\n            <input\n              id={`visible-${role.id}`}\n              type=\"checkbox\"\n              checked={role.is_visible_in_docs ?? true}\n              onChange={() => onToggleVisibility(role.id, role.is_visible_in_docs ?? true)}\n              className=\"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600\"\n            />\n          </div>\n\n          <Link href={`/admin/roles/${role.id}`} className=\"text-gray-400 hover:text-gray-600\">\n            &rarr;\n          </Link>\n        </div>\n      </div>\n    </li>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/roles/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/roles/new/RoleForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/roles/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/roles/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link'\nimport { createClient } from '@/lib/supabase/server'\nimport AdminPageHeader from '@/components/admin/AdminPageHeader'\nimport { RoleList } from './RoleList'\n\nexport default async function AdminRolesPage() {\n  const supabase = await createClient()\n  const { data: roles } = await supabase\n    .from('officer_roles')\n    .select('*')\n    .order('display_order', { ascending: true })\n    .order('name')\n\n  return (\n    <div>\n      <AdminPageHeader\n        title=\"役職管理\"\n        description=\"役員の役職を管理します。\"\n        action={{ label: '役職を追加', href: '/admin/roles/new' }}\n      />\n      <div className=\"mt-8 flow-root\">\n        <RoleList initialRoles={roles || []} />\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/settings/SettingsForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/settings/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/templates/new/TemplateForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/templates/new/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link'\nimport TemplateForm from './TemplateForm'\nimport AdminFormLayout from '@/components/admin/AdminFormLayout'\n\nexport default function NewTemplatePage() {\n  return (\n    <AdminFormLayout\n      title=\"テンプレート新規作成\"\n      backLink={{ href: '/admin/templates', label: 'テンプレート一覧に戻る' }}\n    >\n      <TemplateForm />\n    </AdminFormLayout>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/templates/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Link' is defined but never used. Allowed unused vars must match /^_/u.","line":1,"column":8,"nodeType":null,"messageId":"unusedVar","endLine":1,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link'\nimport { createClient } from '@/lib/supabase/server'\n\nimport AdminPageHeader from '@/components/admin/AdminPageHeader'\n\nexport default async function TemplatesPage() {\n  const supabase = await createClient()\n  const { data: templates } = await supabase\n    .from('notification_templates')\n    .select('*')\n    .order('created_at', { ascending: false })\n\n  return (\n    <div>\n      <AdminPageHeader\n        title=\"テンプレート一覧\"\n        description=\"お知らせ配信用のテンプレートを管理します。\"\n        action={{ label: '新規作成', href: '/admin/templates/new' }}\n      />\n\n      <div className=\"overflow-hidden bg-white shadow sm:rounded-md\">\n        <ul role=\"list\" className=\"divide-y divide-gray-200\">\n          {templates?.length === 0 ? (\n            <li className=\"px-4 py-4 sm:px-6 text-gray-500 text-center\">テンプレートがありません</li>\n          ) : (\n            templates?.map((template) => (\n              <li key={template.id} className=\"block hover:bg-gray-50\">\n                <div className=\"px-4 py-4 sm:px-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <p className=\"truncate text-sm font-medium text-indigo-600\">{template.name}</p>\n                    <div className=\"ml-2 flex flex-shrink-0\">\n                      <p className=\"inline-flex rounded-full bg-green-100 px-2 text-xs font-semibold leading-5 text-green-800\">\n                        {new Date(template.created_at).toLocaleDateString()}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"mt-2 sm:flex sm:justify-between\">\n                    <div className=\"sm:flex\">\n                      <p className=\"flex items-center text-sm text-gray-500\">\n                        件名: {template.subject}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              </li>\n            ))\n          )}\n        </ul>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/users/[id]/children/[childId]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/users/[id]/children/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/users/[id]/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/admin/users/import/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1461,1464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1461,1464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { importUsers, importChildren } from '@/app/actions/admin'\nimport { Loader2, AlertCircle, CheckCircle, Users, Baby } from 'lucide-react'\nimport { getGradeOrder } from '@/lib/grade-utils'\n\ntype ImportMode = 'user' | 'child'\n\nexport default function BulkImportPage() {\n  const [importMode, setImportMode] = useState<ImportMode>('user')\n  const [csvContent, setCsvContent] = useState('')\n  const [isProcessing, setIsProcessing] = useState(false)\n  const [result, setResult] = useState<{\n    success: boolean\n    createdCount: number\n    failedCount: number\n    logs: string[]\n    gradeSummary?: Record<string, number>\n  } | null>(null)\n\n  const handleImport = async () => {\n    if (!csvContent.trim()) return\n    const modeName = importMode === 'user' ? '会員' : '子供'\n    if (!confirm(`${modeName}の一括登録を開始しますか？\\n※1件でも失敗すると全件ロールバック（取り消し）されます。`)) return\n\n    console.log(`[BulkImportPage] Starting import. mode=${importMode}, lines=${csvContent.split('\\n').length}`)\n    setIsProcessing(true)\n    setResult(null)\n\n    try {\n      let res;\n      if (importMode === 'user') {\n        console.log('[BulkImportPage] Calling importUsers...')\n        res = await importUsers(csvContent)\n      } else {\n        console.log('[BulkImportPage] Calling importChildren...')\n        res = await importChildren(csvContent)\n      }\n      console.log('[BulkImportPage] Action returned:', res)\n      setResult(res)\n    } catch (e: any) {\n      console.error('[BulkImportPage] Error in handleImport:', e)\n      alert(`エラーが発生しました: ${e.message || '不明なエラー'}`)\n    } finally {\n      setIsProcessing(false)\n    }\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-xl font-bold\">データ一括登録</h2>\n      </div>\n\n      <div className=\"flex gap-4 border-b\">\n        <button\n          onClick={() => { setImportMode('user'); setResult(null); }}\n          className={`pb-2 px-4 flex items-center gap-2 font-medium transition-colors ${importMode === 'user' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-gray-500 hover:text-gray-700'\n            }`}\n        >\n          <Users size={18} />\n          会員（保護者）登録\n        </button>\n        <button\n          onClick={() => { setImportMode('child'); setResult(null); }}\n          className={`pb-2 px-4 flex items-center gap-2 font-medium transition-colors ${importMode === 'child' ? 'border-b-2 border-indigo-600 text-indigo-600' : 'text-gray-500 hover:text-gray-700'\n            }`}\n        >\n          <Baby size={18} />\n          子供登録\n        </button>\n      </div>\n\n      <div className=\"bg-white p-6 rounded-lg shadow space-y-4\">\n        <div className=\"bg-blue-50 p-4 rounded text-sm text-blue-800\">\n          <p className=\"font-bold mb-2\">\n            {importMode === 'user' ? '会員CSV形式（ヘッダーなし）' : '子供CSV形式（ヘッダーなし）'}\n          </p>\n          <code className=\"block bg-white p-2 rounded border border-blue-200 overflow-x-auto whitespace-nowrap\">\n            {importMode === 'user'\n              ? 'email,password,last_name,first_name,last_name_kana,first_name_kana'\n              : 'parent_email,last_name,first_name,last_name_kana,first_name_kana,gender,birthday,allergies,notes'\n            }\n          </code>\n          <p className=\"mt-2 text-xs\">\n            {importMode === 'user' ? (\n              <>\n                例: user1@example.com,pass1234,山田,太郎,やまだ,たろう<br />\n                (カタカナは自動的にひらがなに変換されます)\n              </>\n            ) : (\n              <>\n                例: user1@example.com,山田,一郎,やまだ,いちろう,male,2015-04-01,卵アレルギー,特記事項<br />\n                ※1列目は登録済みの保護者のメールアドレスを指定してください。\n              </>\n            )}\n          </p>\n          <p className=\"mt-2 text-xs text-red-600 font-bold\">\n            {importMode === 'user' && '※注意: パスワードはそのまま設定されます。取り扱いに注意してください。'}\n            <br />\n            ※1件でもエラーが発生した場合、全件の登録が取り消されます。\n          </p>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">CSVデータ貼り付け（カンマ、スペース、タブ区切り対応）</label>\n          <textarea\n            className=\"w-full h-64 p-3 border border-gray-300 rounded font-mono text-sm\"\n            placeholder=\"ここにCSVデータを貼り付けてください\"\n            value={csvContent}\n            onChange={(e) => setCsvContent(e.target.value)}\n          />\n        </div>\n\n        <div className=\"flex justify-end\">\n          <button\n            onClick={handleImport}\n            disabled={isProcessing || !csvContent.trim()}\n            className=\"flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 disabled:opacity-50\"\n          >\n            {isProcessing && <Loader2 className=\"animate-spin h-4 w-4\" />}\n            {importMode === 'user' ? '会員一括登録を実行' : '子供一括登録を実行'}\n          </button>\n        </div>\n      </div>\n\n      {result && (\n        <div className=\"bg-white p-6 rounded-lg shadow space-y-4\">\n          <div className=\"flex justify-between items-center border-b pb-2\">\n            <h3 className=\"font-bold\">実行結果</h3>\n            {!result.success && (\n              <span className=\"text-red-600 font-bold text-sm bg-red-50 px-2 py-1 rounded\">\n                ロールバック済み（全件取り消し）\n              </span>\n            )}\n          </div>\n          <div className=\"flex gap-4\">\n            <div className={`flex items-center gap-2 ${result.success ? 'text-green-600' : 'text-gray-400'}`}>\n              <CheckCircle size={20} />\n              <span className=\"font-bold\">成功: {result.createdCount}件</span>\n            </div>\n            <div className={`flex items-center gap-2 ${result.success ? 'text-gray-400' : 'text-red-600'}`}>\n              <AlertCircle size={20} />\n              <span className=\"font-bold\">\n                {result.success ? '失敗/スキップ: 0件' : `失敗による中断: ${result.failedCount}件`}\n              </span>\n            </div>\n          </div>\n\n          {result.gradeSummary && Object.keys(result.gradeSummary).length > 0 && (\n            <div className=\"bg-indigo-50 p-6 rounded-lg border border-indigo-100 space-y-3\">\n              <h4 className=\"font-bold text-indigo-900 flex items-center gap-2\">\n                <Baby size={18} />\n                登録お子様の学年別内訳\n              </h4>\n              <div className=\"bg-white rounded border border-indigo-200 overflow-hidden\">\n                <table className=\"min-w-full text-sm\">\n                  <thead>\n                    <tr className=\"bg-indigo-100 text-indigo-900\">\n                      <th className=\"text-left py-2 px-4 font-bold\">学年</th>\n                      <th className=\"text-right py-2 px-4 font-bold\">人数</th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-indigo-50\">\n                    {Object.entries(result.gradeSummary)\n                      .sort(([a], [b]) => getGradeOrder(a) - getGradeOrder(b))\n                      .map(([grade, count], index) => (\n                        <tr key={grade} className={`hover:bg-indigo-50/50 ${index % 2 === 0 ? 'bg-white' : 'bg-indigo-50/30'}`}>\n                          <td className=\"py-2 px-4 text-gray-700\">{grade}</td>\n                          <td className=\"py-2 px-4 text-right font-medium text-indigo-700\">{count}名</td>\n                        </tr>\n                      ))}\n                  </tbody>\n                  <tfoot>\n                    <tr className=\"bg-indigo-50 font-bold border-t-2 border-indigo-100\">\n                      <td className=\"py-2 px-4 text-indigo-900\">合計</td>\n                      <td className=\"py-2 px-4 text-right text-indigo-900\">{result.createdCount}名</td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n            </div>\n          )}\n\n          <div className={`bg-gray-50 p-4 rounded border h-64 overflow-y-auto font-mono text-xs ${!result.success ? 'border-red-200' : ''}`}>\n            {result.logs.map((log, i) => (\n              <div key={i} className={\n                log.includes('[FATAL ERROR]') || log.includes('[ERROR]') ? 'text-red-600 font-bold' :\n                  log.includes('[SUCCESS]') ? 'text-green-600' :\n                    'text-gray-600'\n              }>\n                {log}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/auth/auth-code-error/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/auth/callback/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/auth/signout/route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/events/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[680,683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[680,683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'participantMap' is never reassigned. Use 'const' instead.","line":30,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":30,"endColumn":42,"fix":{"range":[693,737],"text":"const participantMap: Record<string, any> = {}"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[728,731],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[728,731],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"\nimport { createClient } from '@/lib/supabase/server'\nimport Link from 'next/link'\nimport { submitRsvp } from '../../actions/rsvp'\n\n// Ensure we handle async params correctly for Next.js 15+ \nexport default async function EventPage({\n  params,\n}: {\n  params: Promise<{ id: string }>\n}) {\n  const { id } = await params\n  const supabase = await createClient()\n\n  // Get event details\n  const { data: event } = await supabase\n    .from('events')\n    .select('*')\n    .eq('id', id)\n    .single()\n\n  if (!event) {\n    return <div>イベントが見つかりません</div>\n  }\n\n  // Get current user's children and their rsvp status\n  const { data: { user } } = await supabase.auth.getUser()\n\n  let children: any[] = []\n  let participantMap: Record<string, any> = {}\n\n  if (user) {\n    // 1. Get children\n    const { data: userChildren } = await supabase\n      .from('children')\n      .select('*')\n      .eq('parent_id', user.id)\n      .order('birthday', { ascending: false }) // Sort by age (youngest first usually bottom, but birthday descending means youngest first?) \n      // Usually older child first is better? birthday ascending -> older first\n      .order('created_at', { ascending: true }) // fallback\n\n    // Sort by birthday ascending (Oldest first)\n    if (userChildren) {\n      children = userChildren.sort((a, b) => (a.birthday > b.birthday ? 1 : -1))\n    }\n\n    // 2. Get existing participants records for these children\n    if (children.length > 0) {\n      const { data: participants } = await supabase\n        .from('event_participants')\n        .select('*')\n        .eq('event_id', id)\n        .eq('profile_id', user.id)\n        .not('child_id', 'is', null)\n\n      if (participants) {\n        participants.forEach(p => {\n          if (p.child_id) participantMap[p.child_id] = p\n        })\n      }\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4 sm:p-8\">\n      <div className=\"mx-auto max-w-3xl\">\n        <div className=\"mb-4\">\n          <Link href=\"/\" className=\"text-indigo-600 hover:text-indigo-500\">\n            ← ダッシュボードへ戻る\n          </Link>\n        </div>\n\n        <div className=\"overflow-hidden bg-white shadow sm:rounded-lg\">\n          <div className=\"px-4 py-5 sm:px-6\">\n            <h3 className=\"text-xl font-semibold leading-6 text-gray-900\">{event.title}</h3>\n            <p className=\"mt-1 max-w-2xl text-sm text-gray-500\">{event.type === 'meeting' ? '定例会' : 'イベント'}</p>\n          </div>\n          <div className=\"border-t border-gray-200 px-4 py-5 sm:px-6\">\n            <dl className=\"grid grid-cols-1 gap-x-4 gap-y-8 sm:grid-cols-2\">\n              <div className=\"sm:col-span-1\">\n                <dt className=\"text-sm font-medium text-gray-500\">日時</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">\n                  {new Date(event.scheduled_date).toLocaleDateString()}\n                  {event.start_time && ` ${event.start_time.slice(0, 5)}`}\n                  {event.scheduled_end_date && ` 〜 ${new Date(event.scheduled_end_date).toLocaleDateString()}`}\n                </dd>\n              </div>\n              <div className=\"sm:col-span-1\">\n                <dt className=\"text-sm font-medium text-gray-500\">場所</dt>\n                <dd className=\"mt-1 text-sm text-gray-900\">{event.location || '未定'}</dd>\n              </div>\n              <div className=\"sm:col-span-2\">\n                <dt className=\"text-sm font-medium text-gray-500\">詳細</dt>\n                <dd className=\"mt-1 text-sm text-gray-900 whitespace-pre-wrap\">{event.description}</dd>\n              </div>\n            </dl>\n          </div>\n\n          {event.rsvp_required && (\n            <div className=\"border-t border-gray-200 px-4 py-5 sm:px-6 bg-indigo-50/50\">\n              <h4 className=\"text-lg font-bold text-indigo-900\">出欠登録</h4>\n\n              {children.length === 0 ? (\n                <div className=\"mt-4 p-4 bg-yellow-50 rounded border border-yellow-200 text-yellow-800\">\n                  <p>お子様の情報が登録されていません。「マイページ」からお子様を登録してください。</p>\n                  <Link href=\"/profile\" className=\"text-indigo-600 underline mt-2 inline-block\">マイページへ</Link>\n                </div>\n              ) : (\n                <>\n                  {event.rsvp_deadline && (\n                    <p className=\"text-sm text-red-600 mb-4 mt-1\">締切: {new Date(event.rsvp_deadline).toLocaleString()}</p>\n                  )}\n\n                  <form action={submitRsvp} className=\"mt-6 space-y-4\">\n                    <input type=\"hidden\" name=\"event_id\" value={event.id} />\n\n                    <div className=\"bg-white rounded-lg border border-gray-200 divide-y divide-gray-100\">\n                      {children.map(child => {\n                        const rsvp = participantMap[child.id]\n                        const isAttending = rsvp?.status === 'attending'\n\n                        return (\n                          <div key={child.id} className=\"p-4 flex items-center justify-between hover:bg-gray-50 transition-colors\">\n                            <label htmlFor={`status_${child.id}`} className=\"flex items-center gap-4 cursor-pointer flex-1\">\n                              <input\n                                type=\"checkbox\"\n                                id={`status_${child.id}`}\n                                name={`status_${child.id}`}\n                                value=\"attending\"\n                                defaultChecked={isAttending}\n                                className=\"h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600 cursor-pointer\"\n                              />\n                              <div className=\"flex flex-col\">\n                                <span className=\"font-bold text-gray-900 text-lg\">{child.full_name} <span className=\"text-sm font-normal text-gray-500\">さん</span></span>\n                                <span className=\"text-sm text-gray-500\">\n                                  参加する場合はチェック\n                                </span>\n                              </div>\n                            </label>\n                          </div>\n                        )\n                      })}\n                    </div>\n\n                    <div className=\"pt-4 flex justify-end\">\n                      <button\n                        type=\"submit\"\n                        className=\"w-full sm:w-auto inline-flex justify-center rounded-md bg-indigo-600 px-8 py-3 text-base font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\"\n                      >\n                        保存する\n                      </button>\n                    </div>\n                  </form>\n                </>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/forum/[id]/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'redirect' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":20,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":28},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":100,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":100,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4102,4105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4102,4105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getQuestionDetail, createAnswer } from '@/app/actions/forum'\nimport { createClient } from '@/lib/supabase/server'\nimport ReactionBar from '@/components/forum/ReactionBar'\nimport { ArrowLeft, MessageSquare, CheckCircle2, User, Send, Clock, ShieldCheck } from 'lucide-react'\nimport Link from 'next/link'\nimport { notFound, redirect } from 'next/navigation'\nimport { formatDistanceToNow } from 'date-fns'\nimport { ja } from 'date-fns/locale'\nimport { revalidatePath } from 'next/cache'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function QuestionDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  const { id } = await params\n  const supabase = await createClient()\n  const { data: { user } } = await supabase.auth.getUser()\n\n  const question = await getQuestionDetail(id)\n  if (!question) notFound()\n\n  async function handleSubmitAnswer(formData: FormData) {\n    'use server'\n    const res = await createAnswer(formData)\n    if (res.success) {\n      revalidatePath(`/forum/${id}`)\n    }\n  }\n\n  return (\n    <div className=\"min-h-screen bg-[#FDFEFF] pb-20\">\n      <header className=\"bg-white/70 backdrop-blur-xl sticky top-0 z-20 border-b border-gray-100\">\n        <div className=\"max-w-4xl mx-auto px-4 h-16 flex items-center gap-4\">\n          <Link\n            href=\"/forum\"\n            className=\"p-2 hover:bg-gray-100 rounded-xl transition-colors text-gray-500\"\n          >\n            <ArrowLeft size={20} />\n          </Link>\n          <h1 className=\"font-bold text-gray-900 truncate\">質問の詳細</h1>\n        </div>\n      </header>\n\n      <main className=\"max-w-4xl mx-auto px-4 py-8\">\n        {/* Question Header */}\n        <section className=\"bg-white rounded-[2rem] border border-gray-100 p-8 shadow-sm mb-8 relative overflow-hidden\">\n          <div className=\"flex justify-between items-start mb-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-12 h-12 bg-indigo-50 rounded-2xl flex items-center justify-center text-indigo-600\">\n                <User size={24} />\n              </div>\n              <div>\n                <div className=\"font-bold text-gray-900\">\n                  {question.profiles?.last_name} {question.profiles?.first_name}\n                </div>\n                <div className=\"text-xs text-gray-400 flex items-center gap-1 mt-0.5\">\n                  <Clock size={12} />\n                  {formatDistanceToNow(new Date(question.created_at), { addSuffix: true, locale: ja })}\n                </div>\n              </div>\n            </div>\n            {question.is_resolved && (\n              <span className=\"flex items-center gap-1.5 px-3 py-1 bg-green-50 text-green-600 rounded-full text-xs font-bold border border-green-100 uppercase tracking-wider\">\n                <CheckCircle2 size={14} />\n                解決済み\n              </span>\n            )}\n          </div>\n\n          <h2 className=\"text-2xl font-black text-gray-900 mb-4 leading-tight\">\n            {question.title}\n          </h2>\n\n          <div className=\"text-gray-700 text-lg leading-relaxed mb-8 whitespace-pre-wrap\">\n            {question.content}\n          </div>\n\n          <div className=\"border-t border-gray-50 pt-4\">\n            <ReactionBar\n              targetType=\"question\"\n              targetId={question.id}\n              reactions={question.forum_reactions}\n              userId={user?.id}\n            />\n          </div>\n        </section>\n\n        {/* Answers List */}\n        <section className=\"mb-12\">\n          <h3 className=\"text-xl font-bold text-gray-900 mb-6 flex items-center gap-2 px-2\">\n            <MessageSquare size={20} className=\"text-indigo-600\" />\n            回答 {question.forum_answers?.length || 0} 件\n          </h3>\n\n          <div className=\"space-y-6\">\n            {question.forum_answers?.length === 0 ? (\n              <div className=\"bg-gray-50/50 border-2 border-dashed border-gray-100 rounded-3xl p-12 text-center text-gray-400 font-medium\">\n                まだ回答はありません。あなたの知っていることを教えてあげませんか？\n              </div>\n            ) : (\n              question.forum_answers.map((answer: any) => (\n                <div key={answer.id} className=\"bg-white rounded-3xl border border-gray-100 p-6 shadow-sm relative transition-all hover:border-indigo-100\">\n                  <div className=\"flex justify-between items-start mb-4\">\n                    <div className=\"flex items-center gap-3\">\n                      <div className=\"w-10 h-10 bg-gray-50 rounded-xl flex items-center justify-center text-gray-400\">\n                        <User size={20} />\n                      </div>\n                      <div>\n                        <div className=\"font-bold text-gray-800 text-sm\">\n                          {answer.profiles?.last_name} {answer.profiles?.first_name}\n                        </div>\n                        <div className=\"text-[10px] text-gray-400 flex items-center gap-1 mt-0.5 uppercase font-bold tracking-widest\">\n                          <Clock size={10} />\n                          {formatDistanceToNow(new Date(answer.created_at), { addSuffix: true, locale: ja })}\n                        </div>\n                      </div>\n                    </div>\n                    {answer.is_best_answer && (\n                      <span className=\"flex items-center gap-1 px-2.5 py-1 bg-amber-50 text-amber-600 rounded-lg text-[10px] font-black border border-amber-100 uppercase\">\n                        <ShieldCheck size={12} />\n                        Best Answer\n                      </span>\n                    )}\n                  </div>\n\n                  <div className=\"text-gray-700 leading-relaxed mb-6 whitespace-pre-wrap\">\n                    {answer.content}\n                  </div>\n\n                  <div className=\"border-t border-gray-50 pt-3\">\n                    <ReactionBar\n                      targetType=\"answer\"\n                      targetId={answer.id}\n                      reactions={answer.forum_reactions}\n                      userId={user?.id}\n                    />\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </section>\n\n        {/* Post Answer Form */}\n        <section className=\"sticky bottom-8 z-30\">\n          <form action={handleSubmitAnswer} className=\"bg-white/80 backdrop-blur-2xl border border-gray-200 rounded-[2rem] p-4 shadow-2xl flex items-end gap-3 max-w-2xl mx-auto ring-4 ring-white/50\">\n            <input type=\"hidden\" name=\"question_id\" value={question.id} />\n            <div className=\"flex-1\">\n              <textarea\n                name=\"content\"\n                required\n                rows={1}\n                placeholder=\"回答を入力する...\"\n                className=\"w-full bg-gray-50/50 border-none rounded-2xl py-3 px-4 focus:ring-0 focus:bg-white transition-all text-sm outline-none resize-none min-h-[48px]\"\n              />\n            </div>\n            <button\n              type=\"submit\"\n              className=\"bg-indigo-600 text-white p-3 rounded-2xl hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200\"\n            >\n              <Send size={20} />\n            </button>\n          </form>\n        </section>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/forum/page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":66,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":66,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3031,3034],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3031,3034],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { getQuestions } from '@/app/actions/forum'\nimport ForumCard from '@/components/forum/ForumCard'\nimport QuestionDialog from '@/components/forum/QuestionDialog'\nimport ForumSearch from '@/components/forum/ForumSearch'\nimport { MessageCircleQuestion } from 'lucide-react'\nimport Link from 'next/link'\n\nexport const dynamic = 'force-dynamic'\n\nexport default async function ForumPage({\n  searchParams,\n}: {\n  searchParams: Promise<{ q?: string }>\n}) {\n  const { q } = await searchParams\n  const questions = await getQuestions(q)\n\n  return (\n    <div className=\"min-h-screen bg-[#FDFEFF]\">\n      <header className=\"bg-white/70 backdrop-blur-xl sticky top-0 z-20 border-b border-gray-100\">\n        <div className=\"max-w-5xl mx-auto px-4 h-20 flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-10 h-10 bg-indigo-600 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-indigo-100\">\n              <MessageCircleQuestion size={24} />\n            </div>\n            <div>\n              <h1 className=\"text-xl font-bold text-gray-900 tracking-tight\">質問掲示板</h1>\n              <p className=\"text-[10px] text-gray-400 font-bold uppercase tracking-widest\">Forum & Community</p>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <Link href=\"/\" className=\"text-sm font-bold text-gray-500 hover:text-gray-900 px-4 py-2 rounded-xl transition-colors\">\n              ホームへ戻る\n            </Link>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-5xl mx-auto px-4 py-10\">\n        <section className=\"mb-0\"> {/* Adjusted margin to merge with search component */}\n          <div className=\"bg-gradient-to-br from-indigo-600 to-indigo-800 rounded-[2.5rem] p-10 text-white shadow-2xl shadow-indigo-200 relative overflow-hidden\">\n            <div className=\"absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-20 -mt-20 blur-3xl\" />\n            <div className=\"relative z-10 max-w-2xl\">\n              <h2 className=\"text-3xl font-bold mb-4 leading-tight\">\n                子ども会のことで<br />わからないことはありますか？\n              </h2>\n              <p className=\"text-indigo-100 text-lg opacity-90 max-w-md leading-relaxed mb-8\">\n                役員への質問や、会員同士の相談など、気軽にお使いください。\n              </p>\n\n              <ForumSearch />\n            </div>\n          </div>\n        </section>\n\n        <section className=\"mt-8\">\n          {questions.length === 0 ? (\n            <div className=\"bg-white border-2 border-dashed border-gray-100 rounded-[2rem] p-20 text-center\">\n              <div className=\"w-16 h-16 bg-gray-50 rounded-3xl flex items-center justify-center text-gray-300 mx-auto mb-4\">\n                <MessageCircleQuestion size={32} />\n              </div>\n              <p className=\"text-gray-400 font-medium\">まだ質問がありません。<br />最初の質問を投稿してみませんか？</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {questions.map((q: any) => (\n                <ForumCard key={q.id} question={q} />\n              ))}\n            </div>\n          )}\n        </section>\n      </main>\n\n      <QuestionDialog />\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/login/AuthForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/login/actions.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'user' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":16,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { redirect } from 'next/navigation'\n\nimport { createClient } from '@/lib/supabase/server'\nimport { getBaseUrl } from '@/lib/utils'\n\nexport async function login(formData: FormData) {\n  const supabase = await createClient()\n\n  const email = formData.get('email') as string\n  const password = formData.get('password') as string\n\n  const { data: { user }, error } = await supabase.auth.signInWithPassword({\n    email,\n    password,\n  })\n\n  if (error) {\n    redirect('/error')\n  }\n\n  // Check if profile is soft-deleted logic removed (physical delete used now)\n  /* \n  if (user) {\n    const { data: profile } = await supabase\n      .from('profiles')\n      .select('deleted_at')\n      .eq('id', user.id)\n      .single()\n\n    if (profile?.deleted_at) {\n      // If deleted, sign out immediately\n      await supabase.auth.signOut()\n      redirect('/login?error=account_deleted')\n    }\n  }\n  */\n\n  revalidatePath('/', 'layout')\n  redirect('/')\n}\n\nexport async function signInWithGoogle() {\n  const supabase = await createClient()\n  const { data, error } = await supabase.auth.signInWithOAuth({\n    provider: 'google',\n    options: {\n      redirectTo: `${getBaseUrl()}/auth/callback`,\n    },\n  })\n\n  if (error) {\n    console.error('Provider error:', error)\n    redirect('/error')\n  }\n\n  if (data.url) {\n    redirect(data.url)\n  }\n}\n\nexport async function signup(formData: FormData) {\n  const supabase = await createClient()\n\n  const email = formData.get('email') as string\n  const password = formData.get('password') as string\n  const lastName = formData.get('last_name') as string\n  const firstName = formData.get('first_name') as string\n  const lastNameKana = formData.get('last_name_kana') as string\n  const firstNameKana = formData.get('first_name_kana') as string\n\n  const { error } = await supabase.auth.signUp({\n    email,\n    password,\n    options: {\n      emailRedirectTo: `${getBaseUrl()}/auth/callback`,\n      data: {\n        last_name: lastName,\n        first_name: firstName,\n        last_name_kana: lastNameKana,\n        first_name_kana: firstNameKana,\n        full_name: `${lastName} ${firstName}`\n      }\n    },\n  })\n\n  if (error) {\n    redirect('/error')\n  }\n\n  revalidatePath('/', 'layout')\n  redirect('/')\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/login/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/notifications/read/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/page.tsx","messages":[{"ruleId":"prefer-const","severity":2,"message":"'eventAttendanceMap' is never reassigned. Use 'const' instead.","line":104,"column":7,"nodeType":"Identifier","messageId":"useConst","endLine":104,"endColumn":25,"fix":{"range":[3590,3645],"text":"const eventAttendanceMap = new Map<string, Set<string>>()"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4847,4850],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4847,4850],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":196,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":196,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7489,7492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7489,7492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":247,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":247,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10256,10259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10256,10259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":1,"fixableWarningCount":0,"source":"import { createClient } from '@/lib/supabase/server'\nimport Link from 'next/link'\nimport { getTargetFiscalYear } from '@/lib/fiscal-year'\nimport FiscalYearSwitcher from '@/components/FiscalYearSwitcher'\nimport { MessageCircleQuestion, HelpCircle, ChevronRight } from 'lucide-react'\nimport { getUnansweredCount } from '@/app/actions/forum'\nimport GoogleCalendarButton from '@/components/GoogleCalendarButton'\n\nexport default async function DashboardPage() {\n  const supabase = await createClient()\n  const { data: { user } } = await supabase.auth.getUser()\n\n  // user is guaranteed to exist because of middleware redirection\n  const currentUser = user!\n\n  // Get user profile\n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('*')\n    .eq('id', currentUser.id)\n    .single()\n\n  // Get association settings\n  const { data: settings } = await supabase.from('organization_settings').select('name').single()\n  const associationName = settings?.name || '子供会'\n\n  // Get unread notifications\n  const { data: unreadNotifications } = await supabase\n    .from('notification_recipients')\n    .select(`\nid,\n  is_read,\n  read_token,\n  notification: notifications(\n    id,\n    subject,\n    sent_at\n  )\n    `)\n    .eq('profile_id', currentUser.id)\n    .eq('is_read', false)\n    .order('created_at', { ascending: false })\n\n  // Get target fiscal year\n  const targetFiscalYear = await getTargetFiscalYear()\n  const today = new Date().toISOString().split('T')[0]\n  // Ideally, upcoming events should be filtered by the target fiscal year as well?\n  // But usually \"Upcoming\" means \"Future from now\".\n  // However, \"Date Undecided\" events (tentative) might have placeholder dates in the past (e.g. April 1st).\n  // We need to fetch these specifically if they belong to the current/target context.\n\n  // 1. Fetch upcoming confirmed/tentative events (Standard)\n  const { data: upcomingEvents } = await supabase\n    .from('events')\n    .select('*')\n    .gte('scheduled_date', today)\n    .order('scheduled_date', { ascending: true })\n  // No limit as per user request\n\n  // 2. Fetch tentative events that might be hidden because of past placeholder dates\n  // We look for tentative events in the current fiscal year (or target fiscal year) that are BEFORE today.\n  // Assuming targetFiscalYear is the relevant context.\n  const startOfFiscalYear = `${targetFiscalYear}-04-01`\n\n  const { data: pastTentativeEvents } = await supabase\n    .from('events')\n    .select('*')\n    .eq('is_tentative', true)\n    .gte('scheduled_date', startOfFiscalYear)\n    .lt('scheduled_date', today)\n    .order('scheduled_date', { ascending: true })\n\n  // Combine and sort\n  let events = [...(pastTentativeEvents || []), ...(upcomingEvents || [])]\n\n  // Deduplicate just in case (though queries shouldn't overlap)\n  const seenIds = new Set()\n  events = events.filter(e => {\n    if (seenIds.has(e.id)) return false\n    seenIds.add(e.id)\n    return true\n  })\n\n  // Sort by date then time\n  events.sort((a, b) => {\n    if (a.scheduled_date === b.scheduled_date) {\n      return (a.start_time || '') > (b.start_time || '') ? 1 : -1\n    }\n    return a.scheduled_date > b.scheduled_date ? 1 : -1\n  })\n\n  // No slice/limit as per user request\n\n  // Get user's children for granular attendance display\n  const { data: children } = await supabase\n    .from('children')\n    .select('id, first_name')\n    .eq('parent_id', currentUser.id)\n    .order('birthday', { ascending: true }) // Consistent order\n\n  // Get attendance status for these events\n  const eventIds = events.map(e => e.id)\n  // Map<EventId, Set<ChildId>>\n  let eventAttendanceMap = new Map<string, Set<string>>()\n\n  if (currentUser && eventIds.length > 0 && children && children.length > 0) {\n    const { data: participations } = await supabase\n      .from('event_participants')\n      .select('event_id, child_id')\n      .eq('profile_id', currentUser.id)\n      .eq('status', 'attending')\n      .in('event_id', eventIds)\n\n    if (participations) {\n      participations.forEach(p => {\n        if (p.child_id) {\n          if (!eventAttendanceMap.has(p.event_id)) {\n            eventAttendanceMap.set(p.event_id, new Set())\n          }\n          eventAttendanceMap.get(p.event_id)!.add(p.child_id)\n        }\n      })\n    }\n  }\n\n  // Get officer roles FOR THE TARGET FISCAL YEAR\n  const { data: officerRoles } = await supabase\n    .from('officer_role_assignments')\n    .select(`\n  *,\n  role: officer_roles(*)\n    `)\n    .eq('profile_id', currentUser.id)\n    .eq('fiscal_year', targetFiscalYear) // Use target year\n\n  // Secure filter: Hide drafts from non-officers\n  // Although RLS should handle this, we add an explicit filter here for safety.\n  if (!officerRoles || officerRoles.length === 0) {\n    events = events.filter(e => e.public_status !== 'draft')\n  }\n\n  // Get officer tasks if any role\n  let officerTasks: any[] = []\n  let unansweredCount = 0\n  if (officerRoles && officerRoles.length > 0) {\n    const roleIds = officerRoles.map(r => r.role_id)\n    const { data: tasks } = await supabase\n      .from('officer_tasks')\n      .select('*')\n      .in('role_id', roleIds)\n    officerTasks = tasks || []\n\n    // Get unanswered forum questions count\n    unansweredCount = await getUnansweredCount()\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <header className=\"bg-white shadow\">\n        <div className=\"mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8 flex flex-col sm:flex-row justify-between items-center gap-4\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-3xl font-bold tracking-tight text-gray-900\">ダッシュボード</h1>\n            <FiscalYearSwitcher currentYear={targetFiscalYear} />\n          </div>\n          <div className=\"flex gap-2 sm:gap-4 items-center flex-wrap justify-center\">\n            <Link href=\"/forum\" className=\"text-sm font-semibold leading-6 text-indigo-600 bg-indigo-50 border border-indigo-100 rounded-lg px-3 py-2 hover:bg-indigo-100 transition-colors flex items-center gap-2\">\n              <MessageCircleQuestion size={18} />\n              質問掲示板\n            </Link>\n            {profile?.is_admin && (\n              <Link href=\"/admin/templates\" className=\"text-sm font-semibold leading-6 text-gray-900 border rounded-lg px-3 py-2 hover:bg-gray-50 flex items-center gap-2 text-xs\">\n                管理者メニューへ\n              </Link>\n            )}\n            <Link href=\"/profile\" className=\"text-sm font-semibold leading-6 text-gray-900 border rounded-lg px-3 py-2 hover:bg-gray-50 flex items-center gap-2 text-xs\">\n              マイページ\n            </Link>\n            <form action=\"/auth/signout\" method=\"post\">\n              <button className=\"text-sm font-semibold leading-6 text-gray-900 border rounded-lg px-3 py-2 hover:bg-gray-50 flex items-center gap-2 text-xs\">\n                ログアウト\n              </button>\n            </form>\n          </div>\n        </div>\n      </header>\n      <main>\n        <div className=\"mx-auto max-w-7xl py-6 sm:px-6 lg:px-8\">\n\n          {/* Officer Dashboard Section */}\n          {(officerRoles && officerRoles.length > 0) && (\n            <div className=\"bg-indigo-50 border-l-4 border-indigo-500 p-4 mb-8\">\n              <div className=\"flex flex-col sm:flex-row justify-between items-start gap-4\">\n                <div>\n                  <h2 className=\"text-lg font-bold text-indigo-900\">役員メニュー ({targetFiscalYear}年度)</h2>\n                  <p className=\"text-sm text-indigo-700 mt-1\">\n                    現在の役職: {officerRoles.map((r: any) => r.role?.name).join(', ')}\n                  </p>\n                  {unansweredCount > 0 && (\n                    <Link href=\"/forum\" className=\"inline-flex items-center gap-1.5 mt-2 bg-pink-100 text-pink-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-pink-200 transition-colors\">\n                      <HelpCircle size={14} />\n                      未回答の質問が {unansweredCount} 件あります\n                    </Link>\n                  )}\n                </div>\n                <div className=\"flex gap-2 flex-wrap\">\n                  <Link href=\"/admin/notifications/new\" className=\"bg-white text-indigo-700 px-3 py-1 rounded text-sm font-semibold shadow-sm border hover:bg-gray-50\">\n                    お知らせ作成\n                  </Link>\n                  <Link href=\"/admin/events/new\" className=\"bg-white text-indigo-700 px-3 py-1 rounded text-sm font-semibold shadow-sm border hover:bg-gray-50\">\n                    イベント作成\n                  </Link>\n                  <Link href=\"/admin/members\" className=\"bg-white text-indigo-700 px-3 py-1 rounded text-sm font-semibold shadow-sm border hover:bg-gray-50\">\n                    会員名簿\n                  </Link>\n                </div>\n              </div>\n\n              <div className=\"mt-4\">\n                <h3 className=\"font-semibold text-indigo-900 text-sm mb-2\">担当業務</h3>\n                {officerTasks.length > 0 ? (\n                  <ul className=\"list-disc list-inside text-sm text-indigo-800 bg-white/50 p-3 rounded\">\n                    {officerTasks.map(task => (\n                      <li key={task.id} className=\"mb-1\">\n                        <span className=\"font-medium\">{task.title}</span>\n                        {task.due_date && <span className=\"text-xs ml-2 text-red-600\">期限: {new Date(task.due_date).toLocaleDateString()}</span>}\n                        <p className=\"text-xs text-indigo-600 ml-5\">{task.description}</p>\n                      </li>\n                    ))}\n                  </ul>\n                ) : (\n                  <p className=\"text-sm text-indigo-600\">現在登録されている担当業務はありません。</p>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Notifications Section */}\n          <div className=\"mb-8\">\n            <h2 className=\"text-lg font-medium leading-6 text-gray-900 mb-4\">\n              {unreadNotifications && unreadNotifications.length > 0 ? '未読のお知らせ' : '新しいお知らせはありません'}\n            </h2>\n\n            {unreadNotifications && unreadNotifications.length > 0 && (\n              <div className=\"overflow-hidden rounded-md bg-white shadow\">\n                <ul role=\"list\" className=\"divide-y divide-gray-200\">\n                  {unreadNotifications.map((recipient) => {\n                    const notification = recipient.notification as any\n                    return (\n                      <li key={recipient.id} className=\"px-6 py-4 hover:bg-gray-50\">\n                        <Link href={`/ notifications / read ? token = ${recipient.read_token} `} className=\"block\">\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"font-medium text-indigo-600\">{notification?.subject}</span>\n                            <span className=\"text-sm text-gray-500\">\n                              {new Date(notification?.sent_at).toLocaleDateString()}\n                            </span>\n                          </div>\n                        </Link>\n                      </li>\n                    )\n                  })}\n                </ul>\n              </div>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3\">\n            <div className=\"col-span-1 sm:col-span-2 bg-white overflow-hidden shadow rounded-lg\">\n              <div className=\"px-4 py-5 sm:px-6\">\n                <h3 className=\"font-semibold text-lg text-gray-900\">イベント予定</h3>\n              </div>\n              <div className=\"border-t border-gray-200\">\n                {events?.length === 0 ? (\n                  <div className=\"px-4 py-5 sm:px-6 text-gray-500\">直近のイベントはありません。</div>\n                ) : (\n                  <ul role=\"list\" className=\"divide-y divide-gray-200\">\n                    {events?.map((event) => {\n                      const isCanceled = event.is_canceled\n                      const status = event.public_status || (event.is_tentative ? 'date_undecided' : 'finalized')\n\n                      return (\n                        <li key={event.id} className={`group relative hover:bg-gray-50 ${isCanceled ? 'bg-gray-50' : ''}`}>\n                          <div className=\"px-4 py-4 sm:px-6\">\n                            <div className=\"flex items-center justify-between\">\n                              {/* Main Content Area - Clickable via absolute link */}\n                              <div className=\"flex flex-col relative z-0\">\n                                <Link href={`/events/${event.id}`} className=\"absolute inset-0 z-10 w-full h-full focus:outline-none\">\n                                  <span className=\"sr-only\">イベント詳細を見る</span>\n                                </Link>\n                                <div className=\"flex items-center gap-2 mb-1 pointer-events-none\">\n                                  {status === 'draft' && (\n                                    <span className=\"inline-flex items-center rounded-md bg-gray-100 px-1.5 py-0.5 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\">下書き</span>\n                                  )}\n                                  {isCanceled && (\n                                    <span className=\"inline-flex items-center rounded-md bg-red-50 px-1.5 py-0.5 text-xs font-bold text-red-700 ring-1 ring-inset ring-red-600/10\">中止</span>\n                                  )}\n                                  {status === 'details_undecided' && !isCanceled && (\n                                    <span className=\"inline-flex items-center rounded-md bg-yellow-50 px-1.5 py-0.5 text-xs font-bold text-yellow-700 ring-1 ring-inset ring-yellow-600/10\">詳細未定</span>\n                                  )}\n\n                                  {/* Child Attendance Icons */}\n                                  {children && children.length > 0 && !isCanceled && (\n                                    <div className=\"flex items-center gap-1 ml-1\" title=\"出席状況\">\n                                      {(children || []).map(child => {\n                                        const isAttending = eventAttendanceMap.get(event.id)?.has(child.id)\n                                        return (\n                                          <div\n                                            key={child.id}\n                                            title={`${child.first_name}: ${isAttending ? '参加' : '参加しない'}`}\n                                            className={`\n                                              flex items-center justify-center w-5 h-5 rounded-full border \n                                              ${isAttending\n                                                ? 'bg-green-100 border-green-200 text-green-700'\n                                                : 'bg-gray-50 border-gray-200 text-gray-300'\n                                              }\n                                            `}\n                                          >\n                                            <span className=\"text-[10px] font-bold\">\n                                              <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill={isAttending ? \"currentColor\" : \"none\"} stroke=\"currentColor\" strokeWidth=\"2.5\" className=\"w-3 h-3\">\n                                                <circle cx=\"12\" cy=\"12\" r=\"10\" />\n                                              </svg>\n                                            </span>\n                                          </div>\n                                        )\n                                      })}\n                                    </div>\n                                  )}\n\n                                  <p className={`text-sm font-bold text-indigo-600 truncate ${isCanceled ? 'line-through opacity-50' : ''}`}>{event.title}</p>\n                                </div>\n                                <p className={`mt-1 text-xs text-gray-500 pointer-events-none ${isCanceled ? 'line-through opacity-50' : ''}`}>\n                                  {status === 'date_undecided' ? (\n                                    <span className=\"text-pink-600 font-bold\">【日時未定】</span>\n                                  ) : (\n                                    <>\n                                      {new Date(event.scheduled_date).toLocaleDateString()} {event.start_time ? event.start_time.slice(0, 5) : ''}\n                                    </>\n                                  )}\n                                  {event.location && ` @ ${event.location}`}\n                                </p>\n                              </div>\n\n                              {/* Right Side Actions - z-index higher than link to be clickable */}\n                              <div className=\"flex items-center gap-3 relative z-20\">\n                                {!isCanceled && !event.is_tentative && (\n                                  <GoogleCalendarButton\n                                    title={event.title}\n                                    description={event.description}\n                                    date={event.scheduled_date}\n                                    startTime={event.start_time}\n                                    location={event.location}\n                                    associationName={associationName}\n                                  />\n                                )}\n\n                                {event.rsvp_required && !isCanceled ? (\n                                  <span className=\"inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\">\n                                    詳細・出欠\n                                  </span>\n                                ) : (\n                                  <span className=\"inline-flex items-center rounded-md bg-gray-50 px-2.5 py-1.5 text-xs font-medium text-gray-500 border border-gray-200\">\n                                    {isCanceled ? '受付停止' : '自由参加'}\n                                  </span>\n                                )}\n                                <ChevronRight className=\"h-5 w-5 text-gray-400\" aria-hidden=\"true\" />\n                              </div>\n                            </div>\n                          </div>\n                        </li>\n                      )\n                    })}\n                  </ul>\n                )}\n              </div>\n            </div>\n          </div>\n\n        </div>\n      </main>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/profile/DeleteChildButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/profile/ProfileForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[172,175],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[172,175],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client'\n\nimport { Input } from '@/components/ui/input'\nimport { useState } from 'react'\nimport { updateProfile } from '../actions/profile'\n\ntype Props = {\n  profile: any\n}\n\nexport default function ProfileForm({ profile }: Props) {\n  const [message, setMessage] = useState<string | null>(null)\n\n  const handleSubmit = async (formData: FormData) => {\n    setMessage(null)\n    const result = await updateProfile(formData)\n\n    if (result) {\n      setMessage(result.message)\n      if (result.success) {\n        setTimeout(() => setMessage(null), 3000)\n      }\n    }\n  }\n\n  return (\n    <form action={handleSubmit} className=\"space-y-6\">\n      {message && (\n        <div className={`border px-4 py-3 rounded ${message.includes('失敗') || message.includes('エラー') ? 'bg-red-50 border-red-200 text-red-700' : 'bg-green-50 border-green-200 text-green-700'}`}>\n          {message}\n        </div>\n      )}\n      <div className=\"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6\">\n        <div className=\"sm:col-span-3\">\n          <label className=\"block text-sm font-medium text-gray-700\">お名前 <span className=\"text-red-500\">*</span></label>\n          <div className=\"mt-1 flex gap-2\">\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"last_name\" placeholder=\"苗字\" defaultValue={profile?.last_name || ''} required />\n            </div>\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"first_name\" placeholder=\"名前\" defaultValue={profile?.first_name || ''} required />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label className=\"block text-sm font-medium text-gray-700\">ふりがな</label>\n          <div className=\"mt-1 flex gap-2\">\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"last_name_kana\" placeholder=\"みょうじ\" defaultValue={profile?.last_name_kana || ''} />\n            </div>\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"first_name_kana\" placeholder=\"なまえ\" defaultValue={profile?.first_name_kana || ''} />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">メールアドレス</label>\n          <div className=\"mt-1\">\n            <Input type=\"email\" name=\"email\" id=\"email\" defaultValue={profile?.email || ''} disabled />\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">電話番号</label>\n          <div className=\"mt-1\">\n            <Input type=\"tel\" name=\"phone\" id=\"phone\" defaultValue={profile?.phone || ''} />\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-6\">\n          <label htmlFor=\"address\" className=\"block text-sm font-medium text-gray-700\">住所</label>\n          <div className=\"mt-1\">\n            <Input type=\"text\" name=\"address\" id=\"address\" defaultValue={profile?.address || ''} />\n          </div>\n        </div>\n      </div>\n      <div className=\"flex justify-end\">\n        <button type=\"submit\" className=\"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\">\n          保存する\n        </button>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/profile/children/new/ChildForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/profile/children/new/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/app/profile/page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/Breadcrumbs.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":56,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":56,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1622,1625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1622,1625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":56,"column":32,"nodeType":null,"messageId":"unusedVar","endLine":56,"endColumn":37}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\n'use client'\n\nimport Link from 'next/link'\nimport { usePathname } from 'next/navigation'\nimport { ChevronRight, Home } from 'lucide-react'\n\nconst LABEL_MAP: Record<string, string> = {\n  admin: 'ダッシュボード',\n  members: '会員名簿',\n  events: 'イベント',\n  officers: '役員任命',\n  roles: '役職管理',\n  templates: 'テンプレート',\n  notifications: 'お知らせ配信',\n  settings: '設定',\n  new: '新規作成',\n}\n\nconst isUuid = (str: string) => {\n  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;\n  return uuidRegex.test(str);\n}\n\nexport default function Breadcrumbs() {\n  const pathname = usePathname()\n  const segments = pathname.split('/').filter(Boolean)\n\n  // Generate crumbs\n  const crumbs = segments.map((segment, index) => {\n    const href = `/${segments.slice(0, index + 1).join('/')}`\n\n    let label = LABEL_MAP[segment] || segment\n\n    // Fallback for IDs\n    if (isUuid(segment) || !isNaN(Number(segment))) {\n      label = '詳細・編集'\n    }\n\n    // Special case for root 'admin'\n    if (segment === 'admin' && segments.length === 1) {\n      return null // Don't show redundant 'Dashboard' if we are on dashboard root, or maybe we do? \n      // Let's keep it consistent: Home > Dashboard > ...\n    }\n\n    return { href, label, isLast: index === segments.length - 1 }\n  }).filter(Boolean)\n\n  if (pathname === '/admin') return null;\n\n  return (\n    <nav className=\"flex items-center text-sm text-muted-foreground mb-6\" aria-label=\"Breadcrumb\">\n      <Link href=\"/admin\" className=\"flex items-center hover:text-foreground transition-colors\">\n        <Home className=\"h-4 w-4\" />\n      </Link>\n      {crumbs.map((crumb: any, index) => (\n        <div key={crumb.href} className=\"flex items-center\">\n          <ChevronRight className=\"h-4 w-4 mx-2 text-muted-foreground/50\" />\n          {crumb.isLast ? (\n            <span className=\"font-medium text-foreground\">{crumb.label}</span>\n          ) : (\n            <Link href={crumb.href} className=\"hover:text-foreground transition-colors\">\n              {crumb.label}\n            </Link>\n          )}\n        </div>\n      ))}\n    </nav>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/FiscalYearSwitcher.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/GoogleCalendarButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/AdminFormLayout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/AdminNavLinks.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/AdminPageHeader.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/AnnualScheduleEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Calendar' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CheckCircle2' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":47},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'HelpCircle' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":49,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPending' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":36,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'startTransition' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":36,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":36,"endColumn":36},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isPending' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":213,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":213,"endColumn":19},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'dStr' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":588,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":588,"endColumn":13}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useTransition, Fragment } from 'react'\nimport { upsertEvent, deleteEvent } from '@/app/actions/events'\nimport { Calendar, Trash2, Edit2, CheckCircle2, HelpCircle, Save, X, Printer, Download, Calendar as CalendarIcon, AlertTriangle } from 'lucide-react'\nimport MarkdownEditor from '@/components/ui/MarkdownEditor'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport { toWarekiYear } from '@/lib/date-utils'\n\n// Extended Event type to include is_tentative and is_canceled\ntype Event = {\n  id: string\n  public_status: 'draft' | 'date_undecided' | 'details_undecided' | 'finalized'\n  title: string\n  description: string | null\n  scheduled_date: string // Date string YYYY-MM-DD\n  scheduled_end_date: string | null // Date string YYYY-MM-DD or null\n  start_time: string | null // Time string HH:MM:SS or null\n  location: string | null\n  is_tentative: boolean\n  is_canceled: boolean\n  organizer: string\n}\n\ntype Props = {\n  year: number\n  events: Event[]\n  eraName: string\n  startYear: number\n}\n\nconst MONTHS = [4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3]\n\nexport default function AnnualScheduleEditor({ year, events, eraName, startYear }: Props) {\n  const [isPending, startTransition] = useTransition()\n  const [editingEventId, setEditingEventId] = useState<string | null>(null)\n  const [isAddingMonth, setIsAddingMonth] = useState<number | null>(null)\n\n  const warekiYear = toWarekiYear(year, eraName, startYear)\n\n  const getEventsForMonth = (targetMonth: number) => {\n    return events.filter(e => {\n      const d = new Date(e.scheduled_date)\n      const m = d.getMonth() + 1\n      return m === targetMonth\n    })\n  }\n\n  const handleDownloadIcs = () => {\n    const content = generateEventIcs(events)\n    const blob = new Blob([content], { type: 'text/calendar' })\n    const url = URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = `年度活動予定_${year}.ics`\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n  }\n\n  // Get current date/time for \"Last Updated\" / edition management\n  const now = new Date()\n  const printedDate = `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日 ${now.getHours()}:${now.getMinutes() < 10 ? '0' : ''}${now.getMinutes()} 現在`\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 print:hidden\">\n        <div>\n          <h2 className=\"text-xl font-bold print:text-lg\">{warekiYear}度 年間活動予定</h2>\n          <p className=\"text-sm text-gray-500 mt-1 print:text-xs\">\n            最終発行: {printedDate}\n          </p>\n        </div>\n        <div className=\"flex gap-2 flex-wrap\">\n          <button\n            onClick={handleDownloadIcs}\n            className=\"flex items-center gap-2 px-3 py-2 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 text-sm font-medium\"\n          >\n            <Download size={16} /> ICSダウンロード\n          </button>\n          <button\n            onClick={() => window.print()}\n            className=\"flex items-center gap-2 px-3 py-2 bg-indigo-600 text-white rounded shadow-sm hover:bg-indigo-700 text-sm font-medium\"\n          >\n            <Printer size={16} /> 印刷 / PDF保存\n          </button>\n        </div>\n      </div>\n\n      <div className=\"hidden print:block mb-4 text-right text-sm text-gray-500\">\n        <div>{warekiYear}度 年間活動予定表</div>\n        <div className=\"text-xs\">発行日: {printedDate} (最新版をご確認ください)</div>\n      </div>\n\n      {/* Table Structure for Print and Desktop */}\n      <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden print:border-2 print:border-black print:text-xs\">\n        <table className=\"min-w-full divide-y divide-gray-200 print:divide-black\">\n          <thead className=\"bg-gray-50 print:bg-gray-100\">\n            <tr>\n              <th scope=\"col\" className=\"px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-24 print:text-black border-r print:border-black print:py-1 print:w-16\">月</th>\n              <th scope=\"col\" className=\"px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-32 print:text-black border-r print:border-black print:py-1 print:w-20\">日時</th>\n              <th scope=\"col\" className=\"px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider print:text-black border-r print:border-black print:py-1\">イベント名 / 詳細</th>\n              <th scope=\"col\" className=\"px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-32 print:text-black border-r print:border-black print:py-1 print:w-20\">場所</th>\n              <th scope=\"col\" className=\"px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-24 print:text-black border-r print:border-black print:py-1 print:w-16\">主催</th>\n              <th scope=\"col\" className=\"px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider w-20 print:hidden\">操作</th>\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200 print:divide-black\">\n            {MONTHS.map(month => {\n              const monthEvents = getEventsForMonth(month)\n              const displayYear = month >= 4 ? year : year + 1\n\n              if (monthEvents.length === 0 && isAddingMonth !== month) {\n                return (\n                  <tr key={month} className=\"group hover:bg-gray-50 print:break-inside-avoid print:h-4\">\n                    <td className=\"px-3 py-4 text-sm text-gray-900 border-r border-gray-100 print:border-black font-bold align-top bg-gray-50/50 print:bg-transparent print:py-1 print:text-xs\">\n                      <div className=\"flex items-center justify-between\">\n                        <span>{month}月</span>\n                        <button\n                          onClick={() => {\n                            setIsAddingMonth(month)\n                            setEditingEventId(null)\n                          }}\n                          className=\"print:hidden text-xs text-indigo-600 hover:bg-indigo-50 rounded px-1 opacity-0 group-hover:opacity-100 transition-opacity\"\n                        >\n                          +\n                        </button>\n                      </div>\n                    </td>\n                    <td colSpan={5} className=\"px-3 py-4 text-sm text-gray-400 italic text-center print:hidden\">\n                      予定なし\n                    </td>\n                    {/* For print, maybe we skip empty months or show them empty? Requirements imply \"Schedule\", implying list of events. But empty months are placeholders. Let's show empty cell for print too but minimal */}\n                    <td colSpan={3} className=\"hidden print:table-cell px-3 py-4 text-sm text-gray-400 italic text-center text-xs print:py-1 print:text-[10px] print:h-4\">\n                      -\n                    </td>\n                  </tr>\n                )\n              }\n\n              // Fragments for mapping\n              return (\n                <Fragment key={month}>\n                  {monthEvents.map((event, index) => (\n                    <EventRow\n                      key={event.id}\n                      event={event}\n                      year={displayYear}\n                      month={month}\n\n                      rowSpan={monthEvents.length + (isAddingMonth === month ? 1 : 0)}\n                      isEditing={editingEventId === event.id}\n                      onEdit={() => setEditingEventId(event.id)}\n                      onCancel={() => setEditingEventId(null)}\n                      onAdd={() => setIsAddingMonth(month)}\n                      showMonthCell={index === 0}\n                    />\n                  ))}\n                  {isAddingMonth === month && (\n                    <tr className=\"bg-indigo-50 border-t-2 border-indigo-200 print:hidden\">\n                      {monthEvents.length === 0 && (\n                        <td className=\"px-3 py-4 text-sm font-bold text-gray-900 border-r border-gray-200 bg-gray-50 align-top\">\n                          {month}月\n                        </td>\n                      )}\n                      <td colSpan={5} className=\"p-4\">\n                        <div className=\"bg-white p-4 rounded-lg shadow-sm border border-indigo-200\">\n                          <h4 className=\"font-bold text-indigo-700 mb-3 flex items-center gap-2\">\n                            <CalendarIcon size={16} /> {toWarekiYear(displayYear, eraName, startYear)} {month}月 新規イベント追加\n                          </h4>\n                          <EventForm\n                            year={displayYear}\n                            month={month}\n                            onCancel={() => setIsAddingMonth(null)}\n                            onComplete={() => setIsAddingMonth(null)}\n                          />\n                        </div>\n                      </td>\n                    </tr>\n                  )}\n                </Fragment>\n              )\n            })}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  )\n}\n\nfunction EventRow({\n  event,\n  year,\n  month,\n  isEditing,\n  onEdit,\n  onCancel,\n  showMonthCell,\n  rowSpan,\n  onAdd\n}: {\n  event: Event,\n  year: number,\n  month: number,\n  isEditing: boolean,\n  onEdit: () => void,\n  onCancel: () => void\n  showMonthCell: boolean\n  rowSpan: number\n  onAdd: () => void\n}) {\n  const [isPending, startTransition] = useTransition()\n\n  const handleDelete = async () => {\n    if (!confirm('本当に削除しますか？')) return\n    const formData = new FormData()\n    formData.append('id', event.id)\n    startTransition(async () => {\n      await deleteEvent(formData)\n    })\n  }\n\n  if (isEditing) {\n    return (\n      <tr className=\"bg-indigo-50 print:hidden\">\n        {showMonthCell && (\n          <td rowSpan={rowSpan} className=\"px-3 py-4 text-sm font-bold text-gray-900 border-r border-gray-200 align-top bg-gray-50\">\n            {month}月\n          </td>\n        )}\n        <td colSpan={5} className=\"p-4\">\n          <div className=\"bg-white p-4 rounded border border-indigo-200 shadow-sm\">\n            <EventForm\n              event={event}\n              year={year}\n              month={month}\n              onCancel={onCancel}\n              onComplete={onCancel}\n            />\n          </div>\n        </td>\n      </tr>\n    )\n  }\n\n  const eventDate = new Date(event.scheduled_date)\n  const timeString = event.start_time ? event.start_time.slice(0, 5) : null\n  const dayName = ['日', '月', '火', '水', '木', '金', '土'][eventDate.getDay()]\n\n  const isCanceled = event.is_canceled\n  const publicStatus = event.public_status || (event.is_tentative ? 'date_undecided' : 'finalized')\n\n  const rowClass = isCanceled\n    ? 'bg-gray-100 text-gray-500 print:bg-gray-200'\n    : (publicStatus === 'draft' ? 'bg-gray-100 border-l-4 border-gray-400' : 'bg-white')\n  const textDecoration = isCanceled ? 'line-through' : ''\n\n  const googleCalUrl = getGoogleCalendarUrl(event)\n\n  return (\n    <tr className={`${rowClass} hover:bg-gray-50 group print:break-inside-avoid`}>\n      {showMonthCell && (\n        <td rowSpan={rowSpan} className=\"px-3 py-4 text-sm font-bold text-gray-900 border-r border-gray-200 print:border-black align-top bg-gray-50/50 print:bg-transparent min-w-[3rem] print:py-1 print:text-xs\">\n          <div className=\"flex justify-between print:justify-center\">\n            <span className=\"text-xl print:text-sm\">{month}</span>\n            <span className=\"text-xs pt-1 print:hidden\">月</span>\n            <button\n              onClick={onAdd}\n              className=\"print:hidden text-xs text-indigo-600 hover:bg-indigo-50 rounded px-1 opacity-0 group-hover:opacity-100 transition-opacity ml-1\"\n              title=\"この月に追加\"\n            >\n              +\n            </button>\n          </div>\n        </td>\n      )}\n      <td className=\"px-3 py-3 text-sm text-gray-900 border-r border-gray-100 print:border-black align-top whitespace-nowrap print:py-1 print:text-xs\">\n        {publicStatus === 'date_undecided' ? (\n          <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 border border-gray-300 print:border-0 print:p-0\">\n            日時未定\n          </span>\n        ) : (\n          <div className={isCanceled ? 'opacity-50' : ''}>\n            <div className=\"font-bold\">\n              {eventDate.getDate()}日 <span className=\"text-xs font-normal text-gray-500 print:hidden\">({dayName})</span><span className=\"hidden print:inline text-[10px]\">({dayName})</span>\n            </div>\n            {event.scheduled_end_date && (\n              <div className=\"text-xs text-gray-500 print:text-[10px]\">\n                〜 {new Date(event.scheduled_end_date).getDate()}日\n              </div>\n            )}\n            {timeString && (\n              <div className=\"text-xs text-gray-600 mt-1 print:text-[10px] print:mt-0\">\n                {timeString} ~\n              </div>\n            )}\n          </div>\n        )}\n      </td>\n      <td className=\"px-3 py-3 text-sm text-gray-900 border-r border-gray-100 print:border-black align-top print:py-1 print:text-xs\">\n        <div className=\"flex items-center gap-2 flex-wrap\">\n          {publicStatus === 'draft' && (\n            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-gray-500 text-white print:hidden\">\n              下書き (非公開)\n            </span>\n          )}\n          {isCanceled && (\n            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-red-100 text-red-800 border border-red-200 print:bg-transparent print:text-gray-500 print:border-black print:text-[10px] print:p-0 print:px-1\">\n              中止\n            </span>\n          )}\n          {!isCanceled && publicStatus === 'details_undecided' && (\n            <span className=\"inline-flex items-center px-2 py-0.5 rounded text-xs font-bold bg-yellow-100 text-yellow-800 border border-yellow-200 print:border-black print:text-[10px] print:p-0 print:px-1\">\n              詳細未定\n            </span>\n          )}\n          <span className={`font-bold ${textDecoration} ${isCanceled ? 'text-gray-400' : 'text-gray-900'}`}>\n            {event.title}\n          </span>\n          {publicStatus === 'date_undecided' && !isCanceled && (\n            <span className=\"text-xs text-gray-400 border border-gray-200 rounded px-1 print:border-0 print:text-gray-500\">(予定)</span>\n          )}\n        </div>\n        {event.description && (\n          <div className={`mt-1 text-xs text-gray-600 prose prose-sm max-w-none print:text-black print:text-[10px] print:leading-tight print:mt-0 ${isCanceled ? 'line-through opacity-50' : ''}`}>\n            <ReactMarkdown remarkPlugins={[remarkGfm]}>{event.description}</ReactMarkdown>\n          </div>\n        )}\n      </td>\n      <td className={`px-3 py-3 text-sm text-gray-600 border-r border-gray-100 print:border-black align-top ${textDecoration} print:py-1 print:text-xs`}>\n        {event.location || '-'}\n      </td>\n      <td className=\"px-3 py-3 text-sm text-gray-600 border-r border-gray-100 print:border-black align-top print:py-1 print:text-xs print:w-16\">\n        {event.organizer}\n      </td>\n      <td className=\"px-3 py-3 text-sm text-right print:hidden align-top\">\n        <div className=\"flex justify-end gap-1 opacity-10 sm:opacity-0 group-hover:opacity-100 transition-opacity\">\n          <a\n            href={googleCalUrl}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"p-1.5 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded\"\n            title=\"Googleカレンダーに追加\"\n          >\n            <CalendarIcon size={16} />\n          </a>\n          <button onClick={onEdit} className=\"p-1.5 text-gray-400 hover:text-indigo-600 hover:bg-indigo-50 rounded\" title=\"編集\">\n            <Edit2 size={16} />\n          </button>\n          <button onClick={handleDelete} className=\"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded\" title=\"削除\">\n            <Trash2 size={16} />\n          </button>\n        </div>\n      </td>\n    </tr>\n  )\n}\n\nfunction EventForm({ event, year, month, onCancel, onComplete }: { event?: Event, year: number, month: number, onCancel: () => void, onComplete: () => void }) {\n  const [isPending, startTransition] = useTransition()\n\n  // Initial date default\n  const initialDate = event\n    ? event.scheduled_date\n    : `${year}-${month.toString().padStart(2, '0')}-01`\n\n  // Initial time default\n  const initialTime = event?.start_time ? event.start_time.slice(0, 5) : ''\n\n  const [startDate, setStartDate] = useState(initialDate)\n  const [showEndDateInput, setShowEndDateInput] = useState(!!event?.scheduled_end_date)\n  const [isCanceled, setIsCanceled] = useState(event?.is_canceled || false)\n\n  const handleSubmit = async (formData: FormData) => {\n    if (event?.id) formData.append('id', event.id)\n\n    startTransition(async () => {\n      await upsertEvent(formData)\n      onComplete()\n    })\n  }\n\n  return (\n    <form action={handleSubmit} className=\"space-y-4\">\n      <div className=\"grid grid-cols-1 sm:grid-cols-12 gap-4\">\n        <div className=\"sm:col-span-8\">\n          <label className=\"block text-xs font-bold text-gray-700 mb-1\">イベント名 <span className=\"text-red-500\">*</span></label>\n          <input\n            name=\"title\"\n            defaultValue={event?.title}\n            placeholder=\"イベント名\"\n            required\n            className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n          />\n        </div>\n\n        <div className=\"sm:col-span-4 rounded bg-red-50 p-2 border border-red-100 flex items-center\">\n          <label className=\"flex items-center gap-2 text-sm text-red-800 font-bold cursor-pointer w-full\">\n            <input\n              type=\"checkbox\"\n              name=\"is_canceled\"\n              value=\"true\"\n              checked={isCanceled}\n              onChange={e => setIsCanceled(e.target.checked)}\n              className=\"rounded border-red-300 text-red-600 focus:ring-red-500\"\n            />\n            <AlertTriangle size={16} />\n            中止にする\n          </label>\n        </div>\n\n        <div className=\"sm:col-span-12\">\n          <label className=\"block text-xs text-gray-500 mb-1\">主催</label>\n          <div className=\"flex gap-4 flex-wrap\">\n            {['単位子ども会', '町子供会育成連合会', 'その他'].map(org => (\n              <label key={org} className=\"flex items-center gap-1 text-sm text-gray-700 cursor-pointer\">\n                <input type=\"radio\" name=\"organizer\" value={org} defaultChecked={(event?.organizer || '単位子ども会') === org} className=\"text-indigo-600 focus:ring-indigo-500\" />\n                {org}\n              </label>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-6\">\n          <label className=\"block text-xs text-gray-500 mb-1\">日付 <span className=\"text-red-500\">*</span></label>\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"date\"\n              name=\"scheduled_date\"\n              defaultValue={initialDate}\n              onChange={(e) => setStartDate(e.target.value)}\n              className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n              required\n            />\n          </div>\n          <div className=\"mt-1\">\n            {!showEndDateInput ? (\n              <button\n                type=\"button\"\n                onClick={() => setShowEndDateInput(true)}\n                className=\"text-xs text-indigo-600 hover:text-indigo-800 underline flex items-center gap-1\"\n              >\n                + 終了日(期間)を追加\n              </button>\n            ) : (\n              <div className=\"flex items-center gap-2 mt-1 bg-gray-50 p-1.5 rounded border border-dashed border-gray-300\">\n                <span className=\"text-xs text-gray-500\">終了日:</span>\n                <input\n                  type=\"date\"\n                  name=\"scheduled_end_date\"\n                  defaultValue={event?.scheduled_end_date || startDate}\n                  className=\"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-xs py-1\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowEndDateInput(false)}\n                  className=\"text-gray-400 hover:text-red-500\"\n                >\n                  <X size={14} />\n                </button>\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-6\">\n          <label className=\"block text-xs text-gray-500 mb-1\">開始時間 (任意)</label>\n          <input\n            type=\"time\"\n            name=\"start_time\"\n            defaultValue={initialTime}\n            className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n          />\n          <label className=\"block text-xs font-bold text-gray-700 mb-1\">公開ステータス</label>\n          <div className=\"flex flex-col gap-2\">\n            {[\n              { value: 'draft', label: '告知前（下書き/役員のみ）' },\n              { value: 'date_undecided', label: '告知・日時未定' },\n              { value: 'details_undecided', label: '告知・日時決定・詳細未定' },\n              { value: 'finalized', label: '告知・詳細決定' },\n            ].map(status => (\n              <label key={status.value} className=\"flex items-center gap-2 text-sm text-gray-700 cursor-pointer\">\n                <input\n                  type=\"radio\"\n                  name=\"public_status\"\n                  value={status.value}\n                  defaultChecked={event?.public_status ? event.public_status === status.value : (status.value === 'finalized')}\n                  className=\"text-indigo-600 focus:ring-indigo-500\"\n                />\n                {status.label}\n              </label>\n            ))}\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-12\">\n          <label className=\"block text-xs text-gray-500 mb-1\">場所</label>\n          <input\n            name=\"location\"\n            defaultValue={event?.location || ''}\n            placeholder=\"公民館、小学校など\"\n            className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n          />\n        </div>\n\n        <div className=\"sm:col-span-12\">\n          <label className=\"block text-xs text-gray-500 mb-1\">詳細・備考 (Markdown)</label>\n          <MarkdownEditor\n            name=\"description\"\n            defaultValue={event?.description || ''}\n            placeholder=\"持ち物、注意事項など\"\n            rows={4}\n          />\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-3 pt-3 border-t border-gray-100\">\n        <button type=\"button\" onClick={onCancel} className=\"px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 bg-white border border-gray-300 rounded shadow-sm\">\n          キャンセル\n        </button>\n        <button type=\"submit\" disabled={isPending} className=\"px-4 py-2 text-sm text-white bg-indigo-600 hover:bg-indigo-700 rounded shadow-sm disabled:opacity-50 flex items-center gap-2 font-bold\">\n          <Save size={16} />\n          {event ? '変更を保存' : '追加する'}\n        </button>\n      </div>\n    </form>\n  )\n}\n\nfunction generateEventIcs(events: Event[]) {\n  let content = 'BEGIN:VCALENDAR\\nVERSION:2.0\\nPRODID:-//Kodomokai//AnnualEvents//EN\\n'\n  events.forEach(event => {\n    if (event.is_canceled) return // Skip canceled events? Or include as cancelled? Usually skip or STATUS:CANCELLED\n    // Implementation: STATUS:CANCELLED exists in ICS.\n\n    // ... (logic from before) ...\n    // Reuse previous logic but add STATUS properties\n    const dateStr = event.scheduled_date.replace(/-/g, '')\n    const timeStr = event.start_time ? event.start_time.replace(/:/g, '').slice(0, 4) + '00' : '100000'\n    const start = `${dateStr}T${timeStr}`\n\n    let end = ''\n    if (event.scheduled_end_date) {\n      const dEnd = new Date(`${event.scheduled_end_date}T${event.start_time || '12:00:00'}`)\n      if (!event.start_time) {\n        dEnd.setHours(17)\n      } else {\n        dEnd.setHours(dEnd.getHours() + 2)\n      }\n      const pad = (n: number) => n.toString().padStart(2, '0')\n      const endDateStr = `${dEnd.getFullYear()}${pad(dEnd.getMonth() + 1)}${pad(dEnd.getDate())}`\n      const endTimeStr = `${pad(dEnd.getHours())}${pad(dEnd.getMinutes())}00`\n      end = `${endDateStr}T${endTimeStr}`\n    } else {\n      const d = new Date(`${event.scheduled_date}T${event.start_time || '10:00:00'}`)\n      d.setHours(d.getHours() + 2)\n      const pad = (n: number) => n.toString().padStart(2, '0')\n      const endDateStr = `${d.getFullYear()}${pad(d.getMonth() + 1)}${pad(d.getDate())}`\n      const endTimeStr = `${pad(d.getHours())}${pad(d.getMinutes())}00`\n      end = `${endDateStr}T${endTimeStr}`\n    }\n\n    content += 'BEGIN:VEVENT\\n'\n    content += `SUMMARY:${event.title}\\n`\n    content += `DTSTART:${start}\\n`\n    content += `DTEND:${end}\\n`\n    if (event.description) content += `DESCRIPTION:${event.description.replace(/\\n/g, '\\\\n')}\\n`\n    if (event.location) content += `LOCATION:${event.location}\\n`\n    // Status\n    if (event.is_canceled) content += `STATUS:CANCELLED\\n`\n    else if (event.is_tentative) content += `STATUS:TENTATIVE\\n`\n    else content += `STATUS:CONFIRMED\\n`\n\n    content += 'END:VEVENT\\n'\n  })\n  content += 'END:VCALENDAR'\n  return content\n}\n\nfunction getGoogleCalendarUrl(event: Event) {\n  const title = encodeURIComponent(event.title)\n  const details = encodeURIComponent(event.description || '')\n  const location = encodeURIComponent(event.location || '')\n\n  // Dates\n  const d = new Date(event.scheduled_date)\n  const dStr = d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z' // UTC\n\n  // Google Calendar Link Format needs Dates in UTC or specified timezone.\n  // Simplest is YYYYMMDD/YYYYMMDD for all day, or YYYYMMDDThhmmss/YYYYMMDDThhmmss for specific time\n\n  // Let's construct manually to avoid timezone confusion (treat input as local)\n  const pad = (n: number) => n.toString().padStart(2, '0')\n  const YMD = (date: Date) => `${date.getFullYear()}${pad(date.getMonth() + 1)}${pad(date.getDate())}`\n\n  let start = YMD(new Date(event.scheduled_date))\n  let end = start\n\n  if (event.scheduled_end_date) {\n    end = YMD(new Date(event.scheduled_end_date))\n    // GCal end date is exclusive for all day events.\n    // If it's all day, we need to add 1 day to end.\n    if (!event.start_time) {\n      const nextDay = new Date(event.scheduled_end_date)\n      nextDay.setDate(nextDay.getDate() + 1)\n      end = YMD(nextDay)\n    }\n  } else if (!event.start_time) {\n    // Single day all day -> End is next day\n    const nextDay = new Date(event.scheduled_date)\n    nextDay.setDate(nextDay.getDate() + 1)\n    end = YMD(nextDay)\n  }\n\n  // If time exists\n  if (event.start_time) {\n    const t = event.start_time.replace(/:/g, '') + '00' // HHMMSS\n    start += `T${t}`\n    // End time? Assume +2 hours if not specified\n    // Since we don't have end_time in DB, we guess.\n    // If we had end date but no end time, we assume end of day? No, usually events have duration.\n    // Let's just add 2 hours to start time for end check\n    // But wait, if end date is different...\n\n    // Simplified:\n    // If start time is present, use it.\n    // End time: +2h\n    const [h, m] = event.start_time.split(':').map(Number)\n    const endDateObj = event.scheduled_end_date ? new Date(event.scheduled_end_date) : new Date(event.scheduled_date)\n    endDateObj.setHours(h + 2, m)\n\n    end = YMD(endDateObj) + `T${pad(endDateObj.getHours())}${pad(endDateObj.getMinutes())}00`\n  }\n\n  return `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${start}/${end}&details=${details}&location=${location}`\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/BulkExportButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/ConstitutionEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setContent' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":26,"column":19,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":29}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useTransition } from 'react'\nimport { Printer, Save, FileText, Calendar, History } from 'lucide-react'\nimport MarkdownEditor from '@/components/ui/MarkdownEditor'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport { upsertConstitution } from '@/app/admin/actions/constitution'\n\ntype Constitution = {\n  id: string\n  title: string\n  content: string\n  version_date: string\n  version_name: string | null\n  updated_at: string\n}\n\ntype Props = {\n  initialData: Constitution | null\n}\n\nexport default function ConstitutionEditor({ initialData }: Props) {\n  const [isPending, startTransition] = useTransition()\n  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string } | null>(null)\n  const [content, setContent] = useState(initialData?.content || '')\n\n  const handleSubmit = async (formData: FormData) => {\n    setMessage(null)\n    startTransition(async () => {\n      const result = await upsertConstitution(formData)\n      if (result.success) {\n        setMessage({ type: 'success', text: result.message })\n      } else {\n        setMessage({ type: 'error', text: result.message })\n      }\n    })\n  }\n\n  const handlePrint = () => {\n    window.print()\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Alert Message */}\n      {message && (\n        <div className={`p-4 rounded-md border ${message.type === 'success' ? 'bg-green-50 border-green-200 text-green-700' : 'bg-red-50 border-red-200 text-red-700'\n          }`}>\n          {message.text}\n        </div>\n      )}\n\n      {/* Editor Controls - Hidden on Print */}\n      <div className=\"bg-white p-6 shadow sm:rounded-md border border-gray-200 print:hidden\">\n        <form action={handleSubmit} className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-2\">\n                <FileText size={16} className=\"text-gray-400\" />\n                規約タイトル\n              </label>\n              <input\n                type=\"text\"\n                name=\"title\"\n                defaultValue={initialData?.title || '規約'}\n                required\n                className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-2\">\n                <Calendar size={16} className=\"text-gray-400\" />\n                施行日 / 改定日\n              </label>\n              <input\n                type=\"date\"\n                name=\"version_date\"\n                defaultValue={initialData?.version_date || new Date().toISOString().split('T')[0]}\n                required\n                className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-1 flex items-center gap-2\">\n                <History size={16} className=\"text-gray-400\" />\n                版数 (任意)\n              </label>\n              <input\n                type=\"text\"\n                name=\"version_name\"\n                defaultValue={initialData?.version_name || ''}\n                placeholder=\"例: 第1版、2025年度改訂版\"\n                className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm\"\n              />\n            </div>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n              規約内容 (Markdown)\n            </label>\n            <MarkdownEditor\n              name=\"content\"\n              defaultValue={content}\n              rows={20}\n            />\n          </div>\n\n          <div className=\"flex justify-end gap-3 pt-4 border-t border-gray-100\">\n            <button\n              type=\"button\"\n              onClick={handlePrint}\n              className=\"flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-md shadow-sm hover:bg-gray-50 font-medium text-sm transition-colors\"\n            >\n              <Printer size={18} />\n              印刷 / PDFプレビュー\n            </button>\n            <button\n              type=\"submit\"\n              disabled={isPending}\n              className=\"flex items-center gap-2 px-6 py-2 bg-indigo-600 text-white rounded-md shadow-sm hover:bg-indigo-700 font-bold text-sm disabled:opacity-50 transition-colors\"\n            >\n              <Save size={18} />\n              {isPending ? '保存中...' : '規約を保存'}\n            </button>\n          </div>\n        </form>\n      </div>\n\n      {/* Print View / Preview - Inspired by AnnualSchedule (optimized for printing) */}\n      <div className=\"bg-white p-8 shadow sm:rounded-md border border-gray-200 print:shadow-none print:border-none print:p-0\">\n        <div className=\"max-w-3xl mx-auto\">\n          {/* Print Header */}\n          <div className=\"border-b-2 border-black pb-4 mb-8 text-center print:pt-4\">\n            <h1 className=\"text-2xl font-bold text-gray-900\">{initialData?.title || '規約'}</h1>\n            <div className=\"mt-2 flex justify-between text-sm text-gray-500\">\n              <span>{initialData?.version_name}</span>\n              <span>施行日: {initialData?.version_date ? new Date(initialData.version_date).toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' }) : '-'}</span>\n            </div>\n          </div>\n\n          {/* Constitution Content */}\n          <div className=\"prose prose-slate max-w-none print:prose-sm print:text-black\">\n            {initialData?.content ? (\n              <ReactMarkdown remarkPlugins={[remarkGfm]}>\n                {initialData.content}\n              </ReactMarkdown>\n            ) : (\n              <div className=\"text-center py-12 text-gray-400 italic print:hidden\">\n                まだ規約が登録されていません。上のエディタで入力してください。\n              </div>\n            )}\n          </div>\n\n          {/* Print Footer */}\n          <div className=\"mt-12 pt-4 border-t border-gray-100 text-right text-xs text-gray-400 print:border-black print:text-black font-serif\">\n            <div>以上</div>\n            <div className=\"mt-1\">最終更新日: {initialData?.updated_at ? new Date(initialData.updated_at).toLocaleString('ja-JP') : '-'}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/EventListEditButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/MeetingEditor.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/MeetingEditor.tsx:59:7\n  57 |   useEffect(() => {\n  58 |     if (defaultItemsExpanded) {\n> 59 |       setExpandedAgendaIds(agendas.map(a => a.id))\n     |       ^^^^^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  60 |     } else {\n  61 |       // If default is false, we don't necessarily want to close everything if user opened some?\n  62 |       // But if we navigate FROM Detail TO List, we probably want to reset.","line":59,"column":7,"nodeType":null,"endLine":59,"endColumn":27},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'agendas'. Either include it or remove the dependency array. If 'setExpandedAgendaIds' needs the current value of 'agendas', you can also switch to useReducer instead of useState and read 'agendas' in the reducer.","line":65,"column":6,"nodeType":"ArrayExpression","endLine":65,"endColumn":44,"suggestions":[{"desc":"Update the dependencies array to be: [defaultItemsExpanded, agendas.length, agendas]","fix":{"range":[2465,2503],"text":"[defaultItemsExpanded, agendas.length, agendas]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setScheduleForm' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":74,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":74,"endColumn":39}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useTransition, useEffect } from 'react'\nimport { upsertRegularMeeting, upsertMeetingAgenda, deleteMeetingAgenda, copyAgendasFromPreviousYear } from '@/app/actions/meetings'\nimport { generateGoogleCalendarUrl } from '@/lib/calendar'\nimport MarkdownEditor from '@/components/ui/MarkdownEditor'\nimport CopyLinkButton from '@/components/ui/CopyLinkButton'\nimport ReactMarkdown from 'react-markdown'\nimport remarkGfm from 'remark-gfm'\nimport { Calendar, ChevronDown, ChevronUp } from 'lucide-react'\nimport Link from 'next/link'\n\ntype Meeting = {\n  id: string\n  target_year: number\n  target_month: number\n  scheduled_date: string | null\n  start_time: string | null\n  location: string | null\n  description: string | null\n}\n\ntype Agenda = {\n  id: string\n  title: string\n  description: string | null\n  display_order: number\n}\n\ntype Props = {\n  year: number\n  month: number\n  meeting?: Meeting\n  agendas: Agenda[]\n  defaultItemsExpanded?: boolean\n}\n\nexport default function MeetingEditor({ year, month, meeting, agendas, defaultItemsExpanded = false }: Props) {\n  const [isEditingSchedule, setIsEditingSchedule] = useState(false)\n  const [isAddingAgenda, setIsAddingAgenda] = useState(false)\n  const [isAgendasExpanded, setIsAgendasExpanded] = useState(true) // Default Section to OPEN\n  const [editingAgendaId, setEditingAgendaId] = useState<string | null>(null)\n\n  // Lifted state for expanded agenda items\n  // Initialize with all IDs if defaultItemsExpanded is true, otherwise empty\n  const [expandedAgendaIds, setExpandedAgendaIds] = useState<string[]>(() =>\n    defaultItemsExpanded ? agendas.map(a => a.id) : []\n  )\n\n  const [isPending, startTransition] = useTransition()\n\n  // Sync expandedAgendaIds if agendas change (e.g. newly added item) IF we are in \"Always Expand\" mode? \n  // Or just rely on user interaction. \n  // Let's ensure that if we navigate from List to Detail, the state re-initializes correctly (key change or mount).\n  // Next.js navigation preserves state if component tree is identical. \n  // We might want to use a useEffect to enforce defaultItemsExpanded behavior on prop change.\n  useEffect(() => {\n    if (defaultItemsExpanded) {\n      setExpandedAgendaIds(agendas.map(a => a.id))\n    } else {\n      // If default is false, we don't necessarily want to close everything if user opened some?\n      // But if we navigate FROM Detail TO List, we probably want to reset.\n      setExpandedAgendaIds([])\n    }\n  }, [defaultItemsExpanded, agendas.length]) // Re-eval if count changes or prop changes\n\n  const toggleAgendaExpansion = (id: string) => {\n    setExpandedAgendaIds(prev =>\n      prev.includes(id) ? prev.filter(pid => pid !== id) : [...prev, id]\n    )\n  }\n\n  // Schedule Form State\n  const [scheduleForm, setScheduleForm] = useState({\n    scheduled_date: meeting?.scheduled_date || '',\n    start_time: meeting?.start_time || '',\n    location: meeting?.location || '',\n    description: meeting?.description || '',\n  })\n\n  const handleScheduleSubmit = async (formData: FormData) => {\n    formData.append('target_year', year.toString())\n    formData.append('target_month', month.toString())\n    if (meeting?.id) formData.append('id', meeting.id)\n\n    startTransition(async () => {\n      const result = await upsertRegularMeeting(formData)\n      if (result.success) {\n        setIsEditingSchedule(false)\n      } else {\n        alert(result.message)\n      }\n    })\n  }\n\n  const handleCopyAgendas = async () => {\n    if (!meeting?.id) return\n    if (!confirm('昨年度の同月の議題をコピーしますか？')) return\n\n    startTransition(async () => {\n      const result = await copyAgendasFromPreviousYear(meeting.id)\n      if (!result.success) {\n        alert(result.message)\n      }\n    })\n  }\n\n  const handleDeleteAgenda = async (id: string) => {\n    if (!confirm('この議題を削除しますか？')) return\n    const formData = new FormData()\n    formData.append('id', id)\n    startTransition(async () => {\n      await deleteMeetingAgenda(formData)\n    })\n  }\n\n  return (\n    <div className=\"bg-card shadow-sm rounded-lg p-6 mb-6 border border-border\">\n      <div className=\"flex justify-between items-start mb-4\">\n        <div>\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"text-xl font-bold text-foreground flex items-center gap-2\">\n              <span className=\"bg-muted text-muted-foreground text-sm font-medium px-2.5 py-0.5 rounded\">{month}月</span>\n              {meeting?.id ? (\n                <Link href={`/admin/meetings/${meeting.id}`} className=\"hover:underline hover:text-primary transition-colors\">\n                  {meeting?.scheduled_date ? new Date(meeting.scheduled_date).toLocaleDateString('ja-JP', { weekday: 'short', month: 'short', day: 'numeric' }) : '日程未定'}\n                </Link>\n              ) : (\n                <span>\n                  {meeting?.scheduled_date ? new Date(meeting.scheduled_date).toLocaleDateString('ja-JP', { weekday: 'short', month: 'short', day: 'numeric' }) : '日程未定'}\n                </span>\n              )}\n            </h3>\n          </div>\n          <div className=\"text-sm text-muted-foreground mt-1\">\n            {meeting?.start_time?.slice(0, 5) || '--:--'} @ {meeting?.location || '場所未定'}\n          </div>\n          {meeting?.description && <div className=\"text-sm text-muted-foreground mt-1\">{meeting.description}</div>}\n\n          {meeting?.id && (\n            <div className=\"mt-2\">\n              <CopyLinkButton meetingId={meeting.id} />\n            </div>\n          )}\n        </div>\n        <button\n          onClick={() => setIsEditingSchedule(!isEditingSchedule)}\n          className=\"text-sm bg-muted hover:bg-muted/80 text-muted-foreground px-3 py-1 rounded transition-colors\"\n        >\n          {isEditingSchedule ? 'キャンセル' : '日程編集'}\n        </button>\n      </div>\n\n      {meeting?.scheduled_date && (\n        <div className=\"mb-4\">\n          <a\n            href={generateGoogleCalendarUrl(meeting)}\n            target=\"_blank\"\n            rel=\"noreferrer\"\n            className=\"inline-flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-800 hover:underline\"\n          >\n            <Calendar size={14} />\n            Googleカレンダーに登録\n          </a>\n        </div>\n      )}\n\n      {isEditingSchedule && (\n        <form action={handleScheduleSubmit} className=\"mb-6 bg-muted/50 p-4 rounded-lg border border-border\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <label className=\"block text-sm font-medium text-foreground\">開催日</label>\n              <input type=\"date\" name=\"scheduled_date\" defaultValue={scheduleForm.scheduled_date} className=\"mt-1 block w-full rounded-md border-input bg-background shadow-sm focus:border-ring focus:ring-ring text-foreground\" />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium text-foreground\">開始時間</label>\n              <input type=\"time\" name=\"start_time\" defaultValue={scheduleForm.start_time || ''} className=\"mt-1 block w-full rounded-md border-input bg-background shadow-sm focus:border-ring focus:ring-ring text-foreground\" />\n            </div>\n            <div className=\"md:col-span-2\">\n              <label className=\"block text-sm font-medium text-foreground\">場所</label>\n              <input type=\"text\" name=\"location\" defaultValue={scheduleForm.location} placeholder=\"例: 公民館 第1会議室\" className=\"mt-1 block w-full rounded-md border-input bg-background shadow-sm focus:border-ring focus:ring-ring text-foreground\" />\n            </div>\n            <div className=\"md:col-span-2\">\n              <label className=\"block text-sm font-medium text-foreground\">備考</label>\n              <textarea name=\"description\" defaultValue={scheduleForm.description} className=\"mt-1 block w-full rounded-md border-input bg-background shadow-sm focus:border-ring focus:ring-ring text-foreground\" rows={2}></textarea>\n            </div>\n          </div>\n          <div className=\"mt-4 text-right\">\n            <button type=\"submit\" disabled={isPending} className=\"bg-indigo-600 text-white py-2 px-4 rounded hover:bg-indigo-500 disabled:opacity-50\">\n              保存\n            </button>\n          </div>\n        </form>\n      )}\n\n      {/* Agendas Section */}\n      <div className=\"border-t border-border pt-4 mt-4\">\n        <div className=\"flex justify-between items-center mb-4\">\n          <div\n            className=\"flex items-center gap-2 cursor-pointer hover:opacity-80 transition-opacity\"\n            onClick={() => setIsAgendasExpanded(!isAgendasExpanded)}\n          >\n            <h4 className=\"font-bold text-foreground flex items-center gap-2\">\n              議題\n              {isAgendasExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n            </h4>\n            {!isAgendasExpanded && agendas.length > 0 && (\n              <span className=\"text-xs bg-muted text-muted-foreground px-2 py-0.5 rounded-full\">\n                {agendas.length}件\n              </span>\n            )}\n          </div>\n          <div className=\"flex gap-2\">\n            {agendas.length === 0 && meeting?.id && (\n              <button\n                type=\"button\"\n                onClick={handleCopyAgendas}\n                disabled={isPending}\n                className=\"text-sm text-indigo-600 hover:text-indigo-500 disabled:opacity-50\"\n              >\n                昨年度からコピー\n              </button>\n            )}\n            <button\n              onClick={() => {\n                setIsAgendasExpanded(true)\n                setIsAddingAgenda(!isAddingAgenda)\n              }}\n              className=\"text-sm bg-muted text-indigo-600 px-3 py-1 rounded hover:bg-muted/80\"\n            >\n              + 議題追加\n            </button>\n          </div>\n        </div>\n\n        {isAgendasExpanded && (\n          <>\n            {isAddingAgenda && (\n              <AgendaForm\n                meetingId={meeting?.id}\n                defaultDisplayOrder={agendas.length > 0 ? Math.max(...agendas.map(a => a.display_order)) + 1 : 1}\n                onCancel={() => setIsAddingAgenda(false)}\n                onComplete={() => setIsAddingAgenda(false)}\n              />\n            )}\n\n            <div className=\"space-y-3\">\n              {agendas.map(agenda => (\n                <div key={agenda.id} className=\"bg-card p-3 border border-border rounded shadow-sm hover:shadow-md transition-shadow\">\n                  {editingAgendaId === agenda.id ? (\n                    <AgendaForm\n                      meetingId={meeting?.id}\n                      agenda={agenda}\n                      onCancel={() => setEditingAgendaId(null)}\n                      onComplete={() => setEditingAgendaId(null)}\n                    />\n                  ) : (\n                    <AgendaItemView\n                      agenda={agenda}\n                      isExpanded={expandedAgendaIds.includes(agenda.id)}\n                      onToggle={() => toggleAgendaExpansion(agenda.id)}\n                      onEdit={() => setEditingAgendaId(agenda.id)}\n                      onDelete={() => handleDeleteAgenda(agenda.id)}\n                    />\n                  )}\n                </div>\n              ))}\n              {agendas.length === 0 && !isAddingAgenda && (\n                <div className=\"text-center text-muted-foreground py-4 text-sm\">\n                  議題は登録されていません\n                </div>\n              )}\n            </div>\n          </>\n        )}\n      </div>\n    </div>\n  )\n}\n\nfunction AgendaItemView({ agenda, isExpanded, onToggle, onEdit, onDelete }: { agenda: Agenda, isExpanded: boolean, onToggle: () => void, onEdit: () => void, onDelete: () => void }) {\n  return (\n    <div className=\"flex justify-between items-start\">\n      <div className=\"flex-1\">\n        <div\n          className=\"font-medium text-foreground flex items-center gap-2 cursor-pointer hover:text-primary transition-colors\"\n          onClick={onToggle}\n        >\n          {agenda.title}\n          <span className=\"text-muted-foreground\">\n            {isExpanded ? <ChevronUp size={14} /> : <ChevronDown size={14} />}\n          </span>\n        </div>\n        {isExpanded && (\n          <div className=\"text-sm text-muted-foreground mt-2 prose prose-sm dark:prose-invert max-w-none\">\n            {agenda.description ? (\n              <ReactMarkdown remarkPlugins={[remarkGfm]}>{agenda.description}</ReactMarkdown>\n            ) : (\n              <span className=\"text-muted-foreground/50 italic\">(詳細なし)</span>\n            )}\n          </div>\n        )}\n      </div>\n      <div className=\"flex gap-2 ml-4\">\n        <button onClick={onEdit} className=\"text-muted-foreground hover:text-primary\">\n          ✎\n        </button>\n        <button onClick={onDelete} className=\"text-muted-foreground hover:text-destructive\">\n          🗑\n        </button>\n      </div>\n    </div>\n  )\n}\n\nfunction AgendaForm({ meetingId, agenda, defaultDisplayOrder = 1, onCancel, onComplete }: { meetingId?: string, agenda?: Agenda, defaultDisplayOrder?: number, onCancel: () => void, onComplete: () => void }) {\n  const [isPending, startTransition] = useTransition()\n\n  if (!meetingId) {\n    return <div className=\"text-destructive text-sm p-2\">先に定例会の日程を保存してください（スケジュール未登録の場合は議題を追加できません）</div>\n  }\n\n  const handleSubmit = async (formData: FormData) => {\n    formData.append('meeting_id', meetingId)\n    if (agenda?.id) formData.append('id', agenda.id)\n\n    startTransition(async () => {\n      await upsertMeetingAgenda(formData)\n      onComplete()\n    })\n  }\n\n  return (\n    <form action={handleSubmit} className=\"bg-muted/30 p-3 rounded mb-3 border border-border\">\n      <div className=\"grid gap-3\">\n        <div>\n          <input\n            name=\"title\"\n            defaultValue={agenda?.title}\n            placeholder=\"議題タイトル\"\n            required\n            className=\"w-full rounded border-input bg-background focus:border-ring focus:ring-ring text-foreground\"\n          />\n        </div>\n      </div>\n      <div>\n        <MarkdownEditor\n          name=\"description\"\n          defaultValue={agenda?.description || ''}\n          placeholder=\"詳細（Markdown対応）\"\n          rows={6}\n        />\n      </div>\n      <div>\n        <div>\n          <input\n            type=\"number\"\n            name=\"display_order\"\n            defaultValue={agenda?.display_order || defaultDisplayOrder}\n            placeholder=\"表示順 (0, 1, 2...)\"\n            className=\"w-24 rounded border-input bg-background focus:border-ring focus:ring-ring text-sm text-foreground\"\n          />\n        </div>\n      </div>\n      <div className=\"flex justify-end gap-2 mt-3\">\n        <button type=\"button\" onClick={onCancel} className=\"text-sm text-muted-foreground hover:text-foreground\">キャンセル</button>\n        <button type=\"submit\" disabled={isPending} className=\"text-sm bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-500 disabled:opacity-50\">\n          保存\n        </button>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/PrintButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/RoleScheduleEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":12}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport { upsertOfficerTask, deleteOfficerTask } from '@/app/admin/actions/officer'\nimport { Plus, Trash2, Pencil, Calendar } from 'lucide-react'\nimport { cn } from '@/lib/utils'\n\ntype Task = {\n  id: string\n  title: string\n  description: string | null\n  is_monthly: boolean\n  target_month: number | null\n}\n\ntype Props = {\n  roleId: string\n  tasks: Task[]\n}\n\nconst MONTHS = [\n  { val: 4, label: '4月' },\n  { val: 5, label: '5月' },\n  { val: 6, label: '6月' },\n  { val: 7, label: '7月' },\n  { val: 8, label: '8月' },\n  { val: 9, label: '9月' },\n  { val: 10, label: '10月' },\n  { val: 11, label: '11月' },\n  { val: 12, label: '12月' },\n  { val: 1, label: '1月' },\n  { val: 2, label: '2月' },\n  { val: 3, label: '3月' },\n]\n\nexport default function RoleScheduleEditor({ roleId, tasks }: Props) {\n  const [editingTask, setEditingTask] = useState<Task | null>(null)\n  const [isFormOpen, setIsFormOpen] = useState(false)\n  const [defaultMonth, setDefaultMonth] = useState<number | null>(null)\n\n  // Categorize tasks\n  const monthlyTasks = tasks.filter(t => t.is_monthly)\n  const annualTasks = tasks.filter(t => !t.is_monthly && t.target_month)\n  const otherTasks = tasks.filter(t => !t.is_monthly && !t.target_month)\n\n  const handleEdit = (task: Task) => {\n    setEditingTask(task)\n    setIsFormOpen(true)\n  }\n\n  const handleAdd = (month?: number) => {\n    setEditingTask(null)\n    setDefaultMonth(month || null)\n    setIsFormOpen(true)\n  }\n\n  const closeForm = () => {\n    setIsFormOpen(false)\n    setEditingTask(null)\n    setDefaultMonth(null)\n  }\n\n  return (\n    <div className=\"space-y-8 mt-8\">\n      <h2 className=\"text-xl font-bold border-b border-border pb-2 text-foreground\">年間スケジュール設定</h2>\n\n      {/* Monthly Tasks */}\n      <section>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2 text-foreground\">\n            <span className=\"bg-muted text-muted-foreground px-2 py-0.5 rounded text-sm\">毎月</span>\n            の業務\n          </h3>\n          <button\n            onClick={() => handleAdd()}\n            className=\"text-sm bg-primary text-primary-foreground px-3 py-1 rounded hover:opacity-90 flex items-center gap-1 transition-colors\"\n          >\n            <Plus size={16} /> 追加\n          </button>\n        </div>\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {monthlyTasks.map(task => (\n            <TaskCard key={task.id} task={task} onEdit={handleEdit} roleId={roleId} />\n          ))}\n          {monthlyTasks.length === 0 && <p className=\"text-muted-foreground text-sm col-span-full\">登録されている業務はありません</p>}\n        </div>\n      </section>\n\n      {/* Annual Schedule */}\n      <section className=\"space-y-6\">\n        <h3 className=\"text-lg font-semibold flex items-center gap-2 text-foreground\">\n          <Calendar size={20} />\n          年間スケジュール\n        </h3>\n        <div className=\"grid gap-6 md:grid-cols-2 xl:grid-cols-3\">\n          {MONTHS.map(month => {\n            const currentMonthTasks = annualTasks.filter(t => t.target_month === month.val)\n            return (\n              <div key={month.val} className=\"bg-card border border-border rounded-lg p-4 shadow-sm relative group\">\n                <div className=\"flex items-center justify-between mb-3 border-b border-border pb-2\">\n                  <span className=\"font-bold text-lg text-foreground\">{month.label}</span>\n                  <button\n                    onClick={() => handleAdd(month.val)}\n                    className=\"text-muted-foreground hover:text-primary p-1 transition-colors\"\n                    title={`${month.label}に業務を追加`}\n                  >\n                    <Plus size={16} />\n                  </button>\n                </div>\n                <div className=\"space-y-3\">\n                  {currentMonthTasks.map(task => (\n                    <div key={task.id} className=\"bg-muted/50 p-2 rounded border border-border text-sm relative group/task hover:bg-muted transition-colors\">\n                      <div className=\"font-medium text-foreground\">{task.title}</div>\n                      {task.description && <div className=\"text-muted-foreground text-xs mt-1 whitespace-pre-wrap\">{task.description}</div>}\n                      <div className=\"absolute top-1 right-1 opacity-0 group-hover/task:opacity-100 flex items-center bg-background/80 rounded shadow-sm\">\n                        <button onClick={() => handleEdit(task)} className=\"p-1 hover:text-primary transition-colors\"><Pencil size={12} /></button>\n                        <form action={async (formData) => { await deleteOfficerTask(formData) }}>\n                          <input type=\"hidden\" name=\"id\" value={task.id} />\n                          <input type=\"hidden\" name=\"role_id\" value={roleId} />\n                          <button type=\"submit\" className=\"p-1 hover:text-destructive transition-colors\"><Trash2 size={12} /></button>\n                        </form>\n                      </div>\n                    </div>\n                  ))}\n                  {currentMonthTasks.length === 0 && <div className=\"text-muted-foreground text-xs text-center py-2\">- 予定なし -</div>}\n                </div>\n              </div>\n            )\n          })}\n        </div>\n      </section>\n\n      {/* Other Tasks */}\n      <section>\n        <div className=\"flex items-center justify-between mb-4\">\n          <h3 className=\"text-lg font-semibold flex items-center gap-2 text-foreground\">\n            その他・随時\n          </h3>\n          <button\n            onClick={() => handleAdd()}\n            className=\"text-sm bg-muted text-muted-foreground px-3 py-1 rounded hover:bg-muted/80 flex items-center gap-1 transition-colors\"\n          >\n            <Plus size={16} /> 追加\n          </button>\n        </div>\n        <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3\">\n          {otherTasks.map(task => (\n            <TaskCard key={task.id} task={task} onEdit={handleEdit} roleId={roleId} />\n          ))}\n          {otherTasks.length === 0 && <p className=\"text-muted-foreground text-sm col-span-full\">登録されている業務はありません</p>}\n        </div>\n      </section>\n\n      {/* Edit/Add Modal */}\n      {isFormOpen && (\n        <div className=\"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-card border border-border rounded-lg shadow-xl w-full max-w-md p-6\">\n            <h3 className=\"text-lg font-bold mb-4 text-foreground\">{editingTask ? '業務を編集' : '新しい業務を追加'}</h3>\n            <form\n              action={async (formData) => {\n                await upsertOfficerTask(formData)\n                closeForm()\n              }}\n              className=\"space-y-4\"\n            >\n              <input type=\"hidden\" name=\"id\" value={editingTask?.id || ''} />\n              <input type=\"hidden\" name=\"role_id\" value={roleId} />\n\n              <div>\n                <label className=\"block text-sm font-medium text-foreground\">タイトル</label>\n                <input\n                  type=\"text\"\n                  name=\"title\"\n                  required\n                  defaultValue={editingTask?.title || ''}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-foreground\">説明</label>\n                <textarea\n                  name=\"description\"\n                  defaultValue={editingTask?.description || ''}\n                  rows={3}\n                  className=\"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                />\n              </div>\n\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex items-center\">\n                  <input\n                    type=\"checkbox\"\n                    name=\"is_monthly\"\n                    id=\"is_monthly\"\n                    defaultChecked={editingTask ? editingTask.is_monthly : (defaultMonth === null)}\n                    className=\"h-4 w-4 rounded border-input text-primary focus:ring-ring\"\n                  />\n                  <label htmlFor=\"is_monthly\" className=\"ml-2 block text-sm text-foreground\">毎月の業務として登録</label>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-foreground\">実施月（年間スケジュールの場合）</label>\n                <select\n                  name=\"target_month\"\n                  defaultValue={editingTask?.target_month || defaultMonth || ''}\n                  className=\"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\"\n                >\n                  <option value=\"\">指定なし（その他・随時）</option>\n                  {MONTHS.map(m => (\n                    <option key={m.val} value={m.val}>{m.label}</option>\n                  ))}\n                </select>\n                <p className=\"text-xs text-muted-foreground mt-1\">※「毎月の業務」にチェックがある場合、月指定は無視されます</p>\n              </div>\n\n              <div className=\"flex justify-end gap-2 pt-4 border-t border-border mt-4\">\n                <button\n                  type=\"button\"\n                  onClick={closeForm}\n                  className=\"px-4 py-2 text-sm font-medium text-foreground bg-background border border-input rounded-md hover:bg-muted transition-colors\"\n                >\n                  キャンセル\n                </button>\n                <button\n                  type=\"submit\"\n                  className=\"px-4 py-2 text-sm font-medium text-primary-foreground bg-primary rounded-md hover:bg-primary/90 transition-colors\"\n                >\n                  保存\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nfunction TaskCard({ task, onEdit, roleId }: { task: Task, onEdit: (t: Task) => void, roleId: string }) {\n  return (\n    <div className=\"bg-card border border-border rounded-lg p-4 shadow-sm flex flex-col justify-between group hover:shadow-md transition-shadow\">\n      <div>\n        <h4 className=\"font-bold text-foreground\">{task.title}</h4>\n        <p className=\"text-sm text-muted-foreground mt-1 whitespace-pre-wrap\">{task.description}</p>\n      </div>\n      <div className=\"flex justify-end gap-2 mt-4 opacity-0 group-hover:opacity-100 transition-opacity\">\n        <button\n          onClick={() => onEdit(task)}\n          className=\"p-1.5 text-muted-foreground hover:text-primary hover:bg-muted rounded transition-colors\"\n        >\n          <Pencil size={16} />\n        </button>\n        <form action={async (formData) => { await deleteOfficerTask(formData) }}>\n          <input type=\"hidden\" name=\"id\" value={task.id} />\n          <input type=\"hidden\" name=\"role_id\" value={roleId} />\n          <button\n            type=\"submit\"\n            className=\"p-1.5 text-muted-foreground hover:text-destructive hover:bg-destructive/10 rounded transition-colors\"\n            onClick={(e) => {\n              if (!confirm('本当に削除しますか？')) {\n                e.preventDefault()\n              }\n            }}\n          >\n            <Trash2 size={16} />\n          </button>\n        </form>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/SingleEventForm.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/accounting/AccountingEditor.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[242,245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[242,245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'setIsAudited' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":27,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":27,"endColumn":33},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/accounting/AccountingEditor.tsx:32:7\n  30 |     // If an accountant is assigned via role, force it.\n  31 |     if (accountingInfo.accountantName) {\n> 32 |       setAccountant(accountingInfo.accountantName)\n     |       ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  33 |     }\n  34 |   }, [accountingInfo])\n  35 |","line":32,"column":7,"nodeType":null,"endLine":32,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":57,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":57,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2225,2228],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2225,2228],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2497,2500],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2497,2500],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/accounting/AccountingEditor.tsx:72:7\n  70 |     if (!initialData) {\n  71 |       const typeLabel = reportType === 'settlement' ? '決算報告書' : '予算案'\n> 72 |       setTitle(`${fiscalYear}年度 会計${typeLabel}`)\n     |       ^^^^^^^^ Avoid calling setState() directly within an effect\n  73 |     }\n  74 |   }, [fiscalYear, reportType, initialData])\n  75 |","line":72,"column":7,"nodeType":null,"endLine":72,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":101,"column":106,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":101,"endColumn":109,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3800,3803],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3800,3803],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6560,6563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6560,6563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { AccountingItem, FiscalReportPayload, upsertFiscalReport } from '@/app/admin/actions/accounting'\n\ninterface Props {\n  initialData?: any\n  currentYear: number\n  accountingInfo: {\n    canAudit: boolean\n    accountantName: string | null\n    auditorNames: string[]\n    currentAuditorName: string | null\n  }\n}\n\nexport default function AccountingEditor({ initialData, currentYear, accountingInfo }: Props) {\n  const router = useRouter()\n  const [loading, setLoading] = useState(false)\n  const [fiscalYear, setFiscalYear] = useState(initialData?.fiscal_year || currentYear)\n  const [reportType, setReportType] = useState<'settlement' | 'budget'>(initialData?.report_type || 'settlement')\n  const [title, setTitle] = useState(initialData?.title || `${currentYear}年度 会計決算報告書`)\n  const [accountant, setAccountant] = useState(initialData?.accountant_name || accountingInfo.accountantName || '')\n  const [auditorNames, setAuditorNames] = useState<string>(initialData?.auditor_names?.join('／') || '')\n  const [reportDate, setReportDate] = useState(initialData?.report_date || new Date().toISOString().split('T')[0])\n  const [isAudited, setIsAudited] = useState<boolean>(initialData?.is_audited || false)\n\n  useEffect(() => {\n    // If an accountant is assigned via role, force it.\n    if (accountingInfo.accountantName) {\n      setAccountant(accountingInfo.accountantName)\n    }\n  }, [accountingInfo])\n\n  const toggleMySignature = (checked: boolean) => {\n    if (!accountingInfo.currentAuditorName) return\n\n    const currentNames = auditorNames.split('／').filter(n => n.trim() !== '')\n    let newNames: string[] = []\n\n    if (checked) {\n      // Add if not exists\n      if (!currentNames.includes(accountingInfo.currentAuditorName)) {\n        newNames = [...currentNames, accountingInfo.currentAuditorName]\n      } else {\n        newNames = currentNames\n      }\n    } else {\n      // Remove\n      newNames = currentNames.filter(n => n !== accountingInfo.currentAuditorName)\n    }\n    setAuditorNames(newNames.join('／'))\n  }\n\n  const [incomeItems, setIncomeItems] = useState<AccountingItem[]>(\n    initialData?.items?.filter((i: any) => i.category === 'income') || [\n      { category: 'income', item_name: '前年度繰越金', budget_amount: 0, actual_amount: 0, description: '', sort_order: 0 }\n    ]\n  )\n\n  const [expenseItems, setExpenseItems] = useState<AccountingItem[]>(\n    initialData?.items?.filter((i: any) => i.category === 'expense') || [\n      { category: 'expense', item_name: '', budget_amount: 0, actual_amount: 0, description: '', sort_order: 0 }\n    ]\n  )\n\n  // Title auto-update if year/type changes and title is default\n  useEffect(() => {\n    if (!initialData) {\n      const typeLabel = reportType === 'settlement' ? '決算報告書' : '予算案'\n      setTitle(`${fiscalYear}年度 会計${typeLabel}`)\n    }\n  }, [fiscalYear, reportType, initialData])\n\n  const addItem = (category: 'income' | 'expense') => {\n    const newItem: AccountingItem = {\n      category,\n      item_name: '',\n      budget_amount: 0,\n      actual_amount: 0,\n      description: '',\n      sort_order: (category === 'income' ? incomeItems : expenseItems).length\n    }\n    if (category === 'income') setIncomeItems([...incomeItems, newItem])\n    else setExpenseItems([...expenseItems, newItem])\n  }\n\n  const removeItem = (category: 'income' | 'expense', index: number) => {\n    if (category === 'income') {\n      const newItems = [...incomeItems]\n      newItems.splice(index, 1)\n      setIncomeItems(newItems)\n    } else {\n      const newItems = [...expenseItems]\n      newItems.splice(index, 1)\n      setExpenseItems(newItems)\n    }\n  }\n\n  const updateItem = (category: 'income' | 'expense', index: number, field: keyof AccountingItem, value: any) => {\n    const list = category === 'income' ? [...incomeItems] : [...expenseItems]\n    list[index] = { ...list[index], [field]: value }\n    if (category === 'income') setIncomeItems(list)\n    else setExpenseItems(list)\n  }\n\n  const formatCurrency = (val: number) => {\n    return new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY' }).format(val)\n  }\n\n  // Calculations\n  const calcSubtotal = (items: AccountingItem[], field: 'budget_amount' | 'actual_amount') => {\n    return items.reduce((sum, item) => sum + (Number(item[field]) || 0), 0)\n  }\n\n  const incomeBudgetSubtotal = calcSubtotal(incomeItems, 'budget_amount')\n  const incomeActualSubtotal = calcSubtotal(incomeItems, 'actual_amount')\n  const expenseBudgetSubtotal = calcSubtotal(expenseItems, 'budget_amount')\n  const expenseActualSubtotal = calcSubtotal(expenseItems, 'actual_amount')\n\n  const handleSave = async () => {\n    setLoading(true)\n    const payload: FiscalReportPayload = {\n      fiscal_year: Number(fiscalYear),\n      report_type: reportType,\n      title,\n      accountant_name: accountant,\n      auditor_names: auditorNames.split('／').filter(n => n.trim() !== ''),\n      report_date: reportDate,\n      items: [...incomeItems, ...expenseItems].map((item, idx) => ({ ...item, sort_order: idx })),\n      is_audited: isAudited\n    }\n\n    const res = await upsertFiscalReport(initialData?.id || null, payload)\n    setLoading(false)\n    if (res.success) {\n      alert(res.message)\n      router.push('/admin/accounting')\n      router.refresh()\n    } else {\n      alert(res.message)\n    }\n  }\n\n  const formatDateJP = (dateStr: string) => {\n    if (!dateStr) return ''\n    const d = new Date(dateStr)\n    return `${d.getFullYear()}年${d.getMonth() + 1}月${d.getDate()}日`\n  }\n\n  return (\n    <>\n      <div className=\"space-y-8 print:hidden\">\n        {/* Header Info */}\n        <div className=\"bg-card border border-border p-6 rounded-xl space-y-4 shadow-sm\">\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6\">\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-semibold text-muted-foreground ml-1\">対象年度</label>\n              <input\n                type=\"number\"\n                value={fiscalYear}\n                onChange={(e) => setFiscalYear(e.target.value)}\n                className=\"w-full bg-background border border-input rounded-md px-4 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-semibold text-muted-foreground ml-1\">種類</label>\n              <select\n                value={reportType}\n                onChange={(e) => setReportType(e.target.value as any)}\n                className=\"w-full bg-background border border-input rounded-md px-4 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all\"\n              >\n                <option value=\"settlement\">決算報告</option>\n                <option value=\"budget\">予算案</option>\n              </select>\n            </div>\n            <div className=\"md:col-span-2 space-y-2\">\n              <label className=\"text-sm font-semibold text-muted-foreground ml-1\">報告書タイトル</label>\n              <input\n                type=\"text\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                className=\"w-full bg-background border border-input rounded-md px-4 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all\"\n              />\n            </div>\n          </div>\n        </div>\n\n        {/* Sections */}\n        {(['income', 'expense'] as const).map((category) => (\n          <section key={category} className=\"space-y-4\">\n            <div className=\"flex items-center justify-between px-1\">\n              <h3 className=\"text-lg font-bold text-foreground\">\n                {category === 'income' ? '収入の部' : '支出の部'}\n              </h3>\n              <button\n                onClick={() => addItem(category)}\n                className=\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2\"\n              >\n                ＋ 行を追加\n              </button>\n            </div>\n\n            <div className=\"rounded-md border border-border overflow-hidden shadow-sm overflow-x-auto\">\n              <table className=\"w-full text-left border-collapse text-sm min-w-[800px]\">\n                <thead>\n                  <tr className=\"bg-muted/50 border-b border-border\">\n                    <th className=\"px-4 py-3 font-semibold text-muted-foreground\">項目名</th>\n                    <th className=\"px-4 py-3 font-semibold text-muted-foreground text-right w-32\">予算額</th>\n                    <th className=\"px-4 py-3 font-semibold text-muted-foreground text-right w-32\">決算額</th>\n                    <th className=\"px-4 py-3 font-semibold text-muted-foreground\">摘要</th>\n                    <th className=\"px-4 py-3 w-10\"></th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-border bg-card\">\n                  {(category === 'income' ? incomeItems : expenseItems).map((item, idx) => (\n                    <tr key={idx} className=\"group hover:bg-muted/30 transition-colors\">\n                      <td className=\"p-1\">\n                        <input\n                          type=\"text\"\n                          value={item.item_name}\n                          onChange={(e) => updateItem(category, idx, 'item_name', e.target.value)}\n                          className=\"w-full bg-transparent border-none rounded-md px-3 py-2 text-foreground focus:ring-1 focus:ring-primary transition-all\"\n                          placeholder=\"項目名を入力...\"\n                        />\n                      </td>\n                      <td className=\"p-1\">\n                        <input\n                          type=\"number\"\n                          value={item.budget_amount}\n                          onChange={(e) => updateItem(category, idx, 'budget_amount', Number(e.target.value))}\n                          className=\"w-full bg-transparent border-none rounded-md px-3 py-2 text-foreground text-right focus:ring-1 focus:ring-primary transition-all\"\n                        />\n                      </td>\n                      <td className=\"p-1\">\n                        <input\n                          type=\"number\"\n                          value={item.actual_amount}\n                          onChange={(e) => updateItem(category, idx, 'actual_amount', Number(e.target.value))}\n                          className=\"w-full bg-transparent border-none rounded-md px-3 py-2 text-foreground text-right focus:ring-1 focus:ring-primary transition-all\"\n                        />\n                      </td>\n                      <td className=\"p-1\">\n                        <input\n                          type=\"text\"\n                          value={item.description}\n                          onChange={(e) => updateItem(category, idx, 'description', e.target.value)}\n                          className=\"w-full bg-transparent border-none rounded-md px-3 py-2 text-muted-foreground text-sm focus:ring-1 focus:ring-primary transition-all\"\n                          placeholder=\"摘要...\"\n                        />\n                      </td>\n                      <td className=\"p-1\">\n                        <button\n                          onClick={() => removeItem(category, idx)}\n                          className=\"p-2 text-muted-foreground/30 hover:text-destructive opacity-0 group-hover:opacity-100 transition-all\"\n                        >\n                          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M6 18L18 6M6 6l12 12\" /></svg>\n                        </button>\n                      </td>\n                    </tr>\n                  ))}\n                  {/* Subtotal Row */}\n                  <tr className=\"bg-muted/20 font-bold border-t border-border\">\n                    <td className=\"px-4 py-3 text-foreground\">小計</td>\n                    <td className=\"px-4 py-3 text-right text-foreground\">\n                      {formatCurrency(category === 'income' ? incomeBudgetSubtotal : expenseBudgetSubtotal)}\n                    </td>\n                    <td className=\"px-4 py-3 text-right text-foreground\">\n                      {formatCurrency(category === 'income' ? incomeActualSubtotal : expenseActualSubtotal)}\n                    </td>\n                    <td colSpan={2}></td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </section>\n        ))}\n\n        {/* Result Section */}\n        <section className=\"bg-card border border-border p-8 rounded-xl space-y-6 shadow-sm\">\n          <h3 className=\"text-xl font-bold text-foreground border-b border-border pb-4\">収支差引合計（次年度繰越）</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-12 pt-2\">\n            <div className=\"space-y-4\">\n              <div className=\"flex justify-between text-muted-foreground text-sm\">\n                <span>収入合計 (決算額)</span>\n                <span className=\"font-medium text-foreground\">{formatCurrency(incomeActualSubtotal)}</span>\n              </div>\n              <div className=\"flex justify-between text-muted-foreground text-sm\">\n                <span>支出合計 (決算額)</span>\n                <span className=\"font-medium text-foreground\">- {formatCurrency(expenseActualSubtotal)}</span>\n              </div>\n              <div className=\"pt-4 border-t border-border flex justify-between font-bold text-2xl text-primary\">\n                <span>次年度繰越金</span>\n                <span>{formatCurrency(incomeActualSubtotal - expenseActualSubtotal)}</span>\n              </div>\n            </div>\n\n            <div className=\"space-y-6 md:border-l md:border-border md:pl-12\">\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-semibold text-muted-foreground\">会計担当者</label>\n                <div className=\"text-xs text-muted-foreground mb-1\">\n                  ※ 役職設定で「会計担当」に設定されたユーザーが自動表示されます\n                </div>\n                <input\n                  type=\"text\"\n                  value={accountant}\n                  readOnly\n                  disabled\n                  placeholder=\"（役職設定から会計担当を割り当ててください）\"\n                  className=\"w-full bg-muted/50 border border-input rounded-md px-4 py-2 text-foreground/70 cursor-not-allowed focus:outline-none\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-semibold text-muted-foreground\">会計監査</label>\n                <div className=\"space-y-3\">\n                  <div className=\"text-xs text-muted-foreground mb-1\">\n                    ※ 会計監査が署名したら表示されます\n                  </div>\n                  <input\n                    type=\"text\"\n                    value={auditorNames}\n                    readOnly\n                    disabled\n                    placeholder=\"（役職設定から会計監査を割り当ててください）\"\n                    className=\"w-full bg-muted/50 border border-input rounded-md px-4 py-2 text-foreground/70 cursor-not-allowed focus:outline-none\"\n                  />\n\n                  {accountingInfo.canAudit && accountingInfo.currentAuditorName && (\n                    <div className=\"flex items-center gap-2 mt-4 p-3 bg-primary/5 border border-primary/20 rounded-md\">\n                      <input\n                        type=\"checkbox\"\n                        id=\"auditCheck\"\n                        checked={auditorNames.includes(accountingInfo.currentAuditorName)}\n                        onChange={(e) => toggleMySignature(e.target.checked)}\n                        className=\"h-5 w-5 rounded border-gray-300 text-primary focus:ring-primary\"\n                      />\n                      <label htmlFor=\"auditCheck\" className=\"text-sm font-bold text-foreground cursor-pointer select-none\">\n                        会計監査の署名を入れる（{accountingInfo.currentAuditorName}）\n                      </label>\n                    </div>\n                  )}\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-semibold text-muted-foreground\">報告日</label>\n                <input\n                  type=\"date\"\n                  value={reportDate}\n                  onChange={(e) => setReportDate(e.target.value)}\n                  className=\"w-full bg-background border border-input rounded-md px-4 py-2 text-foreground focus:outline-none focus:ring-2 focus:ring-primary/50\"\n                />\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Actions */}\n        <div className=\"flex justify-end gap-3 pt-6 border-t border-border mt-10\">\n          <button\n            type=\"button\"\n            onClick={() => window.print()}\n            className=\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-6 gap-2\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z\" /></svg>\n            印刷 / PDFプレビュー\n          </button>\n          <button\n            onClick={() => router.back()}\n            className=\"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-11 px-8\"\n          >\n            キャンセル\n          </button>\n          <button\n            onClick={handleSave}\n            disabled={loading}\n            className=\"inline-flex items-center justify-center rounded-md text-sm font-bold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-10 shadow-sm\"\n          >\n            {loading ? '保存中...' : '報告書を保存'}\n          </button>\n        </div>\n      </div>\n\n      {/* Print Layout */}\n      <div className=\"hidden print:block font-serif text-black p-4 max-w-[210mm] mx-auto\">\n        <h1 className=\"text-xl font-bold text-center mb-2 border-b border-black/50 pb-1\">{title}</h1>\n\n        <div className=\"flex gap-4\">\n          {/* Income Items */}\n          <div className=\"flex-1 mb-4\">\n            <h2 className=\"text-base font-bold border-b border-black mb-1\">収入の部</h2>\n            <table className=\"w-full text-xs border-collapse\">\n              <thead>\n                <tr className=\"border-b border-black\">\n                  <th className=\"text-left py-0.5 w-[35%]\">項目</th>\n                  <th className=\"text-right py-0.5 w-[15%]\">予算額</th>\n                  <th className=\"text-right py-0.5 w-[15%]\">決算額</th>\n                  <th className=\"text-left py-0.5 pl-2\">摘要</th>\n                </tr>\n              </thead>\n              <tbody>\n                {incomeItems.map((item, idx) => (\n                  <tr key={idx} className=\"border-b border-black/10\">\n                    <td className=\"py-0.5\">{item.item_name}</td>\n                    <td className=\"text-right py-0.5\">{formatCurrency(item.budget_amount)}</td>\n                    <td className=\"text-right py-0.5\">{formatCurrency(item.actual_amount)}</td>\n                    <td className=\"py-0.5 pl-2 text-[10px]\">{item.description}</td>\n                  </tr>\n                ))}\n                <tr className=\"border-t border-black font-bold\">\n                  <td className=\"py-1\">小計</td>\n                  <td className=\"text-right py-1\">{formatCurrency(incomeBudgetSubtotal)}</td>\n                  <td className=\"text-right py-1\">{formatCurrency(incomeActualSubtotal)}</td>\n                  <td></td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        {/* Expense Items */}\n        <div className=\"mb-4\">\n          <h2 className=\"text-base font-bold border-b border-black mb-1\">支出の部</h2>\n          <table className=\"w-full text-xs border-collapse\">\n            <thead>\n              <tr className=\"border-b border-black\">\n                <th className=\"text-left py-0.5 w-[35%]\">項目</th>\n                <th className=\"text-right py-0.5 w-[15%]\">予算額</th>\n                <th className=\"text-right py-0.5 w-[15%]\">決算額</th>\n                <th className=\"text-left py-0.5 pl-2\">摘要</th>\n              </tr>\n            </thead>\n            <tbody>\n              {expenseItems.map((item, idx) => (\n                <tr key={idx} className=\"border-b border-black/10\">\n                  <td className=\"py-0.5\">{item.item_name}</td>\n                  <td className=\"text-right py-0.5\">{formatCurrency(item.budget_amount)}</td>\n                  <td className=\"text-right py-0.5\">{formatCurrency(item.actual_amount)}</td>\n                  <td className=\"py-0.5 pl-2 text-[10px]\">{item.description}</td>\n                </tr>\n              ))}\n              <tr className=\"border-t border-black font-bold\">\n                <td className=\"py-1\">小計</td>\n                <td className=\"text-right py-1\">{formatCurrency(expenseBudgetSubtotal)}</td>\n                <td className=\"text-right py-1\">{formatCurrency(expenseActualSubtotal)}</td>\n                <td></td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n\n        {/* Summary */}\n        <div className=\"mb-4 break-inside-avoid\">\n          <h2 className=\"text-base font-bold border-b border-black mb-1\">次年度繰越金</h2>\n          <table className=\"w-full text-xs\">\n            <tbody>\n              <tr>\n                <td className=\"py-0.5 w-[50%]\">収入合計</td>\n                <td className=\"text-right py-0.5\">{formatCurrency(incomeActualSubtotal)}</td>\n              </tr>\n              <tr>\n                <td className=\"py-0.5\">支出合計</td>\n                <td className=\"text-right py-0.5 border-b border-black\">{formatCurrency(expenseActualSubtotal)}</td>\n              </tr>\n              <tr className=\"font-bold text-sm\">\n                <td className=\"py-1.5\">収支差引合計（次年度繰越）</td>\n                <td className=\"text-right py-1.5\">{formatCurrency(incomeActualSubtotal - expenseActualSubtotal)}</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n\n        {/* Footer */}\n        <div className=\"mt-8 text-xs break-inside-avoid\">\n          <div className=\"mb-2 text-right\">{formatDateJP(reportDate)}</div>\n          <p className=\"mb-4\">上記の通り会計報告致します。</p>\n          <div className=\"flex justify-end gap-8\">\n            <div>\n              <span className=\"font-bold mr-2\">会計：</span>\n              <span>{accountant}</span>\n            </div>\n            <div>\n              <span className=\"font-bold mr-2\">会計監査：</span>\n              <span>{auditorNames}</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/members/ChildList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[401,404],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[401,404],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[834,837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[834,837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[988,991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[988,991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1946,1949],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1946,1949],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1989,1992],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1989,1992],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'index' is defined but never used. Allowed unused args must match /^_/u.","line":241,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":241,"endColumn":45}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useMemo, useState } from 'react';\nimport { calculateGrade, calculateAge, getGradeOrder } from '@/lib/grade-utils';\nimport CopyToClipboard from '@/components/ui/CopyToClipboard';\nimport Link from 'next/link';\nimport { Baby, ArrowUpDown, ChevronUp, ChevronDown, Search } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\n\ninterface ChildListProps {\n  profiles: any[]; // Ideally typed properly\n  targetFiscalYear: number;\n  canEdit?: boolean;\n}\n\nexport default function ChildList({ profiles, targetFiscalYear, canEdit }: ChildListProps) {\n  const [sortConfig, setSortConfig] = useState<{ key: string; direction: 'asc' | 'desc' } | null>({\n    key: 'grade',\n    direction: 'asc',\n  });\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const allChildren = useMemo(() => {\n    const list: any[] = [];\n    profiles.forEach((profile) => {\n      if (profile.children && Array.isArray(profile.children)) {\n        profile.children.forEach((child: any) => {\n          const grade = calculateGrade(child.birthday, targetFiscalYear);\n          const age = calculateAge(child.birthday, targetFiscalYear);\n          list.push({\n            ...child,\n            grade,\n            age,\n            parent_name: profile.full_name,\n            parent_id: profile.id,\n          });\n        });\n      }\n    });\n\n    // 検索フィルタ\n    const filteredList = list.filter(child => {\n      const s = searchQuery.toLowerCase();\n      if (!s) return true;\n      return (\n        child.full_name?.toLowerCase().includes(s) ||\n        child.last_name_kana?.includes(s) ||\n        child.first_name_kana?.includes(s) ||\n        child.grade?.toLowerCase().includes(s) ||\n        child.parent_name?.toLowerCase().includes(s) ||\n        child.notes?.toLowerCase().includes(s) ||\n        child.allergies?.toLowerCase().includes(s)\n      );\n    });\n\n    if (sortConfig !== null) {\n      filteredList.sort((a, b) => {\n        let valA: any = a[sortConfig.key];\n        let valB: any = b[sortConfig.key];\n\n        // Custom logic for specific keys\n        if (sortConfig.key === 'grade') {\n          valA = getGradeOrder(a.grade);\n          valB = getGradeOrder(b.grade);\n        } else if (sortConfig.key === 'full_name') {\n          valA = `${a.last_name_kana} ${a.first_name_kana}`;\n          valB = `${b.last_name_kana} ${b.first_name_kana}`;\n        } else if (sortConfig.key === 'kana') {\n          valA = `${a.last_name_kana} ${a.first_name_kana}`;\n          valB = `${b.last_name_kana} ${b.first_name_kana}`;\n        }\n\n        if (valA === undefined || valA === null) return 1;\n        if (valB === undefined || valB === null) return -1;\n\n        if (valA < valB) {\n          return sortConfig.direction === 'asc' ? -1 : 1;\n        }\n        if (valA > valB) {\n          return sortConfig.direction === 'asc' ? 1 : -1;\n        }\n        return 0;\n      });\n    }\n\n    return filteredList;\n  }, [profiles, targetFiscalYear, sortConfig, searchQuery]);\n\n  const requestSort = (key: string) => {\n    let direction: 'asc' | 'desc' = 'asc';\n    if (sortConfig && sortConfig.key === key && sortConfig.direction === 'asc') {\n      direction = 'desc';\n    }\n    setSortConfig({ key, direction });\n  };\n\n  const getSortIcon = (key: string) => {\n    if (!sortConfig || sortConfig.key !== key) {\n      return <ArrowUpDown className=\"h-3 w-3 ml-1 text-muted-foreground/30\" />;\n    }\n    return sortConfig.direction === 'asc'\n      ? <ChevronUp className=\"h-3 w-3 ml-1 text-primary\" />\n      : <ChevronDown className=\"h-3 w-3 ml-1 text-primary\" />;\n  };\n\n  // Statistics\n  const stats = useMemo(() => {\n    const total = allChildren.length;\n    let elementaryCount = 0;\n    const gradeCounts: Record<string, number> = {};\n\n    allChildren.forEach(child => {\n      const g = child.grade;\n      gradeCounts[g] = (gradeCounts[g] || 0) + 1;\n      if (g.startsWith('小学')) {\n        elementaryCount++;\n      }\n    });\n\n    return { total, elementaryCount, gradeCounts };\n  }, [allChildren]);\n\n  if (profiles.length === 0) {\n    return <div className=\"p-4 text-center text-muted-foreground\">登録されているお子様はいません。</div>;\n  }\n\n  return (\n    <div>\n      {/* Statistics Section */}\n      <div className=\"bg-background p-4 rounded-lg shadow-sm mb-6 border border-border\">\n        <h3 className=\"text-lg font-bold text-foreground mb-3\">統計情報</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          <div className=\"bg-primary/10 p-3 rounded-md border border-primary/20\">\n            <span className=\"block text-sm text-primary font-medium\">子供総数</span>\n            <span className=\"block text-2xl font-bold text-foreground\">{stats.total}名</span>\n          </div>\n          <div className=\"bg-muted p-3 rounded-md border border-border\">\n            <span className=\"block text-sm text-foreground font-medium\">小学生総数</span>\n            <span className=\"block text-2xl font-bold text-foreground\">{stats.elementaryCount}名</span>\n          </div>\n        </div>\n        <div className=\"mt-6\">\n          <h4 className=\"text-sm font-bold text-foreground mb-3 flex items-center gap-2\">\n            <Baby className=\"h-4 w-4 text-primary\" />\n            学年別内訳\n          </h4>\n          <div className=\"max-w-md bg-background rounded-md border border-border overflow-hidden\">\n            <table className=\"min-w-full text-sm\">\n              <thead>\n                <tr className=\"bg-muted text-foreground border-b border-border\">\n                  <th className=\"text-left py-2 px-4 font-bold\">学年</th>\n                  <th className=\"text-right py-2 px-4 font-bold\">人数</th>\n                </tr>\n              </thead>\n              <tbody className=\"divide-y divide-border\">\n                {Object.keys(stats.gradeCounts)\n                  .sort((a, b) => getGradeOrder(a) - getGradeOrder(b))\n                  .map((grade, index) => (\n                    <tr key={grade} className={index % 2 === 0 ? 'bg-background' : 'bg-muted/30'}>\n                      <td className=\"py-2 px-4 text-foreground\">{grade}</td>\n                      <td className=\"py-2 px-4 text-right font-medium text-primary\">{stats.gradeCounts[grade]}名</td>\n                    </tr>\n                  ))}\n              </tbody>\n              <tfoot>\n                <tr className=\"bg-muted/50 font-bold border-t border-border\">\n                  <td className=\"py-2 px-4 text-foreground\">合計</td>\n                  <td className=\"py-2 px-4 text-right text-foreground\">{stats.total}名</td>\n                </tr>\n              </tfoot>\n            </table>\n          </div>\n        </div>\n      </div>\n\n      {/* Search and Actions */}\n      <div className=\"mb-4 flex flex-col sm:flex-row gap-3 items-end justify-between\">\n        <div className=\"w-full sm:max-w-xs relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <Search className=\"h-4 w-4 text-muted-foreground\" />\n          </div>\n          <Input\n            type=\"text\"\n            placeholder=\"氏名、かな、学年などで検索...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        <div className=\"text-xs text-muted-foreground italic\">\n          {allChildren.length}名を表示中\n        </div>\n      </div>\n\n      {/* Table Section */}\n      <div className=\"overflow-x-auto shadow-sm ring-1 ring-border rounded-lg bg-background\">\n        {allChildren.length === 0 ? (\n          <div className=\"p-12 text-center text-muted-foreground\">\n            検索条件に一致するお子様は見つかりませんでした。\n          </div>\n        ) : (\n          <table className=\"min-w-full divide-y divide-border\">\n            <thead className=\"bg-muted/50\">\n              <tr>\n                <th scope=\"col\" onClick={() => requestSort('grade')} className=\"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-foreground sm:pl-6 whitespace-nowrap cursor-pointer hover:bg-muted/70 flex-shrink-0\">\n                  <div className=\"flex items-center\">学年 {getSortIcon('grade')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('full_name')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">氏名 {getSortIcon('full_name')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('age')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">年齢 {getSortIcon('age')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('birthday')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">生年月日 {getSortIcon('birthday')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('gender')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">性別 {getSortIcon('gender')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('last_name')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">苗字 {getSortIcon('last_name')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('first_name')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">名前 {getSortIcon('first_name')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('last_name_kana')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">かな(姓) {getSortIcon('last_name_kana')}</div>\n                </th>\n                <th scope=\"col\" onClick={() => requestSort('first_name_kana')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">かな(名) {getSortIcon('first_name_kana')}</div>\n                </th>\n                <th scope=\"col\" className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap\">アレルギー</th>\n                <th scope=\"col\" className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap\">特記事項</th>\n                <th scope=\"col\" onClick={() => requestSort('parent_name')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground whitespace-nowrap cursor-pointer hover:bg-muted/70\">\n                  <div className=\"flex items-center\">保護者 {getSortIcon('parent_name')}</div>\n                </th>\n                {canEdit && <th scope=\"col\" className=\"relative py-3.5 pl-3 pr-4 sm:pr-6\"><span className=\"sr-only\">操作</span></th>}\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-border bg-background\">\n              {allChildren.map((child, index) => (\n                <tr key={child.id} className={`hover:bg-muted/50 ${getGradeOrder(child.grade) % 2 === 0 ? 'bg-background' : 'bg-muted/30'}`}>\n                  <td className=\"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-foreground sm:pl-6\">\n                    {child.grade}\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-foreground group\">\n                    <div className=\"flex items-center gap-1\">\n                      {child.full_name}\n                      <CopyToClipboard text={child.full_name} />\n                    </div>\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    {child.age}歳\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    {child.birthday ? new Date(child.birthday).toLocaleDateString('ja-JP') : '-'}\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    {child.gender === 'male' ? '男' : child.gender === 'female' ? '女' : child.gender === 'other' ? '他' : '-'}\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center gap-1\">\n                      {child.last_name}\n                      <CopyToClipboard text={child.last_name} />\n                    </div>\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center gap-1\">\n                      {child.first_name}\n                      <CopyToClipboard text={child.first_name} />\n                    </div>\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center gap-1\">\n                      {child.last_name_kana}\n                      <CopyToClipboard text={child.last_name_kana} />\n                    </div>\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center gap-1\">\n                      {child.first_name_kana}\n                      <CopyToClipboard text={child.first_name_kana} />\n                    </div>\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-primary font-medium\">\n                    {child.allergy}\n                  </td>\n                  <td className=\" px-3 py-4 text-sm text-muted-foreground min-w-[150px]\">\n                    {child.notes}\n                  </td>\n                  <td className=\"whitespace-nowrap px-3 py-4 text-sm text-primary hover:text-primary\">\n                    <Link href={`/admin/users/${child.parent_id}?view=child`}>\n                      {child.parent_name}\n                    </Link>\n                  </td>\n                  {canEdit && (\n                    <td className=\"whitespace-nowrap px-3 py-4 text-sm text-right\">\n                      <Link\n                        href={`/admin/users/${child.parent_id}?view=child`}\n                        className=\"text-primary hover:text-primary bg-primary/10 px-3 py-1 rounded-md text-xs font-medium border border-primary/20\"\n                      >\n                        編集\n                      </Link>\n                    </td>\n                  )}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        )}\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/members/GuardianList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[320,323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[320,323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useMemo\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":66,"column":17,"nodeType":"Identifier","endLine":66,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":171,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":171,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7846,7849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7846,7849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useMemo, useState } from 'react';\nimport { calculateAge, calculateGrade } from '@/lib/grade-utils';\nimport Link from 'next/link';\nimport { Search, ArrowUpDown, ChevronUp, ChevronDown } from 'lucide-react';\nimport { Input } from '@/components/ui/input';\n\ninterface GuardianListProps {\n  profiles: any[];\n  targetFiscalYear: number;\n  canEdit?: boolean;\n}\n\nexport default function GuardianList({ profiles, targetFiscalYear, canEdit }: GuardianListProps) {\n\n  const [sortConfig, setSortConfig] = useState<{ key: string; direction: 'asc' | 'desc' } | null>({\n    key: 'joined_at',\n    direction: 'desc',\n  });\n  const [searchQuery, setSearchQuery] = useState('');\n\n  const filteredProfiles = useMemo(() => {\n    let list = [...(profiles || [])];\n\n    // Search filter\n    if (searchQuery) {\n      const s = searchQuery.toLowerCase();\n      list = list.filter(p =>\n        p.full_name?.toLowerCase().includes(s) ||\n        p.last_name_kana?.includes(s) ||\n        p.first_name_kana?.includes(s) ||\n        p.email?.toLowerCase().includes(s) ||\n        p.phone?.includes(s) ||\n        p.address?.toLowerCase().includes(s)\n      );\n    }\n\n    // Sort\n    if (sortConfig) {\n      list.sort((a, b) => {\n        let valA = a[sortConfig.key];\n        let valB = b[sortConfig.key];\n\n        if (sortConfig.key === 'joined_at') {\n          valA = new Date(a.joined_at).getTime();\n          valB = new Date(b.joined_at).getTime();\n        }\n\n        if (valA === undefined || valA === null) return 1;\n        if (valB === undefined || valB === null) return -1;\n\n        if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1;\n        if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1;\n        return 0;\n      });\n    }\n\n    return list;\n  }, [profiles, searchQuery, sortConfig]);\n\n  if (!profiles || profiles.length === 0) {\n    return <div className=\"p-4 text-center text-muted-foreground\">登録されている保護者（会員）はいません。</div>;\n  }\n\n  const stats = useMemo(() => {\n    // Count 'households' - technically every profile in this list is a guardian/member\n    // The user specifically asked: \"Display count of guardians who have children registered as members\"\n    const householdCount = profiles.filter(p => p.children && p.children.length > 0).length;\n    return {\n      total: profiles.length,\n      householdCount\n    };\n  }, [profiles]);\n\n  const requestSort = (key: string) => {\n    let direction: 'asc' | 'desc' = 'asc';\n    if (sortConfig && sortConfig.key === key && sortConfig.direction === 'asc') {\n      direction = 'desc';\n    }\n    setSortConfig({ key, direction });\n  };\n\n  const getSortIcon = (key: string) => {\n    if (!sortConfig || sortConfig.key !== key) {\n      return <ArrowUpDown className=\"h-3 w-3 ml-1 text-muted-foreground/30\" />;\n    }\n    return sortConfig.direction === 'asc'\n      ? <ChevronUp className=\"h-3 w-3 ml-1 text-primary\" />\n      : <ChevronDown className=\"h-3 w-3 ml-1 text-primary\" />;\n  };\n\n  return (\n    <div>\n      {/* Statistics */}\n      <div className=\"bg-background p-4 rounded-lg shadow-sm mb-6 border border-border\">\n        <h3 className=\"text-lg font-bold text-foreground mb-3\">統計情報</h3>\n        <div className=\"flex gap-4\">\n          <div className=\"bg-primary/10 p-3 rounded-md border border-primary/20 flex-1 md:flex-none md:w-64\">\n            <span className=\"block text-sm text-primary font-medium\">会員世帯数</span>\n            <span className=\"block text-2xl font-bold text-foreground\">{stats.householdCount}世帯</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Search and Actions */}\n      <div className=\"mt-6 mb-4 flex flex-col sm:flex-row gap-3 items-end justify-between px-4 sm:px-0\">\n        <div className=\"w-full sm:max-w-xs relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <Search className=\"h-4 w-4 text-muted-foreground\" />\n          </div>\n          <Input\n            type=\"text\"\n            placeholder=\"お名前、かな、メール等で検索...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n          />\n        </div>\n        <div className=\"text-xs text-muted-foreground italic mr-2 sm:mr-0\">\n          {filteredProfiles.length}名を表示中\n        </div>\n      </div>\n      <div className=\"mt-8 flow-root\">\n        <div className=\"-mx-4 -my-2 overflow-x-auto sm:-mx-6 lg:-mx-8\">\n          <div className=\"inline-block min-w-full py-2 align-middle sm:px-6 lg:px-8\">\n            <div className=\"overflow-hidden shadow-sm ring-1 ring-border sm:rounded-lg bg-background\">\n              {filteredProfiles.length === 0 ? (\n                <div className=\"p-12 text-center text-muted-foreground\">\n                  検索条件に一致する保護者は見つかりませんでした。\n                </div>\n              ) : (\n                <table className=\"min-w-full divide-y divide-border\">\n                  <thead className=\"bg-muted/50\">\n                    <tr>\n                      <th scope=\"col\" onClick={() => requestSort('full_name')} className=\"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-foreground sm:pl-6 cursor-pointer hover:bg-muted/70\">\n                        <div className=\"flex items-center\">名前 (保護者) {getSortIcon('full_name')}</div>\n                      </th>\n                      <th scope=\"col\" onClick={() => requestSort('email')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground cursor-pointer hover:bg-muted/70\">\n                        <div className=\"flex items-center\">メールアドレス {getSortIcon('email')}</div>\n                      </th>\n                      <th scope=\"col\" className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground\">\n                        連絡先\n                      </th>\n                      <th scope=\"col\" className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground\">\n                        お子様\n                      </th>\n                      <th scope=\"col\" onClick={() => requestSort('joined_at')} className=\"px-3 py-3.5 text-left text-sm font-semibold text-foreground cursor-pointer hover:bg-muted/70\">\n                        <div className=\"flex items-center\">登録日 {getSortIcon('joined_at')}</div>\n                      </th>\n                      {canEdit && <th scope=\"col\" className=\"relative py-3.5 pl-3 pr-4 sm:pr-6\"><span className=\"sr-only\">操作</span></th>}\n                    </tr>\n                  </thead>\n                  <tbody className=\"divide-y divide-border bg-background\">\n                    {filteredProfiles?.map((person, index) => (\n                      <tr key={person.id} className={index % 2 === 0 ? 'bg-background' : 'bg-muted/30'}>\n                        <td className=\"whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-foreground sm:pl-6\">\n                          <div>\n                            {person.full_name || '未設定'}\n                            {person.is_admin && <span className=\"ml-2 inline-flex items-center rounded-md bg-primary/10 px-2 py-1 text-xs font-medium text-primary ring-1 ring-inset ring-primary/15\">管理者</span>}\n                          </div>\n                          <div className=\"text-xs text-muted-foreground\">\n                            {person.last_name_kana} {person.first_name_kana}\n                          </div>\n                        </td>\n                        <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">{person.email}</td>\n                        <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">{person.phone || '-'}</td>\n                        <td className=\"px-3 py-4 text-sm text-muted-foreground\">\n                          {person.children && person.children.length > 0 ? (\n                            <ul className=\"list-disc list-inside\">\n                              {person.children.map((child: any) => (\n                                <li key={child.id}>\n                                  {child.full_name}\n                                  <span className=\"text-xs text-muted-foreground ml-1\">({child.last_name_kana} {child.first_name_kana})</span>\n                                  <span className=\"ml-1 text-muted-foreground\">\n                                    - {child.gender === 'male' ? '男' : child.gender === 'female' ? '女' : '他'}\n                                    {child.birthday && ` ${calculateGrade(child.birthday, targetFiscalYear)} (${calculateAge(child.birthday, targetFiscalYear)}歳)`}\n                                  </span>\n                                </li>\n                              ))}\n                            </ul>\n                          ) : (\n                            <span className=\"text-muted-foreground\">登録なし</span>\n                          )}\n                        </td>\n                        <td className=\"whitespace-nowrap px-3 py-4 text-sm text-muted-foreground\">\n                          {new Date(person.joined_at).toLocaleDateString()}\n                        </td>\n                        {canEdit && (\n                          <td className=\"whitespace-nowrap px-3 py-4 text-sm text-right\">\n                            <Link\n                              href={`/admin/users/${person.id}?view=guardian`}\n                              className=\"text-primary hover:text-primary bg-primary/10 px-3 py-1 rounded-md text-xs font-medium border border-primary/20\"\n                            >\n                              編集\n                            </Link>\n                          </td>\n                        )}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div >\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/members/MemberTabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/members/OfficerList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[93,96],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[93,96],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[295,298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[295,298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1165,1168],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1165,1168],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\n\nimport { useMemo } from 'react';\n\ninterface OfficerListProps {\n  assignments: any[];\n  titleYear: string;\n}\n\nexport default function OfficerList({ assignments, titleYear }: OfficerListProps) {\n\n  const officerCount = useMemo(() => {\n    return new Set((assignments || []).map((a: any) => a.profile_id)).size;\n  }, [assignments]);\n\n  return (\n    <div>\n      {/* Stats */}\n      <div className=\"bg-white p-4 rounded-lg shadow mb-6 border border-gray-200\">\n        <h3 className=\"text-lg font-bold text-gray-900 mb-2\">概要</h3>\n        <p className=\"text-gray-700\">対象年度: <span className=\"font-bold\">{titleYear}度</span></p>\n        <p className=\"text-gray-700\">役員総数: <span className=\"font-bold text-xl\">{officerCount}名</span></p>\n      </div>\n\n      <div className=\"flow-root mt-6\">\n        <div className=\"overflow-hidden bg-white shadow sm:rounded-md\">\n          <ul role=\"list\" className=\"divide-y divide-gray-200 border-t border-gray-200\">\n            {(assignments || []).length === 0 ? (\n              <li className=\"px-4 py-4 sm:px-6 text-gray-500 text-center\">任命された役員はいません</li>\n            ) : (\n              (assignments || []).map((assignment: any) => (\n                <li key={assignment.id} className=\"px-4 py-4 sm:px-6 hover:bg-gray-50\">\n                  <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                    {/* Role & Year - Fixed width on desktop for alignment */}\n                    <div className=\"flex items-center gap-2 sm:w-48 shrink-0\">\n                      <span className=\"font-bold text-gray-900 text-lg\">{assignment.role?.name}</span>\n                    </div>\n\n                    {/* Name & Meta Info - Flex grow */}\n                    <div className=\"flex-1 flex flex-col sm:flex-row sm:items-baseline gap-1 sm:gap-6 min-w-0\">\n                      <div className=\"flex flex-col\">\n                        <div className=\"flex items-baseline gap-2 shrink-0\">\n                          <p className=\"text-sm font-medium text-indigo-600\">{assignment.profile.full_name}</p>\n                          <p className=\"text-xs text-gray-400 whitespace-nowrap\">({assignment.profile.last_name_kana} {assignment.profile.first_name_kana})</p>\n                        </div>\n                      </div>\n\n                      <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-gray-500 min-w-0\">\n                        <span className=\"truncate\">{assignment.profile.email}</span>\n                        <span className=\"whitespace-nowrap text-gray-400\">任期: {assignment.start_date} 〜 {assignment.end_date}</span>\n                      </div>\n                    </div>\n                  </div>\n                </li>\n              ))\n            )}\n          </ul>\n        </div>\n      </div>\n    </div>\n  );\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/users/AdminChildForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[242,245],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[242,245],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Input } from '@/components/ui/input'\nimport { useState } from 'react'\nimport { adminAddChild, adminUpdateChild } from '@/app/admin/actions/user'\nimport Link from 'next/link'\n\ntype Props = {\n  parentId: string\n  child?: any\n}\n\nexport default function AdminChildForm({ parentId, child }: Props) {\n  const [message, setMessage] = useState<string | null>(null)\n\n  const handleSubmit = async (formData: FormData) => {\n    setMessage(null)\n\n    let result;\n    if (child) {\n      result = await adminUpdateChild(formData)\n    } else {\n      result = await adminAddChild(formData)\n    }\n\n    if (result && !result.success) {\n      setMessage(result.message)\n    }\n  }\n\n  return (\n    <form action={handleSubmit} className=\"space-y-6 bg-white p-6 shadow sm:rounded-md mt-6\">\n      <input type=\"hidden\" name=\"parent_id\" value={parentId} />\n      {child && <input type=\"hidden\" name=\"child_id\" value={child.id} />}\n\n      {message && (\n        <div className=\"bg-red-50 border-red-200 text-red-700 px-4 py-3 rounded border\">\n          {message}\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6\">\n        <div className=\"sm:col-span-3\">\n          <label className=\"block text-sm font-medium text-gray-700\">お名前 <span className=\"text-red-500\">*</span></label>\n          <div className=\"mt-1 flex gap-2\">\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"last_name\" placeholder=\"苗字\" defaultValue={child?.last_name || ''} required />\n            </div>\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"first_name\" placeholder=\"名前\" defaultValue={child?.first_name || ''} required />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label className=\"block text-sm font-medium text-gray-700\">ふりがな</label>\n          <div className=\"mt-1 flex gap-2\">\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"last_name_kana\" placeholder=\"みょうじ\" defaultValue={child?.last_name_kana || ''} />\n            </div>\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"first_name_kana\" placeholder=\"なまえ\" defaultValue={child?.first_name_kana || ''} />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label htmlFor=\"gender\" className=\"block text-sm font-medium text-gray-700\">性別</label>\n          <div className=\"mt-1\">\n            <select\n              id=\"gender\"\n              name=\"gender\"\n              defaultValue={child?.gender || 'male'}\n              className=\"block w-full rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n            >\n              <option value=\"male\">男の子</option>\n              <option value=\"female\">女の子</option>\n              <option value=\"other\">その他</option>\n            </select>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label htmlFor=\"birthday\" className=\"block text-sm font-medium text-gray-700\">生年月日</label>\n          <div className=\"mt-1\">\n            <Input type=\"date\" name=\"birthday\" id=\"birthday\" defaultValue={child?.birthday || ''} />\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-6\">\n          <label htmlFor=\"allergies\" className=\"block text-sm font-medium text-gray-700\">アレルギー</label>\n          <div className=\"mt-1\">\n            <Input type=\"text\" name=\"allergies\" id=\"allergies\" defaultValue={child?.allergies || ''} placeholder=\"なし\" />\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-6\">\n          <label htmlFor=\"notes\" className=\"block text-sm font-medium text-gray-700\">特記事項</label>\n          <div className=\"mt-1\">\n            <textarea\n              id=\"notes\"\n              name=\"notes\"\n              rows={3}\n              defaultValue={child?.notes || ''}\n              className=\"block w-full rounded-md border-0 py-1.5 p-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6\"\n            />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex justify-end gap-3\">\n        <Link href={`/admin/users/${parentId}`} className=\"rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50\">\n          キャンセル\n        </Link>\n        <button type=\"submit\" className=\"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\">\n          {child ? '更新する' : '追加する'}\n        </button>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/users/AdminChildList.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[312,315],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[312,315],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/rules-of-hooks","severity":2,"message":"React Hook \"useRouter\" is called conditionally. React Hooks must be called in the exact same order in every component render. Did you accidentally call a React Hook after an early return?","line":45,"column":18,"nodeType":"Identifier","endLine":45,"endColumn":27}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { adminDeleteChild, adminDeleteAllChildrenFromParent } from '@/app/admin/actions/user'\nimport Link from 'next/link'\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { calculateGrade, getGradeOrder } from '@/lib/grade-utils'\n\ntype Props = {\n  childrenData: any[]\n  parentId: string\n  targetFiscalYear: number\n}\n\nexport default function AdminChildList({ childrenData, parentId, targetFiscalYear }: Props) {\n\n  // Internal delete button component to handle state per child\n  const DeleteButton = ({ childId }: { childId: string }) => {\n    const [message, setMessage] = useState<string | null>(null)\n\n    const handleDelete = async (formData: FormData) => {\n      if (!confirm('本当に削除しますか？')) return\n\n      const result = await adminDeleteChild(formData)\n      if (result && !result.success) {\n        setMessage(result.message)\n        setTimeout(() => setMessage(null), 3000)\n      }\n    }\n\n    return (\n      <form action={handleDelete}>\n        <input type=\"hidden\" name=\"child_id\" value={childId} />\n        <input type=\"hidden\" name=\"parent_id\" value={parentId} />\n        {message && <span className=\"text-xs text-red-500 mr-2\">{message}</span>}\n        <button type=\"submit\" className=\"text-sm text-red-600 hover:text-red-900 bg-red-50 px-2 py-1 rounded border border-red-100\">削除</button>\n      </form>\n    )\n  }\n\n  if (!childrenData || childrenData.length === 0) {\n    return <div className=\"p-4 text-center text-gray-500 bg-white rounded-md border border-gray-200\">登録されているお子様はいません。</div>\n  }\n\n  const router = useRouter()\n  const handleDeleteAll = async () => {\n    if (!confirm('この保護者に登録されているすべてのお子様を削除しますか？\\nこの操作は取り消せません。')) return\n\n    const formData = new FormData()\n    formData.append('parent_id', parentId)\n    const result = await adminDeleteAllChildrenFromParent(formData)\n    if (!result.success) {\n      alert(result.message)\n    } else {\n      router.refresh()\n    }\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex justify-end\">\n        <button\n          onClick={handleDeleteAll}\n          className=\"text-xs text-red-600 hover:text-red-900 bg-red-50 px-3 py-1.5 rounded border border-red-200 font-medium\"\n        >\n          登録されている子供を全員削除\n        </button>\n      </div>\n      <div className=\"overflow-x-auto rounded-lg border border-gray-200 shadow-sm\">\n        <table className=\"min-w-full divide-y divide-gray-200 text-sm\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-4 py-3 text-left font-semibold text-gray-900\">学年</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-gray-900\">氏名</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-gray-900\">生年月日 / 性別</th>\n              <th className=\"px-4 py-3 text-left font-semibold text-gray-900\">アレルギー / 備考</th>\n              <th className=\"px-4 py-3 text-right font-semibold text-gray-900\">操作</th>\n            </tr>\n          </thead>\n          <tbody className=\"divide-y divide-gray-200 bg-white\">\n            {childrenData.map((child) => {\n              const grade = calculateGrade(child.birthday, targetFiscalYear)\n              const isEven = getGradeOrder(grade) % 2 === 0\n\n              return (\n                <tr key={child.id} className={`hover:bg-gray-50/80 transition-colors ${isEven ? 'bg-white' : 'bg-indigo-50/30'}`}>\n                  <td className=\"px-4 py-4 whitespace-nowrap font-medium text-gray-900\">{grade}</td>\n                  <td className=\"px-4 py-4 whitespace-nowrap\">\n                    <div className=\"flex items-center gap-2\">\n                      <span className=\"font-medium text-gray-900\">{child.full_name}</span>\n                      <span className=\"text-xs text-gray-500\">({child.last_name_kana} {child.first_name_kana})</span>\n                    </div>\n                  </td>\n                  <td className=\"px-4 py-4 whitespace-nowrap text-gray-500\">\n                    {child.birthday ? new Date(child.birthday).toLocaleDateString() : '-'}\n                    {' / '}\n                    {child.gender === 'male' ? '男' : child.gender === 'female' ? '女' : '他'}\n                  </td>\n                  <td className=\"px-4 py-4 text-gray-500\">\n                    {child.allergies && (\n                      <p className=\"text-red-500 font-medium mb-1 line-clamp-1\" title={child.allergies}>⚠ {child.allergies}</p>\n                    )}\n                    {child.notes && (\n                      <p className=\"text-xs line-clamp-1\" title={child.notes}>{child.notes}</p>\n                    )}\n                  </td>\n                  <td className=\"px-4 py-4 text-right\">\n                    <div className=\"flex justify-end items-center gap-3\">\n                      <Link\n                        href={`/admin/users/${parentId}/children/${child.id}`}\n                        className=\"text-sm text-indigo-600 hover:text-indigo-900 bg-indigo-50 px-2 py-1 rounded border border-indigo-100\"\n                      >\n                        編集\n                      </Link>\n                      <DeleteButton childId={child.id} />\n                    </div>\n                  </td>\n                </tr>\n              )\n            })}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/admin/users/AdminUserForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[246,249],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[246,249],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'router' is assigned a value but never used. Allowed unused vars must match /^_/u.","line":15,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":15,"endColumn":15}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { Input } from '@/components/ui/input'\nimport { useState } from 'react'\nimport { adminUpdateProfile, adminDeleteProfile } from '@/app/admin/actions/user'\nimport { useRouter } from 'next/navigation'\n\ntype Props = {\n  profile: any\n}\n\nexport default function AdminUserForm({ profile }: Props) {\n  const [message, setMessage] = useState<string | null>(null)\n  const [isDeleting, setIsDeleting] = useState(false)\n  const router = useRouter()\n\n  const handleSubmit = async (formData: FormData) => {\n    setMessage(null)\n    const result = await adminUpdateProfile(formData)\n\n    if (result) {\n      setMessage(result.message)\n      if (result.success) {\n        setTimeout(() => setMessage(null), 3000)\n      }\n    }\n  }\n\n  return (\n    <form action={handleSubmit} className=\"space-y-6\">\n      <input type=\"hidden\" name=\"id\" value={profile.id} />\n\n      {message && (\n        <div className={`border px-4 py-3 rounded ${message.includes('失敗') || message.includes('エラー') ? 'bg-red-50 border-red-200 text-red-700' : 'bg-green-50 border-green-200 text-green-700'}`}>\n          {message}\n        </div>\n      )}\n\n      <div className=\"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6\">\n        <div className=\"sm:col-span-3\">\n          <label className=\"block text-sm font-medium text-gray-700\">お名前 <span className=\"text-red-500\">*</span></label>\n          <div className=\"mt-1 flex gap-2\">\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"last_name\" placeholder=\"苗字\" defaultValue={profile?.last_name || ''} required />\n            </div>\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"first_name\" placeholder=\"名前\" defaultValue={profile?.first_name || ''} required />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label className=\"block text-sm font-medium text-gray-700\">ふりがな</label>\n          <div className=\"mt-1 flex gap-2\">\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"last_name_kana\" placeholder=\"みょうじ\" defaultValue={profile?.last_name_kana || ''} />\n            </div>\n            <div className=\"w-1/2\">\n              <Input type=\"text\" name=\"first_name_kana\" placeholder=\"なまえ\" defaultValue={profile?.first_name_kana || ''} />\n            </div>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">メールアドレス</label>\n          <div className=\"mt-1\">\n            <Input type=\"email\" name=\"email\" id=\"email\" defaultValue={profile?.email || ''} readOnly className=\"bg-gray-50\" />\n            <p className=\"text-xs text-gray-500 mt-1\">メールアドレスの変更はできません。</p>\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-3\">\n          <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">電話番号</label>\n          <div className=\"mt-1\">\n            <Input type=\"tel\" name=\"phone\" id=\"phone\" defaultValue={profile?.phone || ''} />\n          </div>\n        </div>\n\n        <div className=\"sm:col-span-6\">\n          <label htmlFor=\"address\" className=\"block text-sm font-medium text-gray-700\">住所</label>\n          <div className=\"mt-1\">\n            <Input type=\"text\" name=\"address\" id=\"address\" defaultValue={profile?.address || ''} />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex justify-between items-center pt-4 border-t border-border mt-8\">\n        <div>\n          <button\n            type=\"button\"\n            disabled={isDeleting}\n            onClick={async () => {\n              if (!confirm('この会員を本当に削除しますか？\\n（同時にお子様の情報もすべて論理削除されます。現年度以降の役員として登録されている場合は削除できません）')) return\n\n              setIsDeleting(true)\n              setMessage(null)\n\n              const formData = new FormData()\n              formData.append('id', profile.id)\n\n              const result = await adminDeleteProfile(formData)\n              if (result && !result.success) {\n                setMessage(result.message)\n                setIsDeleting(false)\n              }\n            }}\n            className=\"rounded-md bg-white px-3 py-2 text-sm font-semibold text-red-600 shadow-sm ring-1 ring-inset ring-red-300 hover:bg-red-50 disabled:opacity-50\"\n          >\n            {isDeleting ? '削除中...' : '会員を削除'}\n          </button>\n        </div>\n        <div className=\"flex gap-3\">\n          <button type=\"submit\" className=\"rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\">\n            保護者情報を更新\n          </button>\n        </div>\n      </div>\n    </form>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/forum/ForumCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used. Allowed unused vars must match /^_/u.","line":3,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":3,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AnimatePresence' is defined but never used. Allowed unused vars must match /^_/u.","line":5,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":5,"endColumn":33},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronDown' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":46,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":57},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'ChevronUp' is defined but never used. Allowed unused vars must match /^_/u.","line":6,"column":59,"nodeType":null,"messageId":"unusedVar","endLine":6,"endColumn":68},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[334,337],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[334,337],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2696,2699],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2696,2699],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":111,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":114,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2739,2742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2739,2742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3741,3744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3741,3744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState } from 'react'\nimport Link from 'next/link'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport { MessageSquare, CheckCircle2, Clock, ChevronDown, ChevronUp } from 'lucide-react'\nimport { formatDistanceToNow } from 'date-fns'\nimport { ja } from 'date-fns/locale'\n\ntype Props = {\n  question: any\n}\n\nexport default function ForumCard({ question }: Props) {\n  const answerCount = question.forum_answers?.length || 0\n  const reactionCount = question.forum_reactions?.length || 0\n\n  return (\n    <motion.div\n      whileHover={{ y: -4 }}\n      className=\"bg-white rounded-[2.5rem] border border-gray-100 p-8 shadow-sm hover:shadow-xl transition-all group relative overflow-hidden flex flex-col\"\n    >\n      <div className={`absolute top-0 left-0 w-2 h-full ${question.is_resolved ? 'bg-green-400' : 'bg-indigo-500'}`} />\n\n      <div className=\"flex justify-between items-start mb-6\">\n        <div className=\"flex items-center gap-3 text-xs text-gray-500\">\n          <span className=\"font-bold text-indigo-600 bg-indigo-50 px-4 py-1.5 rounded-full border border-indigo-100\">\n            {question.profiles?.last_name} {question.profiles?.first_name}\n          </span>\n          <span className=\"flex items-center gap-1 font-medium\">\n            <Clock size={14} />\n            {formatDistanceToNow(new Date(question.created_at), { addSuffix: true, locale: ja })}\n          </span>\n        </div>\n        {question.is_resolved && (\n          <span className=\"flex items-center gap-1.5 text-[10px] font-bold text-green-600 bg-green-50 px-3 py-1.5 rounded-xl border border-green-100 uppercase tracking-widest\">\n            <CheckCircle2 size={14} />\n            解決済み\n          </span>\n        )}\n      </div>\n\n      <Link href={`/forum/${question.id}`} className=\"block group/title mb-6\">\n        <h3 className=\"text-2xl font-black text-gray-900 group-hover/title:text-indigo-600 transition-colors mb-3 leading-tight tracking-tight\">\n          {question.title}\n        </h3>\n        <p className=\"text-gray-600 text-base leading-relaxed line-clamp-3\">\n          {question.content}\n        </p>\n      </Link>\n\n      <div className=\"flex items-center justify-between mb-8\">\n        <div className=\"flex items-center gap-6\">\n          <div className=\"flex items-center gap-2 text-indigo-600\">\n            <div className=\"p-2 bg-indigo-50 rounded-2xl\">\n              <MessageSquare size={18} />\n            </div>\n            <span className=\"font-black text-sm\">{answerCount} 件の回答</span>\n          </div>\n\n          {reactionCount > 0 && (\n            <div className=\"flex items-center -space-x-2\">\n              {Array.from(new Set(question.forum_reactions.map((r: any) => r.emoji))).slice(0, 3).map((emoji: any, i) => (\n                <span key={i} className=\"text-xl bg-white rounded-full w-9 h-9 flex items-center justify-center border-2 border-gray-50 shadow-sm ring-2 ring-white\">{emoji}</span>\n              ))}\n              <span className=\"ml-4 font-black text-xs text-indigo-300\">{reactionCount}</span>\n            </div>\n          )}\n        </div>\n\n        <Link\n          href={`/forum/${question.id}`}\n          className=\"bg-gray-50 text-gray-900 group-hover:bg-indigo-600 group-hover:text-white px-5 py-2.5 rounded-[1.25rem] text-xs font-black transition-all shadow-sm flex items-center gap-2\"\n        >\n          詳細・回答する\n        </Link>\n      </div>\n\n      {answerCount > 0 && (\n        <div className=\"mt-2 space-y-4 border-t border-gray-50 pt-8\">\n          <h4 className=\"text-[10px] font-black text-gray-300 uppercase tracking-[0.2em] mb-4\">Answers</h4>\n          <div className=\"space-y-4 max-h-[300px] overflow-y-auto no-scrollbar pr-2\">\n            {question.forum_answers.map((answer: any) => (\n              <div key={answer.id} className=\"bg-gray-50/50 rounded-3xl p-5 border border-gray-100/50 hover:bg-white hover:border-indigo-100 hover:shadow-lg hover:shadow-indigo-50/50 transition-all group/answer\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <span className=\"font-bold text-xs text-gray-400 group-hover/answer:text-indigo-400 transition-colors\">\n                    {answer.profiles?.last_name} {answer.profiles?.first_name}\n                  </span>\n                  <span className=\"text-[10px] font-bold text-gray-300\">\n                    {formatDistanceToNow(new Date(answer.created_at), { addSuffix: true, locale: ja })}\n                  </span>\n                </div>\n                <p className=\"text-gray-700 text-sm leading-relaxed\">\n                  {answer.content}\n                </p>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </motion.div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/forum/ForumSearch.tsx","messages":[{"ruleId":"react-hooks/immutability","severity":2,"message":"Error: Cannot access variable before it is declared\n\n`updateParams` is accessed before it is declared, which prevents the earlier access from updating when this value changes over time.\n\n/Users/macuser/work_local/2025/12_kodomokai/frontend/components/forum/ForumSearch.tsx:19:7\n  17 |   useEffect(() => {\n  18 |     if (debouncedValue !== currentQuery) {\n> 19 |       updateParams('q', debouncedValue)\n     |       ^^^^^^^^^^^^ `updateParams` accessed before it is declared\n  20 |     }\n  21 |   }, [debouncedValue])\n  22 |\n\n/Users/macuser/work_local/2025/12_kodomokai/frontend/components/forum/ForumSearch.tsx:23:3\n  21 |   }, [debouncedValue])\n  22 |\n> 23 |   const updateParams = (key: string, value: string) => {\n     |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 24 |     const params = new URLSearchParams(searchParams.toString())\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 25 |     if (value) {\n     …\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 33 |     })\n     | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 34 |   }\n     | ^^^^ `updateParams` is declared here\n  35 |\n  36 |   return (\n  37 |     <div className=\"space-y-12\">","line":19,"column":7,"nodeType":null,"endLine":19,"endColumn":19},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'currentQuery' and 'updateParams'. Either include them or remove the dependency array.","line":21,"column":6,"nodeType":"ArrayExpression","endLine":21,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [currentQuery, debouncedValue, updateParams]","fix":{"range":[678,694],"text":"[currentQuery, debouncedValue, updateParams]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client'\n\nimport { useState, useTransition, useEffect } from 'react'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { Search, X } from 'lucide-react'\nimport { useDebounce } from '@/lib/hooks/use-debounce'\n\nexport default function ForumSearch() {\n  const router = useRouter()\n  const searchParams = useSearchParams()\n  const [isPending, startTransition] = useTransition()\n\n  const currentQuery = searchParams.get('q') || ''\n  const [inputValue, setInputValue] = useState(currentQuery)\n  const debouncedValue = useDebounce(inputValue, 500)\n\n  useEffect(() => {\n    if (debouncedValue !== currentQuery) {\n      updateParams('q', debouncedValue)\n    }\n  }, [debouncedValue])\n\n  const updateParams = (key: string, value: string) => {\n    const params = new URLSearchParams(searchParams.toString())\n    if (value) {\n      params.set(key, value)\n    } else {\n      params.delete(key)\n    }\n\n    startTransition(() => {\n      router.push(`/forum?${params.toString()}`)\n    })\n  }\n\n  return (\n    <div className=\"space-y-12\">\n      <div className=\"relative max-w-md\">\n        <Search className={`absolute left-4 top-1/2 -translate-y-1/2 transition-colors ${isPending ? 'text-white animate-pulse' : 'text-indigo-300'}`} size={20} />\n        <input\n          type=\"text\"\n          value={inputValue}\n          onChange={(e) => setInputValue(e.target.value)}\n          placeholder=\"キーワードで検索\"\n          className=\"w-full bg-white/10 border border-white/20 rounded-2xl py-4 pl-12 pr-12 text-white placeholder:text-indigo-200 focus:outline-none focus:bg-white/20 transition-all backdrop-blur-md\"\n        />\n        {inputValue && (\n          <button\n            onClick={() => setInputValue('')}\n            className=\"absolute right-4 top-1/2 -translate-y-1/2 text-indigo-300 hover:text-white transition-colors p-1\"\n            title=\"検索をクリア\"\n          >\n            <X size={18} />\n          </button>\n        )}\n      </div>\n\n      <div className=\"flex items-center justify-between mt-12 px-2 -mx-2\">\n        <h3 className=\"text-xl font-bold text-gray-900 flex items-center gap-2\">\n          最近の質問\n        </h3>\n      </div>\n    </div>\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/forum/QuestionDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/forum/ReactionBar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/ui/CopyLinkButton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/ui/CopyToClipboard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/ui/MarkdownEditor.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/components/ui/input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/calendar.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/date-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/fiscal-year.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/grade-utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/hooks/use-debounce.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/security.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/supabase/admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/supabase/client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/supabase/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/supabase/server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/lib/utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/macuser/work_local/2025/12_kodomokai/frontend/postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
